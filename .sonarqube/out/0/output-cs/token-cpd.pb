Ğ
zC:\Projects\adnanzameer\AdvancedTaskManager\net6.0\src\AdvancedTaskManager\Features\AdvancedTask\AdvancedTaskController.cs
	namespace 	
AdvancedTaskManager
 
. 
Features &
.& '
AdvancedTask' 3
{ 
[ 
ApiExplorerSettings 
( 
	IgnoreApi "
=# $
true% )
)) *
]* +
[ 
	Authorize 
( 
Policy 
= 
	Constants !
.! "

PolicyName" ,
), -
]- .
public 

class "
AdvancedTaskController '
:( )

Controller* 4
{ 
private   
readonly   
IApprovalRepository   ,
_approvalRepository  - @
;  @ A
private!! 
readonly!! 
	IUIHelper!! "
_helper!!# *
;!!* +
private"" 
readonly"" 
IContentRepository"" +
_contentRepository"", >
;""> ?
private## 
readonly## "
IContentTypeRepository## /"
_contentTypeRepository##0 F
;##F G
private$$ 
readonly$$  
INotificationHandler$$ - 
_notificationHandler$$. B
;$$B C
private%% 
readonly%% 
IApprovalEngine%% (
_approvalEngine%%) 8
;%%8 9
private&& 
readonly&& 
LocalizationService&& , 
_localizationService&&- A
;&&A B
private'' 
readonly'' 
IChangeTaskHelper'' *
_changeTaskHelper''+ <
;''< =
private)) 
readonly)) %
ILanguageBranchRepository)) 2%
_languageBranchRepository))3 L
;))L M
private** 
readonly** &
AdvancedTaskManagerOptions** 3
_configuration**4 B
;**B C
private,, 
readonly,, 
ILogger,,  
_logger,,! (
;,,( )
private-- 
const-- 
string-- /
#ContentApprovalDeadlinePropertyName-- @
=--A B
$str--C `
;--` a
public// "
AdvancedTaskController// %
(//% &
IApprovalRepository//& 9
approvalRepository//: L
,//L M
IContentRepository//N `
contentRepository//a r
,//r s#
IContentTypeRepository	//t Š#
contentTypeRepository
//‹  
,
//  ¡
IApprovalEngine
//¢ ±
approvalEngine
//² À
,
//À Á!
LocalizationService
//Â Õ!
localizationService
//Ö é
,
//é ê
IChangeTaskHelper
//ë ü
changeTaskHelper
//ı 
,
// 
	IUIHelper
// ˜
helper
//™ Ÿ
,
//Ÿ  '
ILanguageBranchRepository
//¡ º&
languageBranchRepository
//» Ó
,
//Ó Ô
IOptions
//Õ İ
<
//İ Ş(
AdvancedTaskManagerOptions
//Ş ø
>
//ø ù
options
//ú 
,
// ‚"
INotificationHandler
//ƒ —!
notificationHandler
//˜ «
)
//« ¬
{00 	
_approvalRepository11 
=11  !
approvalRepository11" 4
;114 5
_contentRepository22 
=22  
contentRepository22! 2
;222 3"
_contentTypeRepository33 "
=33# $!
contentTypeRepository33% :
;33: ;
_approvalEngine44 
=44 
approvalEngine44 ,
;44, - 
_localizationService55  
=55! "
localizationService55# 6
;556 7
_changeTaskHelper66 
=66 
changeTaskHelper66  0
;660 1
_helper77 
=77 
helper77 
;77 %
_languageBranchRepository99 %
=99& '$
languageBranchRepository99( @
;99@ A 
_notificationHandler::  
=::! "
notificationHandler::# 6
;::6 7
_configuration;; 
=;; 
options;; $
.;;$ %
Value;;% *
;;;* +
_logger<< 
=<< 

LogManager<<  
.<<  !
	GetLogger<<! *
(<<* +
typeof<<+ 1
(<<1 2"
AdvancedTaskController<<2 H
)<<H I
)<<I J
;<<J K
}== 	
public?? 
async?? 
Task?? 
<?? 
IActionResult?? '
>??' (
Index??) .
(??. /
int??/ 2
???2 3
page??4 8
,??8 9
string??: @
language??A I
)??I J
{@@ 	
varAA 

assembliesAA 
=AA 
	AppDomainAA &
.AA& '
CurrentDomainAA' 4
.AA4 5
GetAssembliesAA5 B
(AAB C
)AAC D
.AAD E
WhereAAE J
(AAJ K
aAAK L
=>AAM O
!AAP Q
stringAAQ W
.AAW X
IsNullOrEmptyAAX e
(AAe f
aAAf g
.AAg h
FullNameAAh p
)AAp q
&&AAr t
aAAu v
.AAv w
FullNameAAw 
.	AA €
Contains
AA€ ˆ
(
AAˆ ‰
$str
AA‰ £
)
AA£ ¤
)
AA¤ ¥
;
AA¥ ¦
ifCC 
(CC 

assembliesCC 
.CC 
AnyCC 
(CC 
)CC  
)CC  !
{DD 
ViewBagEE 
.EE 
ChangeApprovalEE &
=EE' (
trueEE) -
;EE- .
}FF 
varHH 
	viewModelHH 
=HH 
newHH %
AdvancedTaskIndexViewDataHH  9
(HH9 :
LanguageBranchesHH: J
(HHJ K
languageHHK S
)HHS T
,HHT U
_configurationHHV d
)HHd e
{II 
QueryStringJJ 
=JJ 
HttpContextJJ )
.JJ) *
RequestJJ* 1
.JJ1 2
QueryStringJJ2 =
.JJ= >
ToStringJJ> F
(JJF G
)JJG H
,JJH I

PageNumberKK 
=KK 
pageKK !
??KK" $
$numKK% &
}LL 
;LL 
awaitNN 
ChangeApprovalModelNN %
(NN% &
	viewModelNN& /
)NN/ 0
;NN0 1
returnPP 
ViewPP 
(PP 
	viewModelPP !
)PP! "
;PP" #
}QQ 	
privateTT 
asyncTT 
TaskTT 
ChangeApprovalModelTT .
(TT. /%
AdvancedTaskIndexViewDataTT/ H
	viewModelTTI R
)TTR S
{UU 	
ViewBagVV 
.VV 
PageVV 
=VV 
$strVV ,
;VV, -
varXX 
contentTaskListXX 
=XX  !
awaitXX" '
GetContentTasksXX( 7
(XX7 8
	viewModelXX8 A
)XXA B
;XXB C
	viewModelYY 
.YY 
ContentTaskListYY %
=YY& '
contentTaskListYY( 7
;YY7 8
var[[ 
count[[ 
=[[ 
contentTaskList[[ '
.[[' (
Count[[( -
([[- .
x[[. /
=>[[0 2
x[[3 4
.[[4 5
CanUserPublish[[5 C
)[[C D
;[[D E
if\\ 
(\\ 
count\\ 
!=\\ 
$num\\ 
)\\ 
{]] 
	viewModel^^ 
.^^ 
HasPublishAccess^^ *
=^^+ ,
true^^- 1
;^^1 2
}__ 
}`` 	
[bb 	
HttpGetbb	 
]bb 
publiccc 
asynccc 
Taskcc 
<cc 
IActionResultcc '
>cc' (
ChangeApprovalcc) 7
(cc7 8
intcc8 ;
?cc; <
pagecc= A
)ccA B
{dd 	
varee 
	viewModelee 
=ee 
newee %
AdvancedTaskIndexViewDataee  9
(ee9 :
LanguageBranchesee: J
(eeJ K
stringeeK Q
.eeQ R
EmptyeeR W
)eeW X
,eeX Y
_configurationeeZ h
)eeh i
{ff 
QueryStringgg 
=gg 
HttpContextgg )
.gg) *
Requestgg* 1
.gg1 2
QueryStringgg2 =
.gg= >
ToStringgg> F
(ggF G
)ggG H
,ggH I

PageNumberhh 
=hh 
pagehh !
??hh" $
$numhh% &
}ii 
;ii 
ViewBagkk 
.kk 
Pagekk 
=kk 
$strkk +
;kk+ ,
varmm 

assembliesmm 
=mm 
	AppDomainmm &
.mm& '
CurrentDomainmm' 4
.mm4 5
GetAssembliesmm5 B
(mmB C
)mmC D
.mmD E
WheremmE J
(mmJ K
ammK L
=>mmM O
!mmP Q
stringmmQ W
.mmW X
IsNullOrEmptymmX e
(mme f
ammf g
.mmg h
FullNamemmh p
)mmp q
&&mmr t
ammu v
.mmv w
FullNamemmw 
.	mm €
Contains
mm€ ˆ
(
mmˆ ‰
$str
mm‰ £
)
mm£ ¤
)
mm¤ ¥
;
mm¥ ¦
ifoo 
(oo 
!oo 

assembliesoo 
.oo 
Anyoo 
(oo  
)oo  !
)oo! "
{pp 
varrr %
deleteChangeApprovalTasksrr -
=rr. /
_configurationrr0 >
.rr> ?%
DeleteChangeApprovalTasksrr? X
;rrX Y
ifss 
(ss %
deleteChangeApprovalTasksss -
)ss- .
{tt 
varuu 
changeTasksuu #
=uu$ %
awaituu& +"
GetChangeApprovalTasksuu, B
(uuB C
	viewModeluuC L
)uuL M
;uuM N
varvv 
idsvv 
=vv 
changeTasksvv )
.vv) *
Selectvv* 0
(vv0 1
contentTaskvv1 <
=>vv= ?
contentTaskvv@ K
.vvK L

ApprovalIdvvL V
)vvV W
.vvW X
ToListvvX ^
(vv^ _
)vv_ `
;vv` a
awaitww 

AbortTasksww $
(ww$ %
idsww% (
)ww( )
;ww) *
}xx 
awaitzz 
ChangeApprovalModelzz )
(zz) *
	viewModelzz* 3
)zz3 4
;zz4 5
return{{ 
View{{ 
({{ 
$str{{ #
,{{# $
	viewModel{{% .
){{. /
;{{/ 0
}|| 
ViewBag~~ 
.~~ 
ChangeApproval~~ "
=~~# $
true~~% )
;~~) *
var 
approvalTasks 
= 
await  %"
GetChangeApprovalTasks& <
(< =
	viewModel= F
)F G
;G H
	viewModel
€€ 
.
€€ 
ContentTaskList
€€ %
=
€€& '
approvalTasks
€€( 5
;
€€5 6
return
‚‚ 
View
‚‚ 
(
‚‚ 
	viewModel
‚‚ !
)
‚‚! "
;
‚‚" #
}
ƒƒ 	
[
…… 	
HttpPost
……	 
]
…… 
public
†† 
async
†† 
Task
†† 
<
†† 
IActionResult
†† '
>
††' (!
ApproveContentTasks
††) <
(
††< =
[
††= >
FromBody
††> F
]
††F G
ApprovalData
††H T
approvalData
††U a
)
††a b
{
‡‡ 	
ViewBag
ˆˆ 
.
ˆˆ 
Page
ˆˆ 
=
ˆˆ 
$str
ˆˆ ,
;
ˆˆ, -
if
‰‰ 
(
‰‰ 
approvalData
‰‰ 
!=
‰‰ 
null
‰‰  $
&&
‰‰% '
!
‰‰( )
string
‰‰) /
.
‰‰/ 0
IsNullOrEmpty
‰‰0 =
(
‰‰= >
approvalData
‰‰> J
.
‰‰J K

TaskValues
‰‰K U
)
‰‰U V
)
‰‰V W
{
ŠŠ 
if
‹‹ 
(
‹‹ 
string
‹‹ 
.
‹‹ 
IsNullOrEmpty
‹‹ (
(
‹‹( )
approvalData
‹‹) 5
.
‹‹5 6
ApprovalComment
‹‹6 E
)
‹‹E F
)
‹‹F G
{
ŒŒ 
approvalData
  
.
  !
ApprovalComment
! 0
=
1 2
$str
3 [
;
[ \
}
 
await
 
ApproveContent
 $
(
$ %
approvalData
% 1
.
1 2

TaskValues
2 <
,
< =
approvalData
> J
.
J K
ApprovalComment
K Z
,
Z [
approvalData
\ h
.
h i
PublishContent
i w
)
w x
;
x y
}
‘‘ 
return
’’ 
Json
’’ 
(
’’ 
$str
’’ 
)
’’ 
;
’’ 
}
““ 	
private
•• 
async
•• 
Task
•• 
<
•• 
List
•• 
<
••  
ContentTask
••  +
>
••+ ,
>
••, -
GetContentTasks
••. =
(
••= >'
AdvancedTaskIndexViewData
••> W
model
••X ]
)
••] ^
{
–– 	
var
—— 
selectedLanguage
——  
=
——! "
model
——# (
.
——( ) 
LanguageBranchList
——) ;
.
——; <
FirstOrDefault
——< J
(
——J K
x
——K L
=>
——M O
x
——P Q
.
——Q R
Selected
——R Z
)
——Z [
;
——[ \
if
™™ 
(
™™ 
selectedLanguage
™™  
?
™™  !
.
™™! "
Language
™™" *
!=
™™+ -
null
™™. 2
)
™™2 3
{
šš 
var
›› 
query
›› 
=
›› 
new
›› 
ApprovalQuery
››  -
{
œœ 
Status
 
=
 
ApprovalStatus
 +
.
+ ,
InReview
, 4
,
4 5
Language
 
=
 
new
 "
CultureInfo
# .
(
. /
selectedLanguage
/ ?
.
? @
Language
@ H
.
H I

LanguageID
I S
)
S T
,
T U
	Reference
ŸŸ 
=
ŸŸ 
new
ŸŸ  #
Uri
ŸŸ$ '
(
ŸŸ' (
$str
ŸŸ( 2
)
ŸŸ2 3
,
ŸŸ3 4
}
   
;
   
var
££ 
roles
££ 
=
££ 
await
££ !
_helper
££" )
.
££) *
GetUserRoles
££* 6
(
££6 7
)
££7 8
;
££8 9
if
¤¤ 
(
¤¤ 
!
¤¤ 
roles
¤¤ 
.
¤¤ 
Contains
¤¤ #
(
¤¤# $
Roles
¤¤$ )
.
¤¤) *
Administrators
¤¤* 8
)
¤¤8 9
&&
¤¤: <
!
¤¤= >
roles
¤¤> C
.
¤¤C D
Contains
¤¤D L
(
¤¤L M
Roles
¤¤M R
.
¤¤R S
	WebAdmins
¤¤S \
)
¤¤\ ]
&&
¤¤^ `
!
¥¥ 
roles
¥¥ 
.
¥¥ 
Contains
¥¥ #
(
¥¥# $
Roles
¥¥$ )
.
¥¥) *
	CmsAdmins
¥¥* 3
)
¥¥3 4
)
¥¥4 5
{
¦¦ 
query
§§ 
.
§§ 
Username
§§ "
=
§§# $
PrincipalAccessor
§§% 6
.
§§6 7
Current
§§7 >
.
§§> ?
Identity
§§? G
?
§§G H
.
§§H I
Name
§§I M
;
§§M N
}
¨¨ 
var
ªª 
list
ªª 
=
ªª 
await
ªª  !
_approvalRepository
ªª! 4
.
ªª4 5
	ListAsync
ªª5 >
(
ªª> ?
query
ªª? D
,
ªªD E
(
ªªF G
model
ªªG L
.
ªªL M

PageNumber
ªªM W
-
ªªX Y
$num
ªªZ [
)
ªª[ \
*
ªª] ^
model
ªª_ d
.
ªªd e
PageSize
ªªe m
,
ªªm n
model
ªªo t
.
ªªt u
PageSize
ªªu }
)
ªª} ~
;
ªª~ 
model
«« 
.
«« 
TotalItemsCount
«« %
=
««& '
Convert
««( /
.
««/ 0
ToInt32
««0 7
(
««7 8
list
««8 <
.
««< =

TotalCount
««= G
)
««G H
;
««H I
var
­­ 
taskList
­­ 
=
­­ 
new
­­ "
List
­­# '
<
­­' (
ContentTask
­­( 3
>
­­3 4
(
­­4 5
)
­­5 6
;
­­6 7
foreach
¯¯ 
(
¯¯ 
var
¯¯ 
task
¯¯ !
in
¯¯" $
list
¯¯% )
.
¯¯) *
PagedResult
¯¯* 5
)
¯¯5 6
{
°° 
var
±± 
id
±± 
=
±± 
task
±± !
.
±±! "
ID
±±" $
.
±±$ %
ToString
±±% -
(
±±- .
)
±±. /
;
±±/ 0
var
³³ 

customTask
³³ "
=
³³# $
new
³³% (
ContentTask
³³) 4
{
´´ 

ApprovalId
µµ "
=
µµ# $
task
µµ% )
.
µµ) *
ID
µµ* ,
,
µµ, -
DateTime
¶¶  
=
¶¶! "
task
¶¶# '
.
¶¶' (
ActiveStepStarted
¶¶( 9
,
¶¶9 :
	StartedBy
·· !
=
··" #
task
··$ (
.
··( )
	StartedBy
··) 2
}
¸¸ 
;
¸¸ 
if
ºº 
(
ºº 
task
ºº 
is
ºº 
ContentApproval
ºº  /
approval
ºº0 8
)
ºº8 9
{
»»  
_contentRepository
¼¼ *
.
¼¼* +
TryGet
¼¼+ 1
(
¼¼1 2
approval
¼¼2 :
.
¼¼: ;
ContentLink
¼¼; F
,
¼¼F G
out
¼¼H K
IContent
¼¼L T
content
¼¼U \
)
¼¼\ ]
;
¼¼] ^
if
¾¾ 
(
¾¾ 
content
¾¾ #
!=
¾¾$ &
null
¾¾' +
)
¾¾+ ,
{
¿¿ 

customTask
ÀÀ &
.
ÀÀ& '
URL
ÀÀ' *
=
ÀÀ+ ,
approval
ÀÀ- 5
.
ÀÀ5 6
ContentLink
ÀÀ6 A
.
ÀÀA B

GetEditUrl
ÀÀB L
(
ÀÀL M
selectedLanguage
ÀÀM ]
.
ÀÀ] ^
Language
ÀÀ^ f
.
ÀÀf g

LanguageID
ÀÀg q
)
ÀÀq r
;
ÀÀr s
id
ÁÁ 
=
ÁÁ  
content
ÁÁ! (
.
ÁÁ( )
ContentLink
ÁÁ) 4
.
ÁÁ4 5
ID
ÁÁ5 7
.
ÁÁ7 8
ToString
ÁÁ8 @
(
ÁÁ@ A
)
ÁÁA B
;
ÁÁB C
var
ÂÂ 
canUserPublish
ÂÂ  .
=
ÂÂ/ 0
_helper
ÂÂ1 8
.
ÂÂ8 9
CanUserPublish
ÂÂ9 G
(
ÂÂG H
content
ÂÂH O
)
ÂÂO P
;
ÂÂP Q

customTask
ÄÄ &
.
ÄÄ& '
CanUserPublish
ÄÄ' 5
=
ÄÄ6 7
canUserPublish
ÄÄ8 F
;
ÄÄF G

customTask
ÅÅ &
.
ÅÅ& '
ContentReference
ÅÅ' 7
=
ÅÅ8 9
content
ÅÅ: A
.
ÅÅA B
ContentLink
ÅÅB M
;
ÅÅM N

customTask
ÆÆ &
.
ÆÆ& '
ContentName
ÆÆ' 2
=
ÆÆ3 4
content
ÆÆ5 <
.
ÆÆ< =
Name
ÆÆ= A
;
ÆÆA B

customTask
ÈÈ &
.
ÈÈ& '
ContentType
ÈÈ' 2
=
ÈÈ3 4
GetTypeContent
ÈÈ5 C
(
ÈÈC D
content
ÈÈD K
)
ÈÈK L
;
ÈÈL M
if
ÊÊ 
(
ÊÊ  
content
ÊÊ  '
is
ÊÊ( *
PageData
ÊÊ+ 3
)
ÊÊ3 4
{
ËË 

customTask
ÌÌ  *
.
ÌÌ* +
Type
ÌÌ+ /
=
ÌÌ0 1
$str
ÌÌ2 8
;
ÌÌ8 9

customTask
ÍÍ  *
.
ÍÍ* +
ContentIcon
ÍÍ+ 6
=
ÍÍ7 8
$str
ÍÍ9 D
;
ÍÍD E
}
ÎÎ 
else
ÏÏ  
if
ÏÏ! #
(
ÏÏ$ %
content
ÏÏ% ,
is
ÏÏ- /
	BlockData
ÏÏ0 9
)
ÏÏ9 :
{
ĞĞ 

customTask
ÑÑ  *
.
ÑÑ* +
Type
ÑÑ+ /
=
ÑÑ0 1
$str
ÑÑ2 9
;
ÑÑ9 :

customTask
ÒÒ  *
.
ÒÒ* +
ContentIcon
ÒÒ+ 6
=
ÒÒ7 8
$str
ÒÒ9 D
;
ÒÒD E
if
ÔÔ  "
(
ÔÔ# $
!
ÔÔ$ %
string
ÔÔ% +
.
ÔÔ+ , 
IsNullOrWhiteSpace
ÔÔ, >
(
ÔÔ> ?

customTask
ÔÔ? I
.
ÔÔI J
ContentType
ÔÔJ U
)
ÔÔU V
&&
ÔÔW Y

customTask
ÔÔZ d
.
ÔÔd e
ContentType
ÔÔe p
.
ÔÔp q
Equals
ÔÔq w
(
ÔÔw x
$strÔÔx ˆ
)ÔÔˆ ‰
)ÔÔ‰ Š
{
ÕÕ  !

customTask
ÖÖ$ .
.
ÖÖ. /
Type
ÖÖ/ 3
=
ÖÖ4 5
$str
ÖÖ6 <
;
ÖÖ< =

customTask
××$ .
.
××. /
ContentIcon
××/ :
=
××; <
$str
××= C
;
××C D
}
ØØ  !
}
ÙÙ 
else
ÚÚ  
if
ÚÚ! #
(
ÚÚ$ %
content
ÚÚ% ,
is
ÚÚ- /
	ImageData
ÚÚ0 9
)
ÚÚ9 :
{
ÛÛ 

customTask
ÜÜ  *
.
ÜÜ* +
Type
ÜÜ+ /
=
ÜÜ0 1
$str
ÜÜ2 9
;
ÜÜ9 :

customTask
İİ  *
.
İİ* +
ContentIcon
İİ+ 6
=
İİ7 8
$str
İİ9 @
;
İİ@ A
}
ŞŞ 
else
ßß  
if
ßß! #
(
ßß$ %
content
ßß% ,
is
ßß- /
	MediaData
ßß0 9
)
ßß9 :
{
àà 

customTask
áá  *
.
áá* +
Type
áá+ /
=
áá0 1
$str
áá2 9
;
áá9 :

customTask
ââ  *
.
ââ* +
ContentIcon
ââ+ 6
=
ââ7 8
$str
ââ9 B
;
ââB C
if
ää  "
(
ää# $
!
ää$ %
string
ää% +
.
ää+ , 
IsNullOrWhiteSpace
ää, >
(
ää> ?

customTask
ää? I
.
ääI J
ContentType
ääJ U
)
ääU V
&&
ääW Y

customTask
ääZ d
.
ääd e
ContentType
ääe p
.
ääp q
Equals
ääq w
(
ääw x
$str
ääx 
)ää €
)ää€ 
{
åå  !

customTask
ææ$ .
.
ææ. /
Type
ææ/ 3
=
ææ4 5
$str
ææ6 =
;
ææ= >

customTask
çç$ .
.
çç. /
ContentIcon
çç/ :
=
çç; <
$str
çç= C
;
ççC D
}
èè  !
}
éé 
var
ëë +
enableContentApprovalDeadline
ëë  =
=
ëë> ?
model
ëë@ E
.
ëëE F0
"AddContentApprovalDeadlineProperty
ëëF h
;
ëëh i
var
ìì 
warningDays
ìì  +
=
ìì, -
_configuration
ìì. <
.
ìì< =
WarningDays
ìì= H
;
ììH I
if
îî 
(
îî  +
enableContentApprovalDeadline
îî  =
)
îî= >
{
ïï 
var
ññ  #
propertyData
ññ$ 0
=
ññ1 2
content
ññ3 :
.
ññ: ;
Property
ññ; C
.
ññC D
Get
ññD G
(
ññG H1
#ContentApprovalDeadlinePropertyName
ññH k
)
ññk l
??
ññm o
content
ññp w
.
ññw x
Propertyññx €
[ññ€ 3
#ContentApprovalDeadlinePropertyNameññ ¤
]ññ¤ ¥
;ññ¥ ¦
if
òò  "
(
òò# $
propertyData
òò$ 0
!=
òò1 3
null
òò4 8
)
òò8 9
{
óó  !
DateTime
ôô$ ,
.
ôô, -
TryParse
ôô- 5
(
ôô5 6
propertyData
ôô6 B
.
ôôB C
ToString
ôôC K
(
ôôK L
)
ôôL M
,
ôôM N
out
ôôO R
var
ôôS V
	dateValue
ôôW `
)
ôô` a
;
ôôa b
if
õõ$ &
(
õõ' (
	dateValue
õõ( 1
!=
õõ2 4
DateTime
õõ5 =
.
õõ= >
MinValue
õõ> F
&&
õõG I
!
õõJ K
string
õõK Q
.
õõQ R
IsNullOrEmpty
õõR _
(
õõ_ `

customTask
õõ` j
.
õõj k
Type
õõk o
)
õõo p
)
õõp q
{
öö$ %

customTask
÷÷( 2
.
÷÷2 3
Deadline
÷÷3 ;
=
÷÷< =
	dateValue
÷÷> G
;
÷÷G H
var
øø( +
days
øø, 0
=
øø1 2
DateTime
øø3 ;
.
øø; <
Now
øø< ?
.
øø? @
CountDaysInRange
øø@ P
(
øøP Q
	dateValue
øøQ Z
)
øøZ [
;
øø[ \
if
úú( *
(
úú+ ,
days
úú, 0
==
úú1 3
$num
úú4 5
)
úú5 6
{
ûû( )

customTask
üü, 6
.
üü6 7
WarningColor
üü7 C
=
üüD E
$str
üüF K
;
üüK L
}
ıı( )
else
şş( ,
if
şş- /
(
şş0 1
days
şş1 5
>
şş6 7
$num
şş8 9
&&
şş: <
days
şş= A
<
şşB C
warningDays
şşD O
)
şşO P
{
ÿÿ( )

customTask
€€, 6
.
€€6 7
WarningColor
€€7 C
=
€€D E
$str
€€F M
;
€€M N
}
( )
}
‚‚$ %
}
ƒƒ  !
}
„„ 
}
…… 

customTask
ˆˆ "
=
ˆˆ# $
await
ˆˆ% *"
_notificationHandler
ˆˆ+ ?
.
ˆˆ? @
GetNotifications
ˆˆ@ P
(
ˆˆP Q
id
ˆˆQ S
,
ˆˆS T

customTask
ˆˆU _
,
ˆˆ_ `
true
ˆˆa e
)
ˆˆe f
;
ˆˆf g
taskList
ŠŠ  
.
ŠŠ  !
Add
ŠŠ! $
(
ŠŠ$ %

customTask
ŠŠ% /
)
ŠŠ/ 0
;
ŠŠ0 1
}
‹‹ 
}
ŒŒ 
return
 
taskList
 
;
  
}
 
return
‘‘ 
new
‘‘ 
List
‘‘ 
<
‘‘ 
ContentTask
‘‘ '
>
‘‘' (
(
‘‘( )
)
‘‘) *
;
‘‘* +
}
’’ 	
private
”” 
async
”” 
Task
”” 
ApproveContent
”” )
(
””) *
string
””* 0
values
””1 7
,
””7 8
string
””9 ?
approvalComment
””@ O
,
””O P
bool
””Q U
publishContent
””V d
)
””d e
{
•• 	
if
–– 
(
–– 
!
–– 
string
–– 
.
–– 
IsNullOrEmpty
–– %
(
––% &
values
––& ,
)
––, -
)
––- .
{
—— 
var
˜˜ 
ids
˜˜ 
=
˜˜ 
values
˜˜  
.
˜˜  !
Split
˜˜! &
(
˜˜& '
new
˜˜' *
[
˜˜* +
]
˜˜+ ,
{
˜˜- .
$str
˜˜/ 2
}
˜˜3 4
,
˜˜4 5 
StringSplitOptions
˜˜6 H
.
˜˜H I 
RemoveEmptyEntries
˜˜I [
)
˜˜[ \
.
˜˜\ ]
Distinct
˜˜] e
(
˜˜e f
)
˜˜f g
.
˜˜g h
ToList
˜˜h n
(
˜˜n o
)
˜˜o p
;
˜˜p q
foreach
šš 
(
šš 
var
šš 
id
šš 
in
šš  "
ids
šš# &
)
šš& '
{
›› 
int
œœ 
.
œœ 
TryParse
œœ  
(
œœ  !
id
œœ! #
,
œœ# $
out
œœ% (
var
œœ) ,

approvalId
œœ- 7
)
œœ7 8
;
œœ8 9
if
 
(
 

approvalId
 "
!=
# %
$num
& '
)
' (
{
 
try
ŸŸ 
{
   
var
¡¡ 
approval
¡¡  (
=
¡¡) *
await
¡¡+ 0!
_approvalRepository
¡¡1 D
.
¡¡D E
GetAsync
¡¡E M
(
¡¡M N

approvalId
¡¡N X
)
¡¡X Y
;
¡¡Y Z
await
¢¢ !
_approvalEngine
¢¢" 1
.
¢¢1 2
ForceApproveAsync
¢¢2 C
(
¢¢C D

approvalId
¢¢D N
,
¢¢N O
PrincipalAccessor
¢¢P a
.
¢¢a b
Current
¢¢b i
.
¢¢i j
Identity
¢¢j r
?
¢¢r s
.
¢¢s t
Name
¢¢t x
,
¢¢x y
approvalComment¢¢z ‰
)¢¢‰ Š
;¢¢Š ‹
if
¤¤ 
(
¤¤  
approval
¤¤  (
is
¤¤) +
ContentApproval
¤¤, ;
contentApproval
¤¤< K
)
¤¤K L
{
¥¥  
_contentRepository
¦¦  2
.
¦¦2 3
TryGet
¦¦3 9
(
¦¦9 :
contentApproval
¦¦: I
.
¦¦I J
ContentLink
¦¦J U
,
¦¦U V
out
¦¦W Z
IContent
¦¦[ c
content
¦¦d k
)
¦¦k l
;
¦¦l m
var
§§  #
canUserPublish
§§$ 2
=
§§3 4
publishContent
§§5 C
&&
§§D F
_helper
§§G N
.
§§N O
CanUserPublish
§§O ]
(
§§] ^
content
§§^ e
)
§§e f
;
§§f g
if
¨¨  "
(
¨¨# $
content
¨¨$ +
!=
¨¨, .
null
¨¨/ 3
&&
¨¨4 6
canUserPublish
¨¨7 E
)
¨¨E F
{
©©  !
try
ªª$ '
{
««$ %
switch
­­( .
(
­­/ 0
content
­­0 7
)
­­7 8
{
®®( )
case
¯¯, 0
PageData
¯¯1 9
page
¯¯: >
:
¯¯> ?
{
°°0 1
var
±±4 7
clone
±±8 =
=
±±> ?
page
±±@ D
.
±±D E!
CreateWritableClone
±±E X
(
±±X Y
)
±±Y Z
;
±±Z [ 
_contentRepository
²²4 F
.
²²F G
Save
²²G K
(
²²K L
clone
²²L Q
,
²²Q R

SaveAction
²²S ]
.
²²] ^
Publish
²²^ e
,
²²e f
AccessLevel
²²g r
.
²²r s
Publish
²²s z
)
²²z {
;
²²{ |
break
³³4 9
;
³³9 :
}
´´0 1
case
µµ, 0
	BlockData
µµ1 :
block
µµ; @
:
µµ@ A
{
¶¶0 1
var
··4 7
clone
··8 =
=
··> ?
block
··@ E
.
··E F!
CreateWritableClone
··F Y
(
··Y Z
)
··Z [
as
··\ ^
IContent
··_ g
;
··g h 
_contentRepository
¸¸4 F
.
¸¸F G
Save
¸¸G K
(
¸¸K L
clone
¸¸L Q
,
¸¸Q R

SaveAction
¸¸S ]
.
¸¸] ^
Publish
¸¸^ e
,
¸¸e f
AccessLevel
¸¸g r
.
¸¸r s
Publish
¸¸s z
)
¸¸z {
;
¸¸{ |
break
¹¹4 9
;
¹¹9 :
}
ºº0 1
case
»», 0
	ImageData
»»1 :
image
»»; @
:
»»@ A
{
¼¼0 1
var
½½4 7
clone
½½8 =
=
½½> ?
image
½½@ E
.
½½E F!
CreateWritableClone
½½F Y
(
½½Y Z
)
½½Z [
as
½½\ ^
IContent
½½_ g
;
½½g h 
_contentRepository
¾¾4 F
.
¾¾F G
Save
¾¾G K
(
¾¾K L
clone
¾¾L Q
,
¾¾Q R

SaveAction
¾¾S ]
.
¾¾] ^
Publish
¾¾^ e
,
¾¾e f
AccessLevel
¾¾g r
.
¾¾r s
Publish
¾¾s z
)
¾¾z {
;
¾¾{ |
break
¿¿4 9
;
¿¿9 :
}
ÀÀ0 1
case
ÁÁ, 0
	MediaData
ÁÁ1 :
media
ÁÁ; @
:
ÁÁ@ A
{
ÂÂ0 1
var
ÃÃ4 7
clone
ÃÃ8 =
=
ÃÃ> ?
media
ÃÃ@ E
.
ÃÃE F!
CreateWritableClone
ÃÃF Y
(
ÃÃY Z
)
ÃÃZ [
as
ÃÃ\ ^
IContent
ÃÃ_ g
;
ÃÃg h 
_contentRepository
ÄÄ4 F
.
ÄÄF G
Save
ÄÄG K
(
ÄÄK L
clone
ÄÄL Q
,
ÄÄQ R

SaveAction
ÄÄS ]
.
ÄÄ] ^
Publish
ÄÄ^ e
,
ÄÄe f
AccessLevel
ÄÄg r
.
ÄÄr s
Publish
ÄÄs z
)
ÄÄz {
;
ÄÄ{ |
break
ÅÅ4 9
;
ÅÅ9 :
}
ÆÆ0 1
}
ÇÇ( )
}
ÈÈ$ %
catch
ÉÉ$ )
(
ÉÉ* +
	Exception
ÉÉ+ 4
ex
ÉÉ5 7
)
ÉÉ7 8
{
ÊÊ$ %
_logger
ËË( /
.
ËË/ 0
Error
ËË0 5
(
ËË5 6
$str
ËË6 y
+
ËËz {

approvalIdËË| †
+ËË‡ ˆ
$strËË‰ ™
+ËËš ›
contentApprovalËËœ «
.ËË« ¬
ContentLinkËË¬ ·
.ËË· ¸
IDËË¸ º
,ËËº »
exËË¼ ¾
)ËË¾ ¿
;ËË¿ À
}
ÌÌ$ %
}
ÍÍ  !
}
ÎÎ 
}
ÏÏ 
catch
ĞĞ 
(
ĞĞ 
	Exception
ĞĞ (
ex
ĞĞ) +
)
ĞĞ+ ,
{
ÑÑ 
_logger
ÒÒ #
.
ÒÒ# $
Error
ÒÒ$ )
(
ÒÒ) *
$str
ÒÒ* ^
+
ÒÒ_ `

approvalId
ÒÒa k
,
ÒÒk l
ex
ÒÒm o
)
ÒÒo p
;
ÒÒp q
}
ÓÓ 
}
ÔÔ 
}
ÕÕ 
}
ÖÖ 
}
×× 	
private
ÙÙ 
async
ÙÙ 
Task
ÙÙ 
<
ÙÙ 
List
ÙÙ 
<
ÙÙ  
ContentTask
ÙÙ  +
>
ÙÙ+ ,
>
ÙÙ, -$
GetChangeApprovalTasks
ÙÙ. D
(
ÙÙD E'
AdvancedTaskIndexViewData
ÙÙE ^
model
ÙÙ_ d
)
ÙÙd e
{
ÚÚ 	
var
ÛÛ 
query
ÛÛ 
=
ÛÛ 
new
ÛÛ 
ApprovalQuery
ÛÛ )
{
ÜÜ 
Status
İİ 
=
İİ 
ApprovalStatus
İİ '
.
İİ' (
InReview
İİ( 0
,
İİ0 1
	Reference
ŞŞ 
=
ŞŞ 
new
ŞŞ 
Uri
ŞŞ  #
(
ŞŞ# $
$str
ŞŞ$ 5
)
ŞŞ5 6
}
ßß 
;
ßß 
var
áá 
roles
áá 
=
áá 
await
áá 
_helper
áá %
.
áá% &
GetUserRoles
áá& 2
(
áá2 3
)
áá3 4
;
áá4 5
if
ââ 
(
ââ 
!
ââ 
roles
ââ 
.
ââ 
Contains
ââ 
(
ââ  
Roles
ââ  %
.
ââ% &
Administrators
ââ& 4
)
ââ4 5
&&
ââ6 8
!
ââ9 :
roles
ââ: ?
.
ââ? @
Contains
ââ@ H
(
ââH I
Roles
ââI N
.
ââN O
	WebAdmins
ââO X
)
ââX Y
&&
ââZ \
!
ãã 
roles
ãã 
.
ãã 
Contains
ãã 
(
ãã  
Roles
ãã  %
.
ãã% &
	CmsAdmins
ãã& /
)
ãã/ 0
)
ãã0 1
{
ää 
query
åå 
.
åå 
Username
åå 
=
åå  
PrincipalAccessor
åå! 2
.
åå2 3
Current
åå3 :
.
åå: ;
Identity
åå; C
?
ååC D
.
ååD E
Name
ååE I
;
ååI J
}
ææ 
var
èè 
list
èè 
=
èè 
await
èè !
_approvalRepository
èè 0
.
èè0 1
	ListAsync
èè1 :
(
èè: ;
query
èè; @
,
èè@ A
(
èèB C
model
èèC H
.
èèH I

PageNumber
èèI S
-
èèT U
$num
èèV W
)
èèW X
*
èèY Z
model
èè[ `
.
èè` a
PageSize
èèa i
,
èèi j
model
èèk p
.
èèp q
PageSize
èèq y
)
èèy z
;
èèz {
model
éé 
.
éé 
TotalItemsCount
éé !
=
éé" #
Convert
éé$ +
.
éé+ ,
ToInt32
éé, 3
(
éé3 4
list
éé4 8
.
éé8 9

TotalCount
éé9 C
)
ééC D
;
ééD E
var
ëë 
taskList
ëë 
=
ëë 
new
ëë 
List
ëë #
<
ëë# $
ContentTask
ëë$ /
>
ëë/ 0
(
ëë0 1
)
ëë1 2
;
ëë2 3
foreach
íí 
(
íí 
var
íí 
task
íí 
in
íí  
list
íí! %
.
íí% &
PagedResult
íí& 1
)
íí1 2
{
îî 
IContent
ïï 
content
ïï  
=
ïï! "
null
ïï# '
;
ïï' (
var
ğğ 
id
ğğ 
=
ğğ 
task
ğğ 
.
ğğ 
ID
ğğ  
.
ğğ  !
ToString
ğğ! )
(
ğğ) *
)
ğğ* +
;
ğğ+ ,
var
òò 

customTask
òò 
=
òò  
new
òò! $
ContentTask
òò% 0
{
óó 

ApprovalId
ôô 
=
ôô  
task
ôô! %
.
ôô% &
ID
ôô& (
,
ôô( )
DateTime
õõ 
=
õõ 
task
õõ #
.
õõ# $
ActiveStepStarted
õõ$ 5
,
õõ5 6
	StartedBy
öö 
=
öö 
task
öö  $
.
öö$ %
	StartedBy
öö% .
,
öö. /
URL
÷÷ 
=
÷÷ 
new
÷÷ 
ContentReference
÷÷ .
(
÷÷. /
task
÷÷/ 3
.
÷÷3 4
ID
÷÷4 6
)
÷÷6 7
.
÷÷7 8

GetEditUrl
÷÷8 B
(
÷÷B C
)
÷÷C D
.
÷÷D E
Replace
÷÷E L
(
÷÷L M
$str
÷÷M \
,
÷÷\ ]
$str
÷÷^ p
)
÷÷p q
}
øø 
;
øø 
if
úú 
(
úú 
!
úú 
(
úú 
task
úú 
is
úú 
ContentApproval
úú -
)
úú- .
)
úú. /
{
ûû 
var
ıı 
taskDetails
ıı #
=
ıı$ %
_changeTaskHelper
ıı& 7
.
ıı7 8
GetData
ıı8 ?
(
ıı? @
task
ıı@ D
.
ııD E
ID
ııE G
)
ııG H
;
ııH I
if
ÿÿ 
(
ÿÿ 
taskDetails
ÿÿ #
!=
ÿÿ$ &
null
ÿÿ' +
)
ÿÿ+ ,
{
€€ 

customTask
 "
.
" #
Type
# '
=
( )
taskDetails
* 5
.
5 6
Type
6 :
;
: ;

customTask
‚‚ "
.
‚‚" #
ContentName
‚‚# .
=
‚‚/ 0
taskDetails
‚‚1 <
.
‚‚< =
Name
‚‚= A
;
‚‚A B

customTask
ƒƒ "
.
ƒƒ" #
Details
ƒƒ# *
=
ƒƒ+ ,
taskDetails
ƒƒ- 8
.
ƒƒ8 9
Details
ƒƒ9 @
;
ƒƒ@ A
}
„„ 
if
†† 
(
†† 
task
†† 
.
†† 
	Reference
†† &
!=
††' )
null
††* .
&&
††/ 1
!
††2 3
string
††3 9
.
††9 :
IsNullOrEmpty
††: G
(
††G H
task
††H L
.
††L M
	Reference
††M V
.
††V W
AbsolutePath
††W c
)
††c d
)
††d e
{
‡‡ 
var
ˆˆ 
pageId
ˆˆ "
=
ˆˆ# $
task
ˆˆ% )
.
ˆˆ) *
	Reference
ˆˆ* 3
.
ˆˆ3 4
AbsolutePath
ˆˆ4 @
.
ˆˆ@ A
Replace
ˆˆA H
(
ˆˆH I
$str
ˆˆI L
,
ˆˆL M
$str
ˆˆN P
)
ˆˆP Q
;
ˆˆQ R
int
ŠŠ 
.
ŠŠ 
TryParse
ŠŠ $
(
ŠŠ$ %
pageId
ŠŠ% +
,
ŠŠ+ ,
out
ŠŠ- 0
var
ŠŠ1 4
	contentId
ŠŠ5 >
)
ŠŠ> ?
;
ŠŠ? @
if
‹‹ 
(
‹‹ 
	contentId
‹‹ %
!=
‹‹& (
$num
‹‹) *
)
‹‹* +
{
ŒŒ  
_contentRepository
 .
.
. /
TryGet
/ 5
(
5 6
new
6 9
ContentReference
: J
(
J K
	contentId
K T
)
T U
,
U V
out
W Z
content
[ b
)
b c
;
c d
}
 
}
 
if
‘‘ 
(
‘‘ 
content
‘‘ 
!=
‘‘  "
null
‘‘# '
)
‘‘' (
{
’’ 

customTask
““ "
.
““" #
ContentReference
““# 3
=
““4 5
content
““6 =
.
““= >
ContentLink
““> I
;
““I J

customTask
”” "
.
””" #
ContentType
””# .
=
””/ 0
GetTypeContent
””1 ?
(
””? @
content
””@ G
)
””G H
;
””H I
}
•• 

customTask
—— 
=
——  
await
——! &"
_notificationHandler
——' ;
.
——; <
GetNotifications
——< L
(
——L M
id
——M O
,
——O P

customTask
——Q [
,
——[ \
false
——] b
)
——b c
;
——c d
taskList
™™ 
.
™™ 
Add
™™  
(
™™  !

customTask
™™! +
)
™™+ ,
;
™™, -
}
šš 
}
›› 
return
 
taskList
 
;
 
}
 	
private
   
async
   
Task
   

AbortTasks
   %
(
  % &
List
  & *
<
  * +
int
  + .
>
  . /
ids
  0 3
)
  3 4
{
¡¡ 	
await
¢¢ 
_approvalEngine
¢¢ !
.
¢¢! "

AbortAsync
¢¢" ,
(
¢¢, -
ids
¢¢- 0
,
¢¢0 1
PrincipalAccessor
¢¢2 C
.
¢¢C D
Current
¢¢D K
.
¢¢K L
Identity
¢¢L T
?
¢¢T U
.
¢¢U V
Name
¢¢V Z
)
¢¢Z [
;
¢¢[ \
}
££ 	
private
¥¥ 
string
¥¥ 
GetTypeContent
¥¥ %
(
¥¥% &
IContent
¥¥& .
content
¥¥/ 6
)
¥¥6 7
{
¦¦ 	
var
§§ 
contentName
§§ 
=
§§ 
$str
§§  
;
§§  !
var
©© 
contentType
©© 
=
©© $
_contentTypeRepository
©© 4
.
©©4 5
Load
©©5 9
(
©©9 :
content
©©: A
.
©©A B
GetType
©©B I
(
©©I J
)
©©J K
.
©©K L
BaseType
©©L T
)
©©T U
;
©©U V
if
«« 
(
«« 
contentType
«« 
!=
«« 
null
«« #
)
««# $
{
¬¬ 
contentName
­­ 
=
­­ 
contentType
­­ )
.
­­) *
DisplayName
­­* 5
;
­­5 6
}
®® 
else
¯¯ 
{
°° 
contentType
±± 
=
±± $
_contentTypeRepository
±± 4
.
±±4 5
Load
±±5 9
(
±±9 :
content
±±: A
.
±±A B
GetType
±±B I
(
±±I J
)
±±J K
)
±±K L
;
±±L M
if
³³ 
(
³³ 
contentType
³³ 
!=
³³  "
null
³³# '
)
³³' (
{
´´ 
if
µµ 
(
µµ 
!
µµ 
string
µµ 
.
µµ  
IsNullOrEmpty
µµ  -
(
µµ- .
contentType
µµ. 9
.
µµ9 :
DisplayName
µµ: E
)
µµE F
)
µµF G
contentName
¶¶ #
=
¶¶$ %
contentType
¶¶& 1
.
¶¶1 2
DisplayName
¶¶2 =
;
¶¶= >
else
·· 
if
·· 
(
·· 
!
·· 
string
·· $
.
··$ %
IsNullOrEmpty
··% 2
(
··2 3
contentType
··3 >
.
··> ?
Name
··? C
)
··C D
)
··D E
contentName
¸¸ #
=
¸¸$ %
contentType
¸¸& 1
.
¸¸1 2
Name
¸¸2 6
;
¸¸6 7
}
¹¹ 
}
ºº 
if
¼¼ 
(
¼¼ 
string
¼¼ 
.
¼¼  
IsNullOrWhiteSpace
¼¼ )
(
¼¼) *
contentName
¼¼* 5
)
¼¼5 6
)
¼¼6 7
{
½½ 
var
¾¾ 

memberInfo
¾¾ 
=
¾¾  
content
¾¾! (
.
¾¾( )
GetType
¾¾) 0
(
¾¾0 1
)
¾¾1 2
.
¾¾2 3
BaseType
¾¾3 ;
;
¾¾; <
if
¿¿ 
(
¿¿ 

memberInfo
¿¿ 
!=
¿¿ !
null
¿¿" &
)
¿¿& '
{
ÀÀ 
contentName
ÁÁ 
=
ÁÁ  !"
_localizationService
ÁÁ" 6
.
ÁÁ6 7
	GetString
ÁÁ7 @
(
ÁÁ@ A
$str
ÁÁA Q
+
ÁÁR S

memberInfo
ÁÁT ^
.
ÁÁ^ _
Name
ÁÁ_ c
.
ÁÁc d
ToLower
ÁÁd k
(
ÁÁk l
)
ÁÁl m
+
ÁÁn o
$str
ÁÁp w
,
ÁÁw x 
FallbackBehaviorsÁÁy Š
.ÁÁŠ ‹
FallbackCultureÁÁ‹ š
)ÁÁš ›
;ÁÁ› œ
}
ÂÂ 
}
ÃÃ 
if
ÅÅ 
(
ÅÅ 
!
ÅÅ 
string
ÅÅ 
.
ÅÅ  
IsNullOrWhiteSpace
ÅÅ *
(
ÅÅ* +
contentName
ÅÅ+ 6
)
ÅÅ6 7
&&
ÅÅ8 :
contentName
ÅÅ; F
.
ÅÅF G
Contains
ÅÅG O
(
ÅÅO P
$str
ÅÅP _
)
ÅÅ_ `
)
ÅÅ` a
{
ÆÆ 
contentName
ÇÇ 
=
ÇÇ 
$str
ÇÇ  
;
ÇÇ  !
}
ÈÈ 
return
ÊÊ 
contentName
ÊÊ 
;
ÊÊ 
}
ËË 	
private
ÍÍ 
List
ÍÍ 
<
ÍÍ "
LanguageBranchOption
ÍÍ )
>
ÍÍ) *
LanguageBranches
ÍÍ+ ;
(
ÍÍ; <
string
ÍÍ< B
language
ÍÍC K
)
ÍÍK L
{
ÎÎ 	
var
ÏÏ 
toReturn
ÏÏ 
=
ÏÏ 
new
ÏÏ 
List
ÏÏ #
<
ÏÏ# $"
LanguageBranchOption
ÏÏ$ 8
>
ÏÏ8 9
(
ÏÏ9 :
)
ÏÏ: ;
;
ÏÏ; <
var
ĞĞ 
enabledLanguages
ĞĞ  
=
ĞĞ! "'
_languageBranchRepository
ĞĞ# <
.
ĞĞ< =
ListEnabled
ĞĞ= H
(
ĞĞH I
)
ĞĞI J
;
ĞĞJ K
var
ÑÑ 
firstEnabled
ÑÑ 
=
ÑÑ '
_languageBranchRepository
ÑÑ 8
.
ÑÑ8 9$
LoadFirstEnabledBranch
ÑÑ9 O
(
ÑÑO P
)
ÑÑP Q
;
ÑÑQ R
foreach
ÓÓ 
(
ÓÓ 
var
ÓÓ 
languageBranch
ÓÓ '
in
ÓÓ( *
enabledLanguages
ÓÓ+ ;
)
ÓÓ; <
{
ÔÔ 
var
ÕÕ "
languageBranchOption
ÕÕ (
=
ÕÕ) *
new
ÕÕ+ ."
LanguageBranchOption
ÕÕ/ C
{
ÖÖ 
Language
×× 
=
×× 
languageBranch
×× -
,
××- .
Selected
ØØ 
=
ØØ 
false
ØØ $
}
ÙÙ 
;
ÙÙ 
if
ÛÛ 
(
ÛÛ 
!
ÛÛ 
string
ÛÛ 
.
ÛÛ 
IsNullOrEmpty
ÛÛ )
(
ÛÛ) *
language
ÛÛ* 2
)
ÛÛ2 3
)
ÛÛ3 4
{
ÜÜ "
languageBranchOption
İİ (
.
İİ( )
Selected
İİ) 1
=
İİ2 3
languageBranch
İİ4 B
.
İİB C

LanguageID
İİC M
.
İİM N
Equals
İİN T
(
İİT U
language
İİU ]
,
İİ] ^
StringComparison
İİ_ o
.
İİo p 
OrdinalIgnoreCaseİİp 
)İİ ‚
;İİ‚ ƒ
}
ŞŞ 
else
ßß 
if
ßß 
(
ßß 
!
ßß 
ContentReference
ßß *
.
ßß* +
IsNullOrEmpty
ßß+ 8
(
ßß8 9
ContentReference
ßß9 I
.
ßßI J
	StartPage
ßßJ S
)
ßßS T
)
ßßT U
{
àà  
_contentRepository
áá &
.
áá& '
TryGet
áá' -
<
áá- .
IContent
áá. 6
>
áá6 7
(
áá7 8
ContentReference
áá8 H
.
ááH I
	StartPage
ááI R
,
ááR S
languageBranch
ááT b
.
ááb c
Culture
áác j
,
ááj k
out
áál o
var
ááp s
	startPage
áát }
)
áá} ~
;
áá~ 
if
ãã 
(
ãã 
	startPage
ãã !
!=
ãã" $
null
ãã% )
&&
ãã* ,
	startPage
ãã- 6
.
ãã6 7$
IsMasterLanguageBranch
ãã7 M
(
ããM N
)
ããN O
)
ããO P
{
ää "
languageBranchOption
åå ,
.
åå, -
Selected
åå- 5
=
åå6 7
true
åå8 <
;
åå< =
}
ææ 
else
çç 
if
çç 
(
çç 
firstEnabled
çç )
.
çç) *

LanguageID
çç* 4
==
çç5 7
languageBranch
çç8 F
.
ççF G

LanguageID
ççG Q
)
ççQ R
{
èè "
languageBranchOption
éé ,
.
éé, -
Selected
éé- 5
=
éé6 7
true
éé8 <
;
éé< =
}
ëë 
}
ìì 
else
íí 
if
íí 
(
íí 
firstEnabled
íí %
.
íí% &

LanguageID
íí& 0
==
íí1 3
languageBranch
íí4 B
.
ííB C

LanguageID
ííC M
)
ííM N
{
îî "
languageBranchOption
ïï (
.
ïï( )
Selected
ïï) 1
=
ïï2 3
true
ïï4 8
;
ïï8 9
}
ğğ 
toReturn
òò 
.
òò 
Add
òò 
(
òò "
languageBranchOption
òò 1
)
òò1 2
;
òò2 3
}
óó 
return
õõ 
toReturn
õõ 
;
õõ 
}
öö 	
}
÷÷ 
}øø Ã]
}C:\Projects\adnanzameer\AdvancedTaskManager\net6.0\src\AdvancedTaskManager\Features\AdvancedTask\AdvancedTaskIndexViewData.cs
	namespace		 	
AdvancedTaskManager		
 
.		 
Features		 &
.		& '
AdvancedTask		' 3
{

 
public 

class %
AdvancedTaskIndexViewData *
{ 
public %
AdvancedTaskIndexViewData (
(( )
List) -
<- . 
LanguageBranchOption. B
>B C
languageBranchListD V
,V W&
AdvancedTaskManagerOptionsX r
configuration	s €
)
€ 
{ 	
LanguageBranchList 
=  
languageBranchList! 3
;3 4 
SelectedLanguageText  
=! "
$str# +
;+ ,
if 
( 
languageBranchList "
!=# %
null& *
&&+ -
languageBranchList. @
.@ A
AnyA D
(D E
)E F
)F G
{ 
var 
selectedLanguage $
=% &
languageBranchList' 9
.9 :
FirstOrDefault: H
(H I
xI J
=>K M
xN O
.O P
SelectedP X
)X Y
;Y Z
if 
( 
selectedLanguage $
?$ %
.% &
Language& .
!=/ 1
null2 6
)6 7
{  
SelectedLanguageText (
=) *
selectedLanguage+ ;
.; <
Language< D
.D E
NameE I
;I J
} 
} 
HasPublishAccess 
= 
false $
;$ %
ContentTaskList 
= 
new !
List" &
<& '
ContentTask' 2
>2 3
(3 4
)4 5
;5 6

PageNumber 
= 
$num 
; .
"AddContentApprovalDeadlineProperty   .
=  / 0
!  1 2
configuration  2 ?
.  ? @1
%DeleteContentApprovalDeadlineProperty  @ e
&&  f h
configuration  i v
.  v w/
"AddContentApprovalDeadlineProperty	  w ™
;
  ™ š
PageSize"" 
="" 
configuration"" $
.""$ %
PageSize""% -
is"". 0
>""1 2
$num""3 4
and""5 8
<=""9 ;
$num""< ?
?""@ A
configuration""B O
.""O P
PageSize""P X
:""Y Z
$num""[ ]
;""] ^
DateTimeFormat$$ 
=$$  
!$$! "
string$$" (
.$$( )
IsNullOrEmpty$$) 6
($$6 7
configuration$$7 D
.$$D E
DateTimeFormat$$E S
)$$S T
&&$$U W
DateTime$$X `
.$$` a
TryParseExact$$a n
($$n o
DateTime%% 
.%% 
UtcNow%% 
.%%  
ToString%%  (
(%%( )
CultureInfo%%) 4
.%%4 5
InvariantCulture%%5 E
)%%E F
,%%F G
configuration%%H U
.%%U V
DateTimeFormat%%V d
,%%d e
CultureInfo&& 
.&& 
InvariantCulture&& ,
,&&, -
DateTimeStyles&&. <
.&&< =
None&&= A
,&&A B
out&&C F
_&&G H
)&&H I
?'' 
configuration'' 
.''  
DateTimeFormat''  .
:(( 
$str(( $
;(($ %&
DateTimeFormatUserFriendly** &
=**' (
!**) *
string*** 0
.**0 1
IsNullOrEmpty**1 >
(**> ?
configuration**? L
.**L M&
DateTimeFormatUserFriendly**M g
)**g h
&&**i k
DateTime++) 1
.++1 2
TryParseExact++2 ?
(++? @
DateTime++@ H
.++H I
UtcNow++I O
.++O P
ToString++P X
(++X Y
CultureInfo++Y d
.++d e
InvariantCulture++e u
)++u v
,++v w
configuration,,- :
.,,: ;&
DateTimeFormatUserFriendly,,; U
,,,U V
CultureInfo,,W b
.,,b c
InvariantCulture,,c s
,,,s t
DateTimeStyles--- ;
.--; <
None--< @
,--@ A
out--B E
_--F G
)--G H
?.. 
configuration.. 
...  &
DateTimeFormatUserFriendly..  :
:// 
$str// ,
;//, -
}00 	
public22 
string22 
DateTimeFormat22 $
{22% &
get22' *
;22* +
set22, /
;22/ 0
}221 2
public44 
string44 &
DateTimeFormatUserFriendly44 0
{441 2
get443 6
;446 7
set448 ;
;44; <
}44= >
public66 
IEnumerable66 
<66 
int66 
>66 
Pages66  %
{77 	
get88 
{99 
var:: 
list2:: 
=:: 
new:: 
List::  $
<::$ %
int::% (
>::( )
{::* +
$num::, -
}::. /
;::/ 0
var;; 
list;; 
=;; 
list2;;  
;;;  !
if<< 
(<< 

PageNumber<< 
-<<  
PageSize<<! )
-<<* +
$num<<, -
><<. /
$num<<0 1
)<<1 2
{== 
list>> 
.>> 
Add>> 
(>> 
$num>> 
)>> 
;>>  
}?? 
for@@ 
(@@ 
var@@ 
i@@ 
=@@ 

PageNumber@@ '
-@@( )
PageSize@@* 2
;@@2 3
i@@4 5
<=@@6 8

PageNumber@@9 C
+@@D E
PageSize@@F N
;@@N O
i@@P Q
++@@Q S
)@@S T
{AA 
ifBB 
(BB 
iBB 
>BB 
$numBB 
&&BB  
iBB! "
<BB# $
TotalPagesCountBB% 4
)BB4 5
{CC 
listDD 
.DD 
AddDD  
(DD  !
iDD! "
)DD" #
;DD# $
}EE 
}FF 
ifGG 
(GG 

PageNumberGG 
+GG  
PageSizeGG! )
+GG* +
$numGG, -
<GG. /
TotalPagesCountGG0 ?
)GG? @
{HH 
listII 
.II 
AddII 
(II 
$numII 
)II 
;II  
}JJ 
ifKK 
(KK 
TotalPagesCountKK #
>KK$ %
$numKK& '
)KK' (
{LL 
listMM 
.MM 
AddMM 
(MM 
TotalPagesCountMM ,
)MM, -
;MM- .
}NN 
returnOO 
listOO 
;OO 
}PP 
}QQ 	
publicSS 
intSS 
TotalPagesCountSS "
=>SS# %
(SS& '
TotalItemsCountSS' 6
-SS7 8
$numSS9 :
)SS: ;
/SS< =
PageSizeSS> F
+SSG H
$numSSI J
;SSJ K
publicUU 
intUU 
MaxIndexOfItemUU !
{VV 	
getWW 
{XX 
ifYY 
(YY 

PageNumberYY 
*YY  
PageSizeYY! )
<=YY* ,
TotalItemsCountYY- <
)YY< =
{ZZ 
return[[ 

PageNumber[[ %
*[[& '
PageSize[[( 0
;[[0 1
}\\ 
return^^ 
TotalItemsCount^^ &
;^^& '
}__ 
}`` 	
publicbb 
intbb 
MinIndexOfItembb !
{cc 	
getdd 
{ee 
ifff 
(ff 
TotalItemsCountff #
<=ff$ &
$numff' (
)ff( )
{gg 
returnhh 
$numhh 
;hh 
}ii 
returnkk 
(kk 

PageNumberkk "
-kk# $
$numkk% &
)kk& '
*kk( )
PageSizekk* 2
+kk3 4
$numkk5 6
;kk6 7
}ll 
}mm 	
publicoo 
intoo 
PageSizeoo 
{oo 
getoo !
;oo! "
setoo# &
;oo& '
}oo( )
publicqq 
intqq 

PageNumberqq 
{qq 
getqq  #
;qq# $
setqq% (
;qq( )
}qq* +
publicss 
Listss 
<ss 
ContentTaskss 
>ss  
ContentTaskListss! 0
{ss1 2
getss3 6
;ss6 7
setss8 ;
;ss; <
}ss= >
publicuu 
intuu 
TotalItemsCountuu "
{uu# $
getuu% (
;uu( )
setuu* -
;uu- .
}uu/ 0
publicww 
boolww 
HasPublishAccessww $
{ww% &
getww' *
;ww* +
setww, /
;ww/ 0
}ww1 2
publicyy 
stringyy 

TaskValuesyy  
{yy! "
getyy# &
;yy& '
setyy( +
;yy+ ,
}yy- .
public{{ 
string{{ 
QueryString{{ !
{{{" #
get{{$ '
;{{' (
set{{) ,
;{{, -
}{{. /
public}} 
string}} 
PageUrl}} 
(}} 
int}} !
page}}" &
)}}& '
{~~ 	
var 
qs 
= 
HttpUtility  
.  !
ParseQueryString! 1
(1 2
QueryString2 =
)= >
;> ?
qs
€€ 
[
€€ 
$str
€€ 
]
€€ 
=
€€ 
page
€€ 
.
€€ 
ToString
€€ &
(
€€& '
)
€€' (
;
€€( )
return
 
$"
 
$str
 
{
 
qs
 
}
 
"
 
;
 
}
‚‚ 	
public
„„ 
string
„„ 
LanguageUrl
„„ !
(
„„! "
string
„„" (
language
„„) 1
)
„„1 2
{
…… 	
var
†† 
qs
†† 
=
†† 
HttpUtility
††  
.
††  !
ParseQueryString
††! 1
(
††1 2
QueryString
††2 =
)
††= >
;
††> ?
qs
‡‡ 
[
‡‡ 
$str
‡‡ 
]
‡‡ 
=
‡‡ 
language
‡‡ %
;
‡‡% &
return
ˆˆ 
$"
ˆˆ 
$str
ˆˆ 
{
ˆˆ 
qs
ˆˆ 
}
ˆˆ 
"
ˆˆ 
;
ˆˆ 
}
‰‰ 	
public
‹‹ 
bool
‹‹ 0
"AddContentApprovalDeadlineProperty
‹‹ 6
{
‹‹7 8
get
‹‹9 <
;
‹‹< =
set
‹‹> A
;
‹‹A B
}
‹‹C D
public
 
List
 
<
 "
LanguageBranchOption
 (
>
( ) 
LanguageBranchList
* <
{
= >
get
? B
;
B C
set
D G
;
G H
}
I J
public
 
string
 "
SelectedLanguageText
 *
{
+ ,
get
- 0
;
0 1
set
2 5
;
5 6
}
7 8
}
 
public
’’ 

class
’’ "
LanguageBranchOption
’’ %
{
““ 
public
”” 
LanguageBranch
”” 
Language
”” &
{
””' (
get
””) ,
;
””, -
set
””. 1
;
””1 2
}
””3 4
public
•• 
bool
•• 
Selected
•• 
{
•• 
get
•• "
;
••" #
set
••$ '
;
••' (
}
••) *
}
–– 
}—— Ğ
pC:\Projects\adnanzameer\AdvancedTaskManager\net6.0\src\AdvancedTaskManager\Features\AdvancedTask\ApprovalData.cs
	namespace 	
AdvancedTaskManager
 
. 
Features &
.& '
AdvancedTask' 3
{ 
public 

class 
ApprovalData 
{ 
public 
string 

TaskValues  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 
string 
ApprovalComment %
{& '
get( +
;+ ,
set- 0
;0 1
}2 3
public 
bool 
PublishContent "
{# $
get% (
;( )
set* -
;- .
}/ 0
} 
}		 «	
tC:\Projects\adnanzameer\AdvancedTaskManager\net6.0\src\AdvancedTaskManager\Features\AdvancedTask\ChangeTaskDetail.cs
	namespace 	
AdvancedTaskManager
 
. 
Features &
.& '
AdvancedTask' 3
{ 
public 

class 
ChangeTaskDetail !
{ 
public 
ChangeTaskDetail 
(  
)  !
{		 	
Details

 
=

 
new

 
List

 
<

 !
IContentChangeDetails

 4
>

4 5
(

5 6
)

6 7
;

7 8
} 	
public 
IEnumerable 
< !
IContentChangeDetails 0
>0 1
Details2 9
{: ;
get< ?
;? @
setA D
;D E
}F G
public 
string 
Type 
{ 
get  
;  !
set" %
;% &
}' (
public 
string 
Name 
{ 
get  
;  !
set" %
;% &
}' (
} 
} Ë
wC:\Projects\adnanzameer\AdvancedTaskManager\net6.0\src\AdvancedTaskManager\Features\AdvancedTask\ChangeTaskViewModel.cs
	namespace 	
AdvancedTaskManager
 
. 
Features &
.& '
AdvancedTask' 3
{ 
public 

class 
ChangeTaskViewModel $
{ 
public 
string 
Id 
{ 
get 
; 
set  #
;# $
}% &
public

 
string

 
Name

 
{

 
get

  
;

  !
set

" %
;

% &
}

' (
public 
int 

ApprovalID 
{ 
get  #
;# $
set% (
;( )
}* +
public 
ContentReference  
AppliedOnContentLink  4
{ 	
get 
=> 
ContentReference #
.# $
TryParse$ ,
(, -
AppliedOnContent- =
,= >
out? B
varC F
resultG M
)M N
?O P
resultQ W
:X Y
ContentReferenceZ j
.j k
EmptyReferencek y
;y z
set 
=> 
AppliedOnContent #
=$ %
ContentReference& 6
.6 7
IsNullOrEmpty7 D
(D E
valueE J
)J K
?L M
stringN T
.T U
EmptyU Z
:[ \
value] b
.b c%
ToReferenceWithoutVersionc |
(| }
)} ~
.~ 
ToString	 ‡
(
‡ ˆ
)
ˆ ‰
;
‰ Š
} 	
public 
string 
AppliedOnContent &
{' (
get) ,
;, -
set. 1
;1 2
}3 4
public 
string 
CurrentSettingsJson )
{* +
get, /
;/ 0
set1 4
;4 5
}6 7
public 
string 
NewSettingsJson %
{& '
get( +
;+ ,
set- 0
;0 1
}2 3
public 
string 
	CreatedBy 
{  !
get" %
;% &
set' *
;* +
}, -
public 
string 
	ChangedBy 
{  !
get" %
;% &
set' *
;* +
}, -
public 
DateTime 
Saved 
{ 
get  #
;# $
set% (
;( )
}* +
public   
bool   

CanExecute   
{    
get  ! $
;  $ %
set  & )
;  ) *
}  + ,
public"" 
string"" #
AppliedOnLanguageBranch"" -
{"". /
get""0 3
;""3 4
set""5 8
;""8 9
}"": ;
public$$ 
int$$ 
Status$$ 
{$$ 
get$$ 
;$$  
set$$! $
;$$$ %
}$$& '
public&& 
string&& 
TypeIdentifier&& $
{&&% &
get&&' *
;&&* +
set&&, /
;&&/ 0
}&&1 2
public(( 
bool(( 1
%IsCurrentUserInActiveStepReviewerList(( 9
{((: ;
get((< ?
;((? @
set((A D
;((D E
}((F G
public** 
bool** 
IsCommandDataValid** &
{**' (
get**) ,
;**, -
set**. 1
;**1 2
}**3 4
public,, 
bool,, %
CanUserActOnHisOwnChanges,, -
{,,. /
get,,0 3
;,,3 4
set,,5 8
;,,8 9
},,: ;
}-- 
}.. Ó
oC:\Projects\adnanzameer\AdvancedTaskManager\net6.0\src\AdvancedTaskManager\Features\AdvancedTask\ContentTask.cs
	namespace 	
AdvancedTaskManager
 
. 
Features &
.& '
AdvancedTask' 3
{ 
public 

class 
ContentTask 
{		 
public

 
ContentTask

 
(

 
)

 
{ 	
ContentReference 
= 
ContentReference /
./ 0
EmptyReference0 >
;> ?
ContentName 
= 
$str 
; 
ContentType 
= 
$str 
; 
Type 
= 
$str 
; 
DateTime 
= 
null 
; 
Deadline 
= 
null 
; 
	StartedBy 
= 
$str 
; 
WarningColor 
= 
$str 
; 
Details 
= 
new 
List 
< !
IContentChangeDetails 4
>4 5
(5 6
)6 7
;7 8
URL 
= 
$str 
; 
} 	
public 
int 

ApprovalId 
{ 
get  #
;# $
set% (
;( )
}* +
public 
ContentReference 
ContentReference  0
{1 2
get3 6
;6 7
set8 ;
;; <
}= >
public 
string 
ContentName !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 
string 
ContentIcon !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 
string 
ContentType !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 
string 
Type 
{ 
get  
;  !
set" %
;% &
}' (
public 
DateTime 
? 
DateTime !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 
DateTime 
? 
Deadline !
{" #
get$ '
;' (
set) ,
;, -
}. /
public   
string   
	StartedBy   
{    !
get  " %
;  % &
set  ' *
;  * +
}  , -
public!! 
string!! 
WarningColor!! "
{!!# $
get!!% (
;!!( )
set!!* -
;!!- .
}!!/ 0
public"" 
bool"" 
NotificationUnread"" &
{""' (
get"") ,
;"", -
set"". 1
;""1 2
}""3 4
public## 
bool## 
CanUserPublish## "
{### $
get##% (
;##( )
set##* -
;##- .
}##/ 0
public$$ 
string$$ 
URL$$ 
{$$ 
get$$ 
;$$  
set$$! $
;$$$ %
}$$& '
public%% 
IEnumerable%% 
<%% !
IContentChangeDetails%% 0
>%%0 1
Details%%2 9
{%%: ;
get%%< ?
;%%? @
set%%A D
;%%D E
}%%F G
}&& 
}'' ¾
qC:\Projects\adnanzameer\AdvancedTaskManager\net6.0\src\AdvancedTaskManager\Features\AdvancedTask\MovingPayLoad.cs
	namespace 	
AdvancedTaskManager
 
. 
Features &
.& '
AdvancedTask' 3
{ 
public 

class 
MovingPayLoad 
{ 
public 
ContentReference 
Source  &
{' (
get) ,
;, -
set. 1
;1 2
}3 4
public		 
ContentReference		 
Destination		  +
{		, -
get		. 1
;		1 2
set		3 6
;		6 7
}		8 9
}

 
} Ö
tC:\Projects\adnanzameer\AdvancedTaskManager\net6.0\src\AdvancedTaskManager\Features\Container\ContainerController.cs
	namespace 	
AdvancedTaskManager
 
. 
Features &
.& '
	Container' 0
{ 
public 

class 
ContainerController $
:% &

Controller' 1
{ 
[		 	
	Authorize			 
(		 
Policy		 
=		 
	Constants		 %
.		% &

PolicyName		& 0
)		0 1
]		1 2
[

 	
HttpGet

	 
]

 
public 
IActionResult 
Index "
(" #
)# $
{ 	
return 
View 
( 
) 
; 
} 	
} 
} Ô"
ƒC:\Projects\adnanzameer\AdvancedTaskManager\net6.0\src\AdvancedTaskManager\Infrastructure\Cms\ChangeApproval\ApprovalCommandBase.cs
	namespace 	
AdvancedTaskManager
 
. 
Infrastructure ,
., -
Cms- 0
.0 1
ChangeApproval1 ?
{ 
public		 

abstract		 
class		 
ApprovalCommandBase		 -
:		. /
IDynamicData		0 <
{

 
private 
bool 
_isReadOnly  
;  !
public 
virtual 
Identity 
Id  "
{# $
get% (
;( )
set* -
;- .
}/ 0
public 
int 

ApprovalID 
{ 
get  #
;# $
set% (
;( )
}* +
public 
int !
LastApprovalStepIndex (
{) *
get+ .
;. /
set0 3
;3 4
}5 6
[ 	
Ignore	 
] 
public 
ContentReference  
AppliedOnContentLink  4
{ 	
get 
=> 
ContentReference #
.# $
TryParse$ ,
(, -
AppliedOnContent- =
,= >
out? B
varC F
resultG M
)M N
?O P
resultQ W
:X Y
ContentReferenceZ j
.j k
EmptyReferencek y
;y z
set 
=> 
AppliedOnContent #
=$ %
ContentReference& 6
.6 7
IsNullOrEmpty7 D
(D E
valueE J
)J K
?L M
stringN T
.T U
EmptyU Z
:[ \
value] b
.b c%
ToReferenceWithoutVersionc |
(| }
)} ~
.~ 
ToString	 ‡
(
‡ ˆ
)
ˆ ‰
;
‰ Š
} 	
public 
string 
AppliedOnContent &
{' (
get) ,
;, -
set. 1
;1 2
}3 4
public 
string 
CurrentSettingsJson )
{* +
get, /
;/ 0
set1 4
;4 5
}6 7
public 
string 
NewSettingsJson %
{& '
get( +
;+ ,
set- 0
;0 1
}2 3
public   
CommandMetaData   
.   $
ChangeTaskApprovalStatus   7
CommandStatus  8 E
{  F G
get  H K
;  K L
set  M P
;  P Q
}  R S
public"" 
string"" 
	CreatedBy"" 
{""  !
get""" %
;""% &
set""' *
;""* +
}"", -
public$$ 
string$$ 
	ChangedBy$$ 
{$$  !
get$$" %
;$$% &
set$$' *
;$$* +
}$$, -
public&& 
DateTime&& 
CreatedTime&& #
{&&$ %
get&&& )
;&&) *
set&&+ .
;&&. /
}&&0 1
public(( 
DateTime(( 
Saved(( 
{(( 
get((  #
;((# $
set((% (
;((( )
}((* +
public** 
bool** 

IsReadOnly** 
{++ 	
get,, 
=>,, 
_isReadOnly,, 
;,, 
	protected-- 
set-- 
=>-- 
_isReadOnly-- (
=--) *
value--+ 0
;--0 1
}.. 	
public00 
virtual00 
bool00 
IsValid00 #
(00# $
)00$ %
{11 	
return22 
true22 
;22 
}33 	
public55 
object55 
CreateWritableClone55 )
(55) *
)55* +
{66 	
var77 
approvalCommandBase77 #
=77$ %
(77& '
ApprovalCommandBase77' :
)77: ;
MemberwiseClone77; J
(77J K
)77K L
;77L M
approvalCommandBase88 
.88  
_isReadOnly88  +
=88, -
false88. 3
;883 4
return99 
approvalCommandBase99 &
;99& '
}:: 	
}<< 
}== Ë
C:\Projects\adnanzameer\AdvancedTaskManager\net6.0\src\AdvancedTaskManager\Infrastructure\Cms\ChangeApproval\ApprovalCommandRepositoryBase.cs
	namespace 	
AdvancedTaskManager
 
. 
Infrastructure ,
., -
Cms- 0
.0 1
ChangeApproval1 ?
{ 
public 

	interface *
IApprovalCommandRepositoryBase 3
{ 
ApprovalCommandBase 
GetByCommandId *
<* +
T+ ,
>, -
(- .
Guid. 2
id3 5
,5 6
string7 =
type> B
)B C
whereD I
TJ K
:L M
ApprovalCommandBaseN a
;a b
}		 
public 

class )
ApprovalCommandRepositoryBase .
:/ 0*
IApprovalCommandRepositoryBase1 O
{ 
private 
readonly 1
%ChangeApprovalDynamicDataStoreFactory >2
&_changeApprovalDynamicDataStoreFactory? e
;e f
public )
ApprovalCommandRepositoryBase ,
(, -1
%ChangeApprovalDynamicDataStoreFactory- R1
%changeApprovalDynamicDataStoreFactoryS x
)x y
{ 	2
&_changeApprovalDynamicDataStoreFactory 2
=3 41
%changeApprovalDynamicDataStoreFactory5 Z
;Z [
} 	
public 
ApprovalCommandBase "
GetByCommandId# 1
<1 2
T2 3
>3 4
(4 5
Guid5 9
id: <
,< =
string> D
typeE I
)I J
whereK P
TQ R
:S T
ApprovalCommandBaseU h
{ 	
var 
store 
= 2
&_changeApprovalDynamicDataStoreFactory >
.> ?
GetStore? G
(G H
typeH L
)L M
;M N
var 
obj 
= 
store 
? 
. 
Items "
<" #
T# $
>$ %
(% &
)& '
.' (
FirstOrDefault( 6
(6 7
x7 8
=>9 ;
x< =
.= >
Id> @
.@ A

ExternalIdA K
==L N
idO Q
)Q R
;R S
return 
obj 
; 
} 	
} 
} ½
~C:\Projects\adnanzameer\AdvancedTaskManager\net6.0\src\AdvancedTaskManager\Infrastructure\Cms\ChangeApproval\ChangeApproval.cs
	namespace 	
AdvancedTaskManager
 
. 
Infrastructure ,
., -
Cms- 0
.0 1
ChangeApproval1 ?
{ 
public 

class 
ChangeApproval 
:  !
Approval" *
{		 
private

 
ContentReference

  
_contentLink

! -
;

- .
public 
override 
Uri 
	Reference %
=>& ()
ChangeApprovalReferenceHelper) F
.F G
GetUriG M
(M N
_contentLinkN Z
,Z [
false\ a
)a b
;b c
public 
ContentReference 
ContentLink  +
{ 	
get 
=> 
_contentLink 
;  
set 
{ 
ThrowIfReadOnly 
(  
)  !
;! "
_contentLink 
= 
value $
;$ %
} 
} 	
public 
override 
Approval  
CreateWritableClone! 4
(4 5
)5 6
{ 	
var 
writableClone 
= 
base  $
.$ %
CreateWritableClone% 8
(8 9
)9 :
as; =
ChangeApproval> L
;L M
var 
contentLink 
= 
_contentLink *
;* +
if 
( 
writableClone 
!=  
null! %
)% &
{ 
writableClone 
. 
_contentLink *
=+ ,
contentLink- 8
!=9 ;
null< @
?   
contentLink   !
.  ! "
CreateWritableClone  " 5
(  5 6
)  6 7
:!! 
null!! 
;!! 
return"" 
writableClone"" $
;""$ %
}## 
return%% 
null%% 
;%% 
}&& 	
}'' 
}(( 
•C:\Projects\adnanzameer\AdvancedTaskManager\net6.0\src\AdvancedTaskManager\Infrastructure\Cms\ChangeApproval\ChangeApprovalDynamicDataStoreFactory.cs
	namespace 	
AdvancedTaskManager
 
. 
Infrastructure ,
., -
Cms- 0
.0 1
ChangeApproval1 ?
{ 
[  
ServiceConfiguration 
( 
	Lifecycle #
=$ % 
ServiceInstanceScope& :
.: ;
	Singleton; D
)D E
]E F
public 

class 1
%ChangeApprovalDynamicDataStoreFactory 6
{ 
public		 
DynamicDataStore		 
GetStore		  (
(		( )
string		) /
name		0 4
)		4 5
{

 	
return #
DynamicDataStoreFactory *
.* +
Instance+ 3
.3 4
GetStore4 <
(< =
name= A
)A B
;B C
} 	
} 
} ·
‰C:\Projects\adnanzameer\AdvancedTaskManager\net6.0\src\AdvancedTaskManager\Infrastructure\Cms\ChangeApproval\ChangeApprovalTypeFactory.cs
	namespace 	
AdvancedTaskManager
 
. 
Infrastructure ,
., -
Cms- 0
.0 1
ChangeApproval1 ?
{ 
public 

class %
ChangeApprovalTypeFactory *
:+ , 
IApprovalTypeFactory- A
{ 
public		 
static		 
readonly		 
string		 %
ChangeApprovalType		& 8
=		9 :
$str		; K
;		K L
private

 
readonly

 0
$IApprovalDefinitionReferenceResolver

 =&
_approvalReferenceResolver

> X
;

X Y
public %
ChangeApprovalTypeFactory (
(( )0
$IApprovalDefinitionReferenceResolver) M%
approvalReferenceResolverN g
)g h
{ 	&
_approvalReferenceResolver &
=' (%
approvalReferenceResolver) B
;B C
} 	
public 
string 
ApprovalType "
=># %
ChangeApprovalType& 8
;8 9
public 0
$IApprovalDefinitionReferenceResolver 3'
DefinitionReferenceResolver4 O
=>P R&
_approvalReferenceResolverS m
;m n
public %
IApprovalLanguageResolver (
LanguageResolver) 9
=>: <
null= A
;A B
public 
Approval 
CreateApproval &
(& '
Uri' *
	reference+ 4
)4 5
{ 	
return 
new 
ChangeApproval %
{ 
ContentLink 
= )
ChangeApprovalReferenceHelper ;
.; <
GetContentReference< O
(O P
	referenceP Y
)Y Z
} 
; 
} 	
public 
ApprovalDefinition !$
CreateApprovalDefinition" :
(: ;
Uri; >
	reference? H
)H I
{   	
throw!! 
new!! !
NotSupportedException!! +
(!!+ ,
$str!!, o
)!!o p
;!!p q
}"" 	
}## 
}$$ Ò
C:\Projects\adnanzameer\AdvancedTaskManager\net6.0\src\AdvancedTaskManager\Infrastructure\Cms\ChangeApproval\CommandMetaData.cs
	namespace 	
AdvancedTaskManager
 
. 
Infrastructure ,
., -
Cms- 0
.0 1
ChangeApproval1 ?
{ 
[ 
EPiServerDataStore 
( #
AutomaticallyRemapStore /
=0 1
true2 6
)6 7
]7 8
public		 

class		 
CommandMetaData		  
:		! "
IDynamicData		# /
{

 
private 
bool 
_isReadOnly  
;  !
public 
Identity 
Id 
{ 
get  
;  !
set" %
;% &
}' (
[ 	
EPiServerDataIndex	 
] 
public 
int 

ApprovalId 
{ 
get  #
;# $
set% (
;( )
}* +
public 
string 
Type 
{ 
get  
;  !
set" %
;% &
}' (
[ 	
EPiServerDataIndex	 
] 
public 
Guid 
	CommandId 
{ 
get  #
;# $
set% (
;( )
}* +
[ 	
EPiServerDataIndex	 
] 
public 
ContentReference 
AppliedOnContent  0
{1 2
get3 6
;6 7
set8 ;
;; <
}= >
public $
ChangeTaskApprovalStatus '
CommandStatus( 5
{6 7
get8 ;
;; <
set= @
;@ A
}B C
public 
enum $
ChangeTaskApprovalStatus ,
{ 	
InReview 
, 
Approved   
}!! 	
public## 
bool## 

IsReadOnly## 
{$$ 	
get%% 
=>%% 
_isReadOnly%% 
;%% 
	protected&& 
set&& 
=>&& 
_isReadOnly&& (
=&&) *
value&&+ 0
;&&0 1
}'' 	
public)) 
void)) 
MakeReadOnly))  
())  !
)))! "
{** 	
_isReadOnly++ 
=++ 
true++ 
;++ 
},, 	
public.. 
object.. 
CreateWritableClone.. )
(..) *
)..* +
{// 	
var00 
commandMetaData00 
=00  !
(00" #
CommandMetaData00# 2
)002 3
MemberwiseClone003 B
(00B C
)00C D
;00D E
commandMetaData11 
.11 
_isReadOnly11 '
=11( )
false11* /
;11/ 0
return22 
commandMetaData22 "
;22" #
}33 	
}44 
}55 š
zC:\Projects\adnanzameer\AdvancedTaskManager\net6.0\src\AdvancedTaskManager\Infrastructure\Cms\ChangeApproval\ContentACL.cs
	namespace 	
AdvancedTaskManager
 
. 
Infrastructure ,
., -
Cms- 0
.0 1
ChangeApproval1 ?
{ 
public 

class 

ContentACL 
{ 
public 
IEnumerable 
< 
AccessControlEntry -
>- .
Entries/ 6
{7 8
get9 <
;< =
set> A
;A B
}C D
public

 
bool

 
IsInherited

 
{

  !
get

" %
;

% &
set

' *
;

* +
}

, -
} 
} ¶
„C:\Projects\adnanzameer\AdvancedTaskManager\net6.0\src\AdvancedTaskManager\Infrastructure\Cms\ChangeApproval\ContentChangeDetails.cs
	namespace 	
AdvancedTaskManager
 
. 
Infrastructure ,
., -
Cms- 0
.0 1
ChangeApproval1 ?
{ 
public 

class  
ContentChangeDetails %
:& '!
IContentChangeDetails( =
{ 
public 
string 
Name 
{ 
get  
;  !
set" %
;% &
}' (
public 
object 
OldValue 
{  
get! $
;$ %
set& )
;) *
}+ ,
public		 
object		 
NewValue		 
{		  
get		! $
;		$ %
set		& )
;		) *
}		+ ,
}

 
} ›(
C:\Projects\adnanzameer\AdvancedTaskManager\net6.0\src\AdvancedTaskManager\Infrastructure\Cms\ChangeApproval\DefaultCommandMetaDataRepository.cs
	namespace 	
AdvancedTaskManager
 
. 
Infrastructure ,
., -
Cms- 0
.0 1
ChangeApproval1 ?
{ 
[  
ServiceConfiguration 
( 
ServiceType %
=& '
typeof( .
(. /&
ICommandMetaDataRepository/ I
)I J
)J K
]K L
public		 

class		 ,
 DefaultCommandMetaDataRepository		 1
:		2 3&
ICommandMetaDataRepository		4 N
{

 
private 
static 
readonly 
object  &
Lock' +
=, -
new. 1
(1 2
)2 3
;3 4
private 
readonly 1
%ChangeApprovalDynamicDataStoreFactory >2
&_changeApprovalDynamicDataStoreFactory? e
;e f
public ,
 DefaultCommandMetaDataRepository /
(/ 01
%ChangeApprovalDynamicDataStoreFactory
 /1
%changeApprovalDynamicDataStoreFactory0 U
)U V
{ 	2
&_changeApprovalDynamicDataStoreFactory 2
=3 41
%changeApprovalDynamicDataStoreFactory5 Z
;Z [
} 	
public 
CommandMetaData 
GetByApprovalId .
(. /
int/ 2

approvalId3 =
)= >
{ 	
var 
store 
= 2
&_changeApprovalDynamicDataStoreFactory >
.> ?
GetStore? G
(G H
$str	H €
)
€ 
;
 ‚
if 
( 
store 
== 
null 
) 
return 
null 
; 
lock 
( 
Lock 
) 
{ 
return 
store 
. 
Items "
<" #
CommandMetaData# 2
>2 3
(3 4
)4 5
.5 6
SingleOrDefault6 E
(E F
(F G

ExpressionG Q
<Q R
FuncR V
<V W
CommandMetaDataW f
,f g
boolh l
>l m
>m n
)n o
(o p
commandp w
=>x z
command	{ ‚
.
‚ ƒ

ApprovalId
ƒ 
==
 

approvalId
‘ ›
)
› œ
)
œ 
;
 
} 
} 	
public   
CommandMetaData   
GetByCommandId   -
(  - .
Guid  . 2
	commandId  3 <
)  < =
{!! 	
var"" 
store"" 
="" 2
&_changeApprovalDynamicDataStoreFactory"" >
.""> ?
GetStore""? G
(""G H
$str	""H €
)
""€ 
;
"" ‚
if## 
(## 
store## 
==## 
null## 
)## 
return$$ 
null$$ 
;$$ 
lock%% 
(%% 
Lock%% 
)%% 
{&& 
var'' 
commandMetaData'' #
=''$ %
store''& +
.''+ ,
Items'', 1
<''1 2
CommandMetaData''2 A
>''A B
(''B C
)''C D
.''D E
SingleOrDefault''E T
(''T U
(''U V

Expression''V `
<''` a
Func''a e
<''e f
CommandMetaData''f u
,''u v
bool''w {
>''{ |
>''| }
)''} ~
(''~ 
command	'' †
=>
''‡ ‰
command
''Š ‘
.
''‘ ’
	CommandId
''’ ›
==
''œ 
	commandId
''Ÿ ¨
)
''¨ ©
)
''© ª
;
''ª «
return(( 
commandMetaData(( &
;((& '
})) 
}** 	
public-- 
Guid-- 
Save-- 
(-- 
CommandMetaData-- (
commandMetaData--) 8
)--8 9
{.. 	
var// 
store// 
=// 2
&_changeApprovalDynamicDataStoreFactory// >
.//> ?
GetStore//? G
(//G H
$str	//H €
)
//€ 
;
// ‚
if00 
(00 
store00 
==00 
null00 
)00 
return11 
Guid11 
.11 
Empty11 !
;11! "
lock22 
(22 
Lock22 
)22 
{33 
var44 
identity44 
=44 
store44 $
.44$ %
Save44% )
(44) *
commandMetaData44* 9
)449 :
;44: ;
return55 
identity55 
==55  "
null55# '
?55( )
Guid55* .
.55. /
Empty55/ 4
:555 6
identity557 ?
.55? @

ExternalId55@ J
;55J K
}66 
}77 	
}88 
}99 Ì,
‡C:\Projects\adnanzameer\AdvancedTaskManager\net6.0\src\AdvancedTaskManager\Infrastructure\Cms\ChangeApproval\ExpirationChangeDetails.cs
	namespace 	
AdvancedTaskManager
 
. 
Infrastructure ,
., -
Cms- 0
.0 1
ChangeApproval1 ?
{ 
public		 

	interface		 $
IExpirationChangeDetails		 -
{

 
IEnumerable 
< !
IContentChangeDetails )
>) *-
!GetExpirationCommandChangeDetails+ L
(L M
ChangeTaskViewModelM `
modela f
)f g
;g h
} 
public 

class #
ExpirationChangeDetails (
:) *$
IExpirationChangeDetails+ C
{ 
private 
readonly 
ILogger  
_logger! (
;( )
public #
ExpirationChangeDetails &
(& '
)' (
{ 	
_logger 
= 

LogManager  
.  !
	GetLogger! *
(* +
typeof+ 1
(1 2#
ExpirationChangeDetails2 I
)I J
)J K
;K L
} 	
public 
IEnumerable 
< !
IContentChangeDetails 0
>0 1-
!GetExpirationCommandChangeDetails2 S
(S T
ChangeTaskViewModelT g
modelh m
)m n
{ 	
var !
interceptPropertyList %
=& '
new( +
List, 0
<0 1
string1 7
>7 8
(8 9
)9 :
{; <
$str= N
,N O
$strP a
}b c
;c d
var $
contentChangeDetailsList (
=) *
new+ .
List/ 3
<3 4!
IContentChangeDetails4 I
>I J
(J K
)K L
;L M
try 
{ 
var 
dictionary1 
=  !
JsonConvert" -
.- .
DeserializeObject. ?
<? @
IDictionary@ K
<K L
stringL R
,R S
objectT Z
>Z [
>[ \
(\ ]
model] b
.b c
CurrentSettingsJsonc v
)v w
;w x
var 
dictionary2 
=  !
JsonConvert" -
.- .
DeserializeObject. ?
<? @
IDictionary@ K
<K L
stringL R
,R S
objectT Z
>Z [
>[ \
(\ ]
model] b
.b c
NewSettingsJsonc r
)r s
;s t
foreach   
(   
var   
interceptProperty   .
in  / 1!
interceptPropertyList  2 G
)  G H
{!! 
if"" 
("" 
dictionary1"" #
.""# $
ContainsKey""$ /
(""/ 0
interceptProperty""0 A
)""A B
)""B C
{## 
var$$ 
oldValue$$ $
=$$% &
dictionary1$$' 2
[$$2 3
interceptProperty$$3 D
]$$D E
;$$E F
var%% 
newValue%% $
=%%% &
dictionary2%%' 2
[%%2 3
interceptProperty%%3 D
]%%D E
;%%E F
var'' 
item''  
=''! "
new''# & 
ContentChangeDetails''' ;
{(( 
Name))  
=))! "+
GetExpirationDateSettingCommand))# B
())B C
interceptProperty))C T
.))T U
ToLowerInvariant))U e
())e f
)))f g
)))g h
,))h i
OldValue** $
=**% &
oldValue**' /
is**0 2
DateTime**3 ;
oldValueDateTime**< L
?++  !
oldValueDateTime++" 2
.++2 3
ToString++3 ;
(++; <
$str++< V
)++V W
:,,  !
oldValue,," *
,,,* +
NewValue-- $
=--% &
newValue--' /
is--0 2
DateTime--3 ;
newValueDateTime--< L
?..  !
newValueDateTime.." 2
...2 3
ToString..3 ;
(..; <
$str..< V
)..V W
://  !
newValue//" *
}00 
;00 $
contentChangeDetailsList22 0
.220 1
Add221 4
(224 5
item225 9
)229 :
;22: ;
}33 
}44 
}55 
catch66 
(66 
	Exception66 
ex66 
)66  
{77 
_logger88 
.88 
Error88 
(88 
ex88  
.88  !
Message88! (
,88( )
ex88* ,
)88, -
;88- .
}99 
return:: $
contentChangeDetailsList:: +
;::+ ,
};; 	
static== 
string== +
GetExpirationDateSettingCommand== 5
(==5 6
string==6 <
interceptProperty=== N
)==N O
{>> 	
switch?? 
(?? 
interceptProperty?? %
.??% &
ToLowerInvariant??& 6
(??6 7
)??7 8
)??8 9
{@@ 
caseAA 
$strAA &
:AA& '
returnBB 
$strBB '
;BB' (
caseCC 
$strCC &
:CC& '
returnDD 
$strDD ,
;DD, -
defaultEE 
:EE 
returnFF 
$strFF >
;FF> ?
}GG 
}HH 	
}II 
}JJ ¤$
ŒC:\Projects\adnanzameer\AdvancedTaskManager\net6.0\src\AdvancedTaskManager\Infrastructure\Cms\ChangeApproval\ExpirationDateSettingCommand.cs
	namespace 	
AdvancedTaskManager
 
. 
Infrastructure ,
., -
Cms- 0
.0 1
ChangeApproval1 ?
{ 
[ 
EPiServerDataStore 
( #
AutomaticallyRemapStore /
=0 1
true2 6
)6 7
]7 8
public 

class (
ExpirationDateSettingCommand -
:. /
ApprovalCommandBase0 C
,C D+
ICultureSpecificApprovalCommandE d
{ 
private 
Injected 
< 
IContentLoader '
>' (
_contentLoader) 7
;7 8
public 
string #
AppliedOnLanguageBranch -
{. /
get0 3
;3 4
set5 8
;8 9
}: ;
private 
static 
readonly 
ILogger  '
Logger( .
=/ 0

LogManager1 ;
.; <
	GetLogger< E
(E F
typeofF L
(L M(
ExpirationDateSettingCommandM i
)i j
)j k
;k l
public 
override 
bool 
IsValid $
($ %
)% &
{ 	
try 
{ 
var 

dictionary 
=  
JsonConvert! ,
., -
DeserializeObject- >
<> ?
IDictionary? J
<J K
stringK Q
,Q R
objectS Y
>Y Z
>Z [
([ \
NewSettingsJson\ k
)k l
;l m
var 
versionable 
=  !
(" #
string# )
.) *
IsNullOrEmpty* 7
(7 8#
AppliedOnLanguageBranch8 O
)O P
?Q R
_contentLoaderS a
.a b
Serviceb i
.i j
Getj m
<m n
IContentn v
>v w
(w x!
AppliedOnContentLink	x Œ
)
Œ 
:
 
_contentLoader
 
.
 Ÿ
Service
Ÿ ¦
.
¦ §
Get
§ ª
<
ª «
IContent
« ³
>
³ ´
(
´ µ"
AppliedOnContentLink
µ É
,
É Ê
new
Ë Î
CultureInfo
Ï Ú
(
Ú Û%
AppliedOnLanguageBranch
Û ò
)
ò ó
)
ó ô
)
ô õ
as
ö ø
IVersionable
ù …
;
… †
if 
( 

dictionary 
. 
TryGetValue *
(* +
$str+ <
,< =
out> A
varB E
objF I
)I J
&&K M
objN Q
isR T
DateTimeU ]
nullable^ f
&&g i
versionablej u
!=v x
nully }
)} ~
{ 
var 
startPublish $
=% &
versionable' 2
.2 3
StartPublish3 ?
;? @
if 
( 
startPublish $
.$ %
HasValue% -
)- .
{ 
ref 
var 
local2  &
=' (
ref) ,
nullable- 5
;5 6
startPublish   $
=  % &
versionable  ' 2
.  2 3
StartPublish  3 ?
;  ? @
if!! 
(!! 
startPublish!! (
!=!!) +
null!!, 0
)!!0 1
{"" 
var## 
	dateTime2##  )
=##* +
startPublish##, 8
.##8 9
Value##9 >
;##> ?
if$$ 
($$  
local2$$  &
.$$& '
	CompareTo$$' 0
($$0 1
	dateTime2$$1 :
)$$: ;
<$$< =
$num$$> ?
)$$? @
return%%  &
false%%' ,
;%%, -
}&& 
}'' 
}(( 
return)) 
true)) 
;)) 
}** 
catch++ 
(++ 
	Exception++ 
ex++ 
)++  
{,, 
Logger-- 
.-- 
Error-- 
(-- 
ex-- 
.--  
Message--  '
,--' (
ex--) +
)--+ ,
;--, -
return.. 
false.. 
;.. 
}// 
}00 	
}11 
}22 î
ŠC:\Projects\adnanzameer\AdvancedTaskManager\net6.0\src\AdvancedTaskManager\Infrastructure\Cms\ChangeApproval\ICommandMetaDataRepository.cs
	namespace 	
AdvancedTaskManager
 
. 
Infrastructure ,
., -
Cms- 0
.0 1
ChangeApproval1 ?
{ 
public 

	interface &
ICommandMetaDataRepository /
{ 
CommandMetaData 
GetByApprovalId '
(' (
int( +

approvalId, 6
)6 7
;7 8
CommandMetaData 
GetByCommandId &
(& '
Guid' +
	commandId, 5
)5 6
;6 7
Guid		 
Save		 
(		 
CommandMetaData		 !
commandMetaData		" 1
)		1 2
;		2 3
}

 
} Î
…C:\Projects\adnanzameer\AdvancedTaskManager\net6.0\src\AdvancedTaskManager\Infrastructure\Cms\ChangeApproval\IContentChangeDetails.cs
	namespace 	
AdvancedTaskManager
 
. 
Infrastructure ,
., -
Cms- 0
.0 1
ChangeApproval1 ?
{ 
public 

	interface !
IContentChangeDetails *
{ 
string 
Name 
{ 
get 
; 
set 
; 
}  !
object 
OldValue 
{ 
get 
; 
set "
;" #
}$ %
object		 
NewValue		 
{		 
get		 
;		 
set		 "
;		" #
}		$ %
}

 
} å
C:\Projects\adnanzameer\AdvancedTaskManager\net6.0\src\AdvancedTaskManager\Infrastructure\Cms\ChangeApproval\ICultureSpecificApprovalCommand.cs
	namespace 	
AdvancedTaskManager
 
. 
Infrastructure ,
., -
Cms- 0
.0 1
ChangeApproval1 ?
{ 
public 

	interface +
ICultureSpecificApprovalCommand 4
{ 
string #
AppliedOnLanguageBranch &
{' (
get) ,
;, -
set. 1
;1 2
}3 4
} 
} ËÕ
…C:\Projects\adnanzameer\AdvancedTaskManager\net6.0\src\AdvancedTaskManager\Infrastructure\Cms\ChangeApproval\LanguageChangeDetails.cs
	namespace 	
AdvancedTaskManager
 
. 
Infrastructure ,
., -
Cms- 0
.0 1
ChangeApproval1 ?
{ 
public 

	interface "
ILanguageChangeDetails +
{ 
IEnumerable 
< !
IContentChangeDetails )
>) *$
GetLanguageChangeDetails+ C
(C D
ChangeTaskViewModelD W
commandX _
)_ `
;` a
} 
public 

class !
LanguageChangeDetails &
:' ("
ILanguageChangeDetails) ?
{ 
private 
const 
string 
ArrowSeparator +
=, -
$str. 3
;3 4
private 
const 
string 
CommaSeparator +
=, -
$str. 2
;2 3
private 
readonly %
ILanguageBranchRepository 2%
_languageBranchRepository3 L
;L M
private 
readonly +
IContentLanguageSettingsHandler 8+
_contentLanguageSettingsHandler9 X
;X Y
private 
readonly 
IContentRepository +
_contentRepository, >
;> ?
public !
LanguageChangeDetails $
($ %%
ILanguageBranchRepository% >$
languageBranchRepository? W
,W X+
IContentLanguageSettingsHandlerY x+
contentLanguageSettingsHandler	y —
,
— ˜ 
IContentRepository
™ «
contentRepository
¬ ½
)
½ ¾
{ 	%
_languageBranchRepository %
=& '$
languageBranchRepository( @
;@ A+
_contentLanguageSettingsHandler +
=, -*
contentLanguageSettingsHandler. L
;L M
_contentRepository   
=    
contentRepository  ! 2
;  2 3
}!! 	
public%% 
IEnumerable%% 
<%% !
IContentChangeDetails%% 0
>%%0 1$
GetLanguageChangeDetails%%2 J
(%%J K
ChangeTaskViewModel%%K ^
command%%_ f
)%%f g
{&& 	
var'' $
contentChangeDetailsList'' (
='') *
new''+ .
List''/ 3
<''3 4!
IContentChangeDetails''4 I
>''I J
(''J K
)''K L
;''L M
var(( 
parent(( 
=(( 
	GetParent(( "
(((" #
command((# *
.((* + 
AppliedOnContentLink((+ ?
)((? @
;((@ A
var)) 
settingsFromJson1)) !
=))" #.
"GetContentLanguageSettingsFromJson))$ F
())F G
command))G N
.))N O
CurrentSettingsJson))O b
)))b c
;))c d
var** 
settingsFromJson2** !
=**" #.
"GetContentLanguageSettingsFromJson**$ F
(**F G
command**G N
.**N O
NewSettingsJson**O ^
)**^ _
;**_ `
var++ 
flag++ 
=++ 
!++ 
ContentReference++ (
.++( )
IsNullOrEmpty++) 6
(++6 7
parent++7 =
)++= >
;++> ?
var,, 

dictionary,, 
=,, 
(,, 
(,, 
settingsFromJson2,, 0
==,,1 3
null,,4 8
?,,9 :
$num,,; <
:,,= >
settingsFromJson2,,? P
.,,P Q
Count,,Q V
==,,W Y
$num,,Z [
?,,\ ]
$num,,^ _
:,,` a
$num,,b c
),,c d
&,,e f
(,,g h
flag,,h l
?,,m n
$num,,o p
:,,q r
$num,,s t
),,t u
),,u v
!=,,w y
$num,,z {
?,,| } 
GetLanguageSettings	,,~ ‘
(
,,‘ ’
parent
,,’ ˜
)
,,˜ ™
:
,,š ›
settingsFromJson2
,,œ ­
;
,,­ ®
if-- 
(-- 
flag-- 
)-- 
{.. 
var// 
str1// 
=// 
$str//  
;//  !
var00 
str200 
=00 
$str00 
;00  $
contentChangeDetailsList11 (
.11( )
Add11) ,
(11, -
new11- 0 
ContentChangeDetails111 E
(11E F
)11F G
{22 
Name33 
=33 
$str33 B
,33B C
OldValue44 
=44 
settingsFromJson144 0
.440 1
Values441 7
.447 8
Any448 ;
(44; <
st44< >
=>44? A
st44B D
.44D E
DefinedOnContent44E U
.44U V!
CompareToIgnoreWorkID44V k
(44k l
command44l s
.44s t!
AppliedOnContentLink	44t ˆ
)
44ˆ ‰
)
44‰ Š
?
44‹ Œ
str2
44 ‘
:
44’ “
str1
44” ˜
,
44˜ ™
NewValue55 
=55 

dictionary55 )
!=55* ,
null55- 1
&&552 4

dictionary555 ?
.55? @
Values55@ F
.55F G
Any55G J
(55J K
st55K M
=>55N P
st55Q S
.55S T
DefinedOnContent55T d
.55d e!
CompareToIgnoreWorkID55e z
(55z {
command	55{ ‚
.
55‚ ƒ"
AppliedOnContentLink
55ƒ —
)
55— ˜
)
55˜ ™
?
55š ›
str2
55œ  
:
55¡ ¢
str1
55£ §
}66 
)66 
;66 
}77 
var88 
currentLanguages88  
=88! "
settingsFromJson188# 4
.884 5
Where885 :
(88: ;
s88; <
=>88= ?
s88@ A
.88A B
Value88B G
.88G H
IsActive88H P
)88P Q
.88Q R
Select88R X
(88X Y
s88Y Z
=>88[ ]
s88^ _
.88_ `
Value88` e
.88e f
LanguageBranch88f t
)88t u
.88u v
ToList88v |
(88| }
)88} ~
;88~ 
if99 
(99 

dictionary99 
!=99 
null99 "
)99" #
{:: 
var;; 
newLanguages;;  
=;;! "

dictionary;;# -
.;;- .
Where;;. 3
(;;3 4
s;;4 5
=>;;6 8
s;;9 :
.;;: ;
Value;;; @
.;;@ A
IsActive;;A I
);;I J
.;;J K
Select;;K Q
(;;Q R
s;;R S
=>;;T V
s;;W X
.;;X Y
Value;;Y ^
.;;^ _
LanguageBranch;;_ m
);;m n
.;;n o
ToList;;o u
(;;u v
);;v w
;;;w x$
contentChangeDetailsList<< (
.<<( )
Add<<) ,
(<<, -
new<<- 0 
ContentChangeDetails<<1 E
(<<E F
)<<F G
{== 
Name>> 
=>> 
$str>> 0
,>>0 1
OldValue?? 
=?? (
FormatLanguageSettingsChange?? ;
(??; <
currentLanguages??< L
,??L M
newLanguages??N Z
,??Z [
true??\ `
)??` a
,??a b
NewValue@@ 
=@@ (
FormatLanguageSettingsChange@@ ;
(@@; <
currentLanguages@@< L
,@@L M
newLanguages@@N Z
,@@Z [
false@@\ a
)@@a b
}AA 
)AA 
;AA 
}BB 
varDD 
str3DD 
=DD (
OldFallbackLanguagesToStringDD 3
(DD3 4
settingsFromJson1DD4 E
,DDE F

dictionaryDDG Q
)DDQ R
;DDR S
varEE 
str4EE 
=EE (
NewFallbackLanguagesToStringEE 3
(EE3 4
settingsFromJson1EE4 E
,EEE F

dictionaryEEG Q
)EEQ R
;EER S$
contentChangeDetailsListFF $
.FF$ %
AddFF% (
(FF( )
newFF) , 
ContentChangeDetailsFF- A
(FFA B
)FFB C
{GG 
NameHH 
=HH 
$strHH +
,HH+ ,
OldValueII 
=II 
str3II 
,II  
NewValueJJ 
=JJ 
str4JJ 
}KK 
)KK 
;KK 
varLL 
str5LL 
=LL +
OldReplacementLanguagesToStringLL 6
(LL6 7
settingsFromJson1LL7 H
,LLH I

dictionaryLLJ T
)LLT U
;LLU V
varMM 
str6MM 
=MM +
NewReplacementLanguagesToStringMM 6
(MM6 7
settingsFromJson1MM7 H
,MMH I

dictionaryMMJ T
)MMT U
;MMU V$
contentChangeDetailsListNN $
.NN$ %
AddNN% (
(NN( )
newNN) , 
ContentChangeDetailsNN- A
(NNA B
)NNB C
{OO 
NamePP 
=PP 
$strPP .
,PP. /
OldValueQQ 
=QQ 
str5QQ 
,QQ  
NewValueRR 
=RR 
str6RR 
}SS 
)SS 
;SS 
returnTT $
contentChangeDetailsListTT +
;TT+ ,
}UU 	
privateWW 
ContentReferenceWW  
	GetParentWW! *
(WW* +
ContentReferenceWW+ ;
contentLinkWW< G
)WWG H
{XX 	
varYY 
contentYY 
=YY 
_contentRepositoryYY ,
.YY, -
GetYY- 0
<YY0 1
IContentYY1 9
>YY9 :
(YY: ;
contentLinkYY; F
,YYF G
LanguageSelectorYYH X
.YYX Y

AutoDetectYYY c
(YYc d
trueYYd h
)YYh i
)YYi j
;YYj k
ifZZ 
(ZZ 
contentZZ 
==ZZ 
nullZZ 
)ZZ  
return[[ 
null[[ 
;[[ 
var\\ 
source\\ 
=\\ +
_contentLanguageSettingsHandler\\ 8
.\\8 9
Get\\9 <
(\\< =
content\\= D
.\\D E

ParentLink\\E O
)\\O P
;\\P Q
return]] 
source]] 
?]] 
.]] 
FirstOrDefault]] )
(]]) *
)]]* +
?]]+ ,
.]], -
DefinedOnContent]]- =
;]]= >
}^^ 	
private`` 
string`` 
GetLanguageName`` &
(``& '
string``' -
languageCode``. :
)``: ;
{aa 	
ifbb 
(bb 
stringbb 
.bb 
IsNullOrEmptybb $
(bb$ %
languageCodebb% 1
)bb1 2
)bb2 3
returncc 
stringcc 
.cc 
Emptycc #
;cc# $
vardd 
languageBranchdd 
=dd  %
_languageBranchRepositorydd! :
.dd: ;
Loaddd; ?
(dd? @
languageCodedd@ L
)ddL M
;ddM N
returnee 
languageBranchee !
==ee" $
nullee% )
?ee* +
stringee, 2
.ee2 3
Emptyee3 8
:ee9 :
languageBranchee; I
.eeI J
NameeeJ N
;eeN O
}ff 	
privatehh 
stringhh 
StringifyLanguageshh )
(hh) *
IEnumerablehh* 5
<hh5 6
stringhh6 <
>hh< =
	languageshh> G
,hhG H
stringhhI O
	separatorhhP Y
)hhY Z
{ii 	
returnjj 
	languagesjj 
.jj 
	Aggregatejj &
(jj& '
stringjj' -
.jj- .
Emptyjj. 3
,jj3 4
(jj5 6

workingStrjj6 @
,jj@ A
nextjjB F
)jjF G
=>jjH J
$"jjK M
{jjM N

workingStrjjN X
}jjX Y
{jjY Z
	separatorjjZ c
}jjc d
{jjd e
GetLanguageNamejje t
(jjt u
nextjju y
)jjy z
}jjz {
"jj{ |
)jj| }
.jj} ~
	TrimStart	jj~ ‡
(
jj‡ ˆ
	separator
jjˆ ‘
.
jj‘ ’
ToCharArray
jj’ 
(
jj 
)
jj Ÿ
)
jjŸ  
;
jj  ¡
}kk 	
privatemm 
stringmm (
FormatLanguageSettingsChangemm 3
(mm3 4
Listmm4 8
<mm8 9
stringmm9 ?
>mm? @
currentLanguagesmmA Q
,mmQ R
ListmmS W
<mmW X
stringmmX ^
>mm^ _
newLanguagesmm` l
,mml m
boolmmn r
originalmms {
)mm{ |
{nn 	
varoo 
stroo 
=oo 
stringoo 
.oo 
Emptyoo "
;oo" #
ifpp 
(pp 
!pp 
currentLanguagespp !
.pp! "
Exceptpp" (
(pp( )
newLanguagespp) 5
)pp5 6
.pp6 7
Anypp7 :
(pp: ;
)pp; <
&&pp= ?
!pp@ A
newLanguagesppA M
.ppM N
ExceptppN T
(ppT U
currentLanguagesppU e
)ppe f
.ppf g
Anyppg j
(ppj k
)ppk l
)ppl m
strqq 
=qq 
StringifyLanguagesqq (
(qq( )
currentLanguagesqq) 9
,qq9 :
CommaSeparatorqq; I
)qqI J
.qqJ K
FadeqqK O
(qqO P
)qqP Q
;qqQ R
elserr 
ifrr 
(rr 
originalrr 
)rr 
{ss 
strtt 
=tt 
StringifyLanguagestt (
(tt( )
currentLanguagestt) 9
,tt9 :
CommaSeparatortt; I
)ttI J
;ttJ K
}uu 
elsevv 
{ww 
foreachxx 
(xx 
varxx 
currentLangxx (
inxx) +
currentLanguagesxx, <
)xx< =
{yy 
varzz 
itemzz 
=zz 
currentLangzz *
;zz* +
var{{ 
languageName{{ $
={{% &
GetLanguageName{{' 6
({{6 7
item{{7 ;
){{; <
;{{< =
str|| 
=|| 
newLanguages|| &
.||& '
Any||' *
(||* +
lang||+ /
=>||0 2
lang||3 7
.||7 8
Equals||8 >
(||> ?
item||? C
,||C D
StringComparison||E U
.||U V&
InvariantCultureIgnoreCase||V p
)||p q
)||q r
?||s t
str||u x
+||y z
$"}} 
{}} 
languageName}} '
}}}' (
{}}( )
CommaSeparator}}) 7
}}}7 8
"}}8 9
:~~ 
str~~ 
+~~ 
$"~~  "
{~~" #
languageName~~# /
.~~/ 0
Strikethrough~~0 =
(~~= >
)~~> ?
}~~? @
{~~@ A
CommaSeparator~~A O
}~~O P
"~~P Q
;~~Q R
} 
foreach
 
(
 
var
 
newLang
 $
in
% '
newLanguages
( 4
)
4 5
{
‚‚ 
var
ƒƒ 
item
ƒƒ 
=
ƒƒ 
newLang
ƒƒ &
;
ƒƒ& '
var
„„ 
languageName
„„ $
=
„„% &
GetLanguageName
„„' 6
(
„„6 7
item
„„7 ;
)
„„; <
;
„„< =
if
…… 
(
…… 
!
…… 
string
…… 
.
……   
IsNullOrWhiteSpace
……  2
(
……2 3
languageName
……3 ?
)
……? @
&&
……A C
!
……D E
currentLanguages
……E U
.
……U V
Any
……V Y
(
……Y Z
lang
……Z ^
=>
……_ a
lang
……b f
.
……f g
Equals
……g m
(
……m n
item
……n r
,
……r s
StringComparison……t „
.……„ …*
InvariantCultureIgnoreCase……… Ÿ
)……Ÿ  
)……  ¡
)……¡ ¢
str
†† 
+=
†† 
$"
†† !
{
††! "
languageName
††" .
.
††. /
Bold
††/ 3
(
††3 4
)
††4 5
}
††5 6
{
††6 7
CommaSeparator
††7 E
}
††E F
"
††F G
;
††G H
}
‡‡ 
}
ˆˆ 
return
‰‰ 
str
‰‰ 
.
‰‰ 
TrimEnd
‰‰ 
(
‰‰ 
CommaSeparator
‰‰ -
)
‰‰- .
;
‰‰. /
}
ŠŠ 	
private
ŒŒ 
static
ŒŒ 
List
ŒŒ 
<
ŒŒ 
string
ŒŒ "
>
ŒŒ" #"
GetFallbackLanguages
ŒŒ$ 8
(
ŒŒ8 9
string
ŒŒ9 ?
visitorLanguage
ŒŒ@ O
,
ŒŒO P
IDictionary
ŒŒQ \
<
ŒŒ\ ]
string
ŒŒ] c
,
ŒŒc d$
ContentLanguageSetting
ŒŒe {
>
ŒŒ{ |
settingsŒŒ} …
)ŒŒ… †
{
 	
return
 
settings
 
==
 
null
 #
||
$ &
!
' (
settings
( 0
.
0 1
ContainsKey
1 <
(
< =
visitorLanguage
= L
)
L M
||
N P
settings
Q Y
[
Y Z
visitorLanguage
Z i
]
i j
.
j k%
LanguageBranchFallbackk 
==‚ „
null… ‰
?Š ‹
ArrayŒ ‘
.‘ ’
Empty’ —
<— ˜
string˜ 
> Ÿ
(Ÿ  
)  ¡
.¡ ¢
ToList¢ ¨
(¨ ©
)© ª
:« ¬
settings­ µ
[µ ¶
visitorLanguage¶ Å
]Å Æ
.Æ Ç&
LanguageBranchFallbackÇ İ
.İ Ş
ToListŞ ä
(ä å
)å æ
;æ ç
}
 	
private
‘‘ 
string
‘‘ *
OldFallbackLanguagesToString
‘‘ 3
(
‘‘3 4
IDictionary
‘‘4 ?
<
‘‘? @
string
‘‘@ F
,
‘‘F G$
ContentLanguageSetting
‘‘H ^
>
‘‘^ _
oldSettings
‘‘` k
,
‘‘k l
IDictionary
‘‘m x
<
‘‘x y
string
‘‘y 
,‘‘ €&
ContentLanguageSetting‘‘ —
>‘‘— ˜
newSettings‘‘™ ¤
)‘‘¤ ¥
{
’’ 	
var
““ 
stringBuilder
““ 
=
““ 
new
““  #
StringBuilder
““$ 1
(
““1 2
)
““2 3
;
““3 4
foreach
”” 
(
”” 
var
”” 
key
”” 
in
”” 
oldSettings
””  +
.
””+ ,
Keys
””, 0
)
””0 1
{
•• 
var
––  
fallbackLanguages1
–– &
=
––' ("
GetFallbackLanguages
––) =
(
––= >
key
––> A
,
––A B
oldSettings
––C N
)
––N O
;
––O P
var
——  
fallbackLanguages2
—— &
=
——' ("
GetFallbackLanguages
——) =
(
——= >
key
——> A
,
——A B
newSettings
——C N
)
——N O
;
——O P
if
˜˜ 
(
˜˜ 
(
˜˜  
fallbackLanguages1
˜˜ '
.
˜˜' (
Count
˜˜( -
!=
˜˜. 0
$num
˜˜1 2
||
˜˜3 5 
fallbackLanguages2
˜˜6 H
.
˜˜H I
Count
˜˜I N
!=
˜˜O Q
$num
˜˜R S
)
˜˜S T
&&
˜˜U W
(
˜˜X Y 
fallbackLanguages1
˜˜Y k
.
˜˜k l
Any
˜˜l o
(
˜˜o p
item
˜˜p t
=>
˜˜u w
!
˜˜x y
string
˜˜y 
.˜˜ €"
IsNullOrWhiteSpace˜˜€ ’
(˜˜’ “
GetLanguageName˜˜“ ¢
(˜˜¢ £
item˜˜£ §
)˜˜§ ¨
)˜˜¨ ©
)˜˜© ª
||˜˜« ­"
fallbackLanguages2˜˜® À
.˜˜À Á
Any˜˜Á Ä
(˜˜Ä Å
item˜˜Å É
=>˜˜Ê Ì
!˜˜Í Î
string˜˜Î Ô
.˜˜Ô Õ"
IsNullOrWhiteSpace˜˜Õ ç
(˜˜ç è
GetLanguageName˜˜è ÷
(˜˜÷ ø
item˜˜ø ü
)˜˜ü ı
)˜˜ı ş
)˜˜ş ÿ
)˜˜ÿ €
)˜˜€ 
{
™™ 
var
šš 
languageName
šš $
=
šš% &
GetLanguageName
šš' 6
(
šš6 7
key
šš7 :
)
šš: ;
;
šš; <
if
›› 
(
››  
fallbackLanguages1
›› *
.
››* +
Count
››+ 0
>
››1 2
$num
››3 4
)
››4 5
{
œœ 
var
 
str1
  
=
! " 
StringifyLanguages
# 5
(
5 6 
fallbackLanguages1
6 H
,
H I
ArrowSeparator
J X
)
X Y
;
Y Z
var
 
str2
  
=
! " 
fallbackLanguages1
# 5
.
5 6
SequenceEqual
6 C
(
C D 
fallbackLanguages2
D V
)
V W
?
X Y
$"
Z \
{
\ ]
languageName
] i
}
i j
{
j k
ArrowSeparator
k y
}
y z
{
z {
str1
{ 
} €
"€ 
.
ŸŸ 
Fade
ŸŸ !
(
ŸŸ! "
)
ŸŸ" #
:
ŸŸ$ %
$"
ŸŸ& (
{
ŸŸ( )
languageName
ŸŸ) 5
}
ŸŸ5 6
{
ŸŸ6 7
ArrowSeparator
ŸŸ7 E
}
ŸŸE F
{
ŸŸF G
str1
ŸŸG K
}
ŸŸK L
"
ŸŸL M
;
ŸŸM N
stringBuilder
   %
.
  % &
Append
  & ,
(
  , -
str2
  - 1
)
  1 2
;
  2 3
}
¡¡ 
else
¢¢ 
stringBuilder
££ %
.
££% &
Append
££& ,
(
££, -
$"
££- /
{
££/ 0
languageName
££0 <
}
££< =
{
££= >
ArrowSeparator
££> L
}
££L M
$str
££M Q
"
££Q R
)
££R S
;
££S T
stringBuilder
¤¤ !
.
¤¤! "
Append
¤¤" (
(
¤¤( )
$str
¤¤) 0
)
¤¤0 1
;
¤¤1 2
}
¥¥ 
}
¦¦ 
return
§§ 
stringBuilder
§§  
.
§§  !
ToString
§§! )
(
§§) *
)
§§* +
.
§§+ ,
TrimEnd
§§, 3
(
§§3 4
$str
§§4 ;
)
§§; <
;
§§< =
}
¨¨ 	
private
ªª 
string
ªª *
NewFallbackLanguagesToString
ªª 3
(
ªª3 4
IDictionary
ªª4 ?
<
ªª? @
string
ªª@ F
,
ªªF G$
ContentLanguageSetting
ªªH ^
>
ªª^ _
oldSettings
ªª` k
,
ªªk l
IDictionary
ªªm x
<
ªªx y
string
ªªy 
,ªª €&
ContentLanguageSettingªª —
>ªª— ˜
newSettingsªª™ ¤
)ªª¤ ¥
{
«« 	
var
¬¬ 
stringBuilder
¬¬ 
=
¬¬ 
new
¬¬  #
StringBuilder
¬¬$ 1
(
¬¬1 2
)
¬¬2 3
;
¬¬3 4
foreach
­­ 
(
­­ 
var
­­ 
key
­­ 
in
­­ 
newSettings
­­  +
.
­­+ ,
Keys
­­, 0
)
­­0 1
{
®® 
var
¯¯  
fallbackLanguages1
¯¯ &
=
¯¯' ("
GetFallbackLanguages
¯¯) =
(
¯¯= >
key
¯¯> A
,
¯¯A B
newSettings
¯¯C N
)
¯¯N O
;
¯¯O P
var
°°  
fallbackLanguages2
°° &
=
°°' ("
GetFallbackLanguages
°°) =
(
°°= >
key
°°> A
,
°°A B
oldSettings
°°C N
)
°°N O
;
°°O P
if
±± 
(
±±  
fallbackLanguages2
±± &
.
±±& '
Count
±±' ,
>
±±- .
$num
±±/ 0
||
±±1 3 
fallbackLanguages1
±±4 F
.
±±F G
Count
±±G L
>
±±M N
$num
±±O P
)
±±P Q
{
²² 
var
³³ 
languageName1
³³ %
=
³³& '
GetLanguageName
³³( 7
(
³³7 8
key
³³8 ;
)
³³; <
;
³³< =
if
´´ 
(
´´ 
!
´´ 
string
´´ 
.
´´   
IsNullOrWhiteSpace
´´  2
(
´´2 3
languageName1
´´3 @
)
´´@ A
)
´´A B
{
µµ 
if
¶¶ 
(
¶¶  
fallbackLanguages1
¶¶ .
.
¶¶. /
SequenceEqual
¶¶/ <
(
¶¶< = 
fallbackLanguages2
¶¶= O
)
¶¶O P
)
¶¶P Q
{
·· 
var
¸¸ 
str
¸¸  #
=
¸¸$ % 
StringifyLanguages
¸¸& 8
(
¸¸8 9 
fallbackLanguages1
¸¸9 K
,
¸¸K L
ArrowSeparator
¸¸M [
)
¸¸[ \
;
¸¸\ ]
stringBuilder
¹¹ )
.
¹¹) *
Append
¹¹* 0
(
¹¹0 1
$"
¹¹1 3
{
¹¹3 4
languageName1
¹¹4 A
}
¹¹A B
{
¹¹B C
ArrowSeparator
¹¹C Q
}
¹¹Q R
{
¹¹R S
str
¹¹S V
}
¹¹V W
"
¹¹W X
.
¹¹X Y
Fade
¹¹Y ]
(
¹¹] ^
)
¹¹^ _
)
¹¹_ `
;
¹¹` a
}
ºº 
else
»» 
if
»» 
(
»»  ! 
fallbackLanguages1
»»! 3
.
»»3 4
Count
»»4 9
==
»»: <
$num
»»= >
&&
»»? A 
fallbackLanguages2
»»B T
.
»»T U
Count
»»U Z
>
»»[ \
$num
»»] ^
)
»»^ _
{
¼¼ 
var
½½ 
str
½½  #
=
½½$ % 
StringifyLanguages
½½& 8
(
½½8 9 
fallbackLanguages2
½½9 K
,
½½K L
ArrowSeparator
½½M [
)
½½[ \
;
½½\ ]
stringBuilder
¾¾ )
.
¾¾) *
Append
¾¾* 0
(
¾¾0 1
$"
¾¾1 3
{
¾¾3 4
languageName1
¾¾4 A
}
¾¾A B
{
¾¾B C
ArrowSeparator
¾¾C Q
}
¾¾Q R
{
¾¾R S
str
¾¾S V
}
¾¾V W
"
¾¾W X
.
¾¾X Y
Strikethrough
¾¾Y f
(
¾¾f g
)
¾¾g h
)
¾¾h i
;
¾¾i j
}
¿¿ 
else
ÀÀ 
if
ÀÀ 
(
ÀÀ  ! 
fallbackLanguages1
ÀÀ! 3
.
ÀÀ3 4
Count
ÀÀ4 9
>
ÀÀ: ;
$num
ÀÀ< =
)
ÀÀ= >
{
ÁÁ 
if
ÂÂ 
(
ÂÂ  
(
ÂÂ  ! 
fallbackLanguages2
ÂÂ! 3
.
ÂÂ3 4
Count
ÂÂ4 9
!=
ÂÂ: <
$num
ÂÂ= >
||
ÂÂ? A 
fallbackLanguages1
ÂÂB T
.
ÂÂT U
Count
ÂÂU Z
!=
ÂÂ[ ]
$num
ÂÂ^ _
)
ÂÂ_ `
&&
ÂÂa c
(
ÂÂd e 
fallbackLanguages2
ÂÂe w
.
ÂÂw x
Any
ÂÂx {
(
ÂÂ{ |
itemÂÂ| €
=>ÂÂ ƒ
!ÂÂ„ …
stringÂÂ… ‹
.ÂÂ‹ Œ"
IsNullOrWhiteSpaceÂÂŒ 
(ÂÂ Ÿ
GetLanguageNameÂÂŸ ®
(ÂÂ® ¯
itemÂÂ¯ ³
)ÂÂ³ ´
)ÂÂ´ µ
)ÂÂµ ¶
||ÂÂ· ¹"
fallbackLanguages1ÂÂº Ì
.ÂÂÌ Í
AnyÂÂÍ Ğ
(ÂÂĞ Ñ
itemÂÂÑ Õ
=>ÂÂÖ Ø
!ÂÂÙ Ú
stringÂÂÚ à
.ÂÂà á"
IsNullOrWhiteSpaceÂÂá ó
(ÂÂó ô
GetLanguageNameÂÂô ƒ
(ÂÂƒ „
itemÂÂ„ ˆ
)ÂÂˆ ‰
)ÂÂ‰ Š
)ÂÂŠ ‹
)ÂÂ‹ Œ
)ÂÂŒ 
{
ÃÃ 
stringBuilder
ÄÄ  -
.
ÄÄ- .
Append
ÄÄ. 4
(
ÄÄ4 5
languageName1
ÄÄ5 B
)
ÄÄB C
;
ÄÄC D
foreach
ÅÅ  '
(
ÅÅ( )
var
ÅÅ) ,
languageCode
ÅÅ- 9
in
ÅÅ: < 
fallbackLanguages2
ÅÅ= O
)
ÅÅO P
{
ÆÆ  !
var
ÇÇ$ '
str
ÇÇ( +
=
ÇÇ, - 
fallbackLanguages1
ÇÇ. @
.
ÇÇ@ A
Contains
ÇÇA I
(
ÇÇI J
languageCode
ÇÇJ V
)
ÇÇV W
?
ÇÇX Y
$"
ÇÇZ \
{
ÇÇ\ ]
ArrowSeparator
ÇÇ] k
}
ÇÇk l
{
ÇÇl m
GetLanguageName
ÇÇm |
(
ÇÇ| }
languageCodeÇÇ} ‰
)ÇÇ‰ Š
}ÇÇŠ ‹
"ÇÇ‹ Œ
:
ÈÈ( )
$"
ÈÈ* ,
{
ÈÈ, -
ArrowSeparator
ÈÈ- ;
}
ÈÈ; <
{
ÈÈ< =
GetLanguageName
ÈÈ= L
(
ÈÈL M
languageCode
ÈÈM Y
)
ÈÈY Z
.
ÈÈZ [
Strikethrough
ÈÈ[ h
(
ÈÈh i
)
ÈÈi j
}
ÈÈj k
"
ÈÈk l
;
ÈÈl m
stringBuilder
ÉÉ$ 1
.
ÉÉ1 2
Append
ÉÉ2 8
(
ÉÉ8 9
str
ÉÉ9 <
)
ÉÉ< =
;
ÉÉ= >
}
ÊÊ  !
foreach
ËË  '
(
ËË( )
var
ËË) ,
languageCode
ËË- 9
in
ËË: < 
fallbackLanguages1
ËË= O
)
ËËO P
{
ÌÌ  !
var
ÍÍ$ '
languageName2
ÍÍ( 5
=
ÍÍ6 7
GetLanguageName
ÍÍ8 G
(
ÍÍG H
languageCode
ÍÍH T
)
ÍÍT U
;
ÍÍU V
if
ÎÎ$ &
(
ÎÎ' (
!
ÎÎ( )
string
ÎÎ) /
.
ÎÎ/ 0 
IsNullOrWhiteSpace
ÎÎ0 B
(
ÎÎB C
languageName2
ÎÎC P
)
ÎÎP Q
&&
ÎÎR T
!
ÎÎU V 
fallbackLanguages2
ÎÎV h
.
ÎÎh i
Contains
ÎÎi q
(
ÎÎq r
languageCode
ÎÎr ~
)
ÎÎ~ 
)ÎÎ €
stringBuilder
ÏÏ( 5
.
ÏÏ5 6
Append
ÏÏ6 <
(
ÏÏ< =
$"
ÏÏ= ?
{
ÏÏ? @
ArrowSeparator
ÏÏ@ N
}
ÏÏN O
{
ÏÏO P
languageName2
ÏÏP ]
.
ÏÏ] ^
Bold
ÏÏ^ b
(
ÏÏb c
)
ÏÏc d
}
ÏÏd e
"
ÏÏe f
)
ÏÏf g
;
ÏÏg h
}
ĞĞ  !
}
ÑÑ 
else
ÒÒ  
continue
ÓÓ  (
;
ÓÓ( )
}
ÔÔ 
stringBuilder
ÕÕ %
.
ÕÕ% &
Append
ÕÕ& ,
(
ÕÕ, -
$str
ÕÕ- 4
)
ÕÕ4 5
;
ÕÕ5 6
}
ÖÖ 
}
×× 
}
ØØ 
return
ÙÙ 
stringBuilder
ÙÙ  
.
ÙÙ  !
ToString
ÙÙ! )
(
ÙÙ) *
)
ÙÙ* +
.
ÙÙ+ ,
TrimEnd
ÙÙ, 3
(
ÙÙ3 4
$str
ÙÙ4 ;
)
ÙÙ; <
;
ÙÙ< =
}
ÚÚ 	
private
ÜÜ 
string
ÜÜ $
GetReplacementLanguage
ÜÜ -
(
ÜÜ- .
string
ÜÜ. 4
visitorLanguage
ÜÜ5 D
,
ÜÜD E
IDictionary
ÜÜF Q
<
ÜÜQ R
string
ÜÜR X
,
ÜÜX Y$
ContentLanguageSetting
ÜÜZ p
>
ÜÜp q
settings
ÜÜr z
)
ÜÜz {
{
İİ 	
return
ŞŞ 
settings
ŞŞ 
==
ŞŞ 
null
ŞŞ #
||
ŞŞ$ &
!
ŞŞ' (
settings
ŞŞ( 0
.
ŞŞ0 1
ContainsKey
ŞŞ1 <
(
ŞŞ< =
visitorLanguage
ŞŞ= L
)
ŞŞL M
||
ŞŞN P
settings
ŞŞQ Y
[
ŞŞY Z
visitorLanguage
ŞŞZ i
]
ŞŞi j
.
ŞŞj k(
ReplacementLanguageBranchŞŞk „
==ŞŞ… ‡
nullŞŞˆ Œ
?ŞŞ 
stringŞŞ •
.ŞŞ• –
EmptyŞŞ– ›
:ŞŞœ 
GetLanguageNameŞŞ ­
(ŞŞ­ ®
settingsŞŞ® ¶
[ŞŞ¶ ·
visitorLanguageŞŞ· Æ
]ŞŞÆ Ç
.ŞŞÇ È)
ReplacementLanguageBranchŞŞÈ á
)ŞŞá â
;ŞŞâ ã
}
ßß 	
private
áá 
string
áá -
OldReplacementLanguagesToString
áá 6
(
áá6 7
IDictionary
áá7 B
<
ááB C
string
ááC I
,
ááI J$
ContentLanguageSetting
ááK a
>
ááa b
oldSettings
áác n
,
áán o
IDictionary
ááp {
<
áá{ |
stringáá| ‚
,áá‚ ƒ&
ContentLanguageSettingáá„ š
>ááš ›
newSettingsááœ §
)áá§ ¨
{
ââ 	
var
ãã 
stringBuilder
ãã 
=
ãã 
new
ãã  #
StringBuilder
ãã$ 1
(
ãã1 2
)
ãã2 3
;
ãã3 4
foreach
ää 
(
ää 
var
ää 
key
ää 
in
ää 
oldSettings
ää  +
.
ää+ ,
Keys
ää, 0
)
ää0 1
{
åå 
var
ææ "
replacementLanguage1
ææ (
=
ææ) *$
GetReplacementLanguage
ææ+ A
(
ææA B
key
ææB E
,
ææE F
oldSettings
ææG R
)
ææR S
;
ææS T
var
çç "
replacementLanguage2
çç (
=
çç) *$
GetReplacementLanguage
çç+ A
(
ççA B
key
ççB E
,
ççE F
newSettings
ççG R
)
ççR S
;
ççS T
if
èè 
(
èè 
!
èè 
string
èè 
.
èè 
IsNullOrEmpty
èè )
(
èè) *"
replacementLanguage1
èè* >
)
èè> ?
||
èè@ B
!
èèC D
string
èèD J
.
èèJ K
IsNullOrEmpty
èèK X
(
èèX Y"
replacementLanguage2
èèY m
)
èèm n
)
èèn o
{
éé 
var
êê 
languageName
êê $
=
êê% &
GetLanguageName
êê' 6
(
êê6 7
key
êê7 :
)
êê: ;
;
êê; <
var
ëë 
str
ëë 
=
ëë "
replacementLanguage1
ëë 2
!=
ëë3 5
null
ëë6 :
&&
ëë; ="
replacementLanguage1
ëë> R
.
ëëR S
Equals
ëëS Y
(
ëëY Z"
replacementLanguage2
ëëZ n
)
ëën o
?
ëëp q
$"
ëër t
{
ëët u
languageNameëëu 
}ëë ‚
{ëë‚ ƒ
ArrowSeparatorëëƒ ‘
}ëë‘ ’
{ëë’ “$
replacementLanguage1ëë“ §
}ëë§ ¨
"ëë¨ ©
.
ìì 
Fade
ìì 
(
ìì 
)
ìì 
:
ìì  !
$"
ìì" $
{
ìì$ %
languageName
ìì% 1
}
ìì1 2
{
ìì2 3
ArrowSeparator
ìì3 A
}
ììA B
{
ììB C
(
ììC D
!
ììD E
string
ììE K
.
ììK L
IsNullOrEmpty
ììL Y
(
ììY Z"
replacementLanguage1
ììZ n
)
ììn o
?
ììp q#
replacementLanguage1ììr †
:ìì‡ ˆ
$strìì‰ 
)ìì 
}ìì ‘
"ìì‘ ’
;ìì’ “
stringBuilder
íí !
.
íí! "
Append
íí" (
(
íí( )
str
íí) ,
)
íí, -
;
íí- .
stringBuilder
îî !
.
îî! "
Append
îî" (
(
îî( )
$str
îî) 0
)
îî0 1
;
îî1 2
}
ïï 
}
ğğ 
return
ññ 
stringBuilder
ññ  
.
ññ  !
ToString
ññ! )
(
ññ) *
)
ññ* +
.
ññ+ ,
TrimEnd
ññ, 3
(
ññ3 4
$str
ññ4 ;
)
ññ; <
;
ññ< =
}
òò 	
private
ôô 
string
ôô -
NewReplacementLanguagesToString
ôô 6
(
ôô6 7
IDictionary
ôô7 B
<
ôôB C
string
ôôC I
,
ôôI J$
ContentLanguageSetting
ôôK a
>
ôôa b
oldSettings
ôôc n
,
ôôn o
IDictionary
ôôp {
<
ôô{ |
stringôô| ‚
,ôô‚ ƒ&
ContentLanguageSettingôô„ š
>ôôš ›
newSettingsôôœ §
)ôô§ ¨
{
õõ 	
var
öö 
stringBuilder
öö 
=
öö 
new
öö  #
StringBuilder
öö$ 1
(
öö1 2
)
öö2 3
;
öö3 4
foreach
÷÷ 
(
÷÷ 
var
÷÷ 
key
÷÷ 
in
÷÷ 
newSettings
÷÷  +
.
÷÷+ ,
Keys
÷÷, 0
)
÷÷0 1
{
øø 
var
ùù "
replacementLanguage1
ùù (
=
ùù) *$
GetReplacementLanguage
ùù+ A
(
ùùA B
key
ùùB E
,
ùùE F
newSettings
ùùG R
)
ùùR S
;
ùùS T
var
úú "
replacementLanguage2
úú (
=
úú) *$
GetReplacementLanguage
úú+ A
(
úúA B
key
úúB E
,
úúE F
oldSettings
úúG R
)
úúR S
;
úúS T
if
ûû 
(
ûû 
!
ûû 
string
ûû 
.
ûû 
IsNullOrEmpty
ûû )
(
ûû) *"
replacementLanguage1
ûû* >
)
ûû> ?
||
ûû@ B
!
ûûC D
string
ûûD J
.
ûûJ K
IsNullOrEmpty
ûûK X
(
ûûX Y"
replacementLanguage2
ûûY m
)
ûûm n
)
ûûn o
{
üü 
var
ıı 
languageName
ıı $
=
ıı% &
GetLanguageName
ıı' 6
(
ıı6 7
key
ıı7 :
)
ıı: ;
;
ıı; <
if
şş 
(
şş 
!
şş 
string
şş 
.
şş   
IsNullOrWhiteSpace
şş  2
(
şş2 3
languageName
şş3 ?
)
şş? @
)
şş@ A
{
ÿÿ 
if
€€ 
(
€€ "
replacementLanguage1
€€ 0
!=
€€1 3
null
€€4 8
&&
€€9 ;"
replacementLanguage1
€€< P
.
€€P Q
Equals
€€Q W
(
€€W X"
replacementLanguage2
€€X l
)
€€l m
)
€€m n
stringBuilder
 )
.
) *
Append
* 0
(
0 1
$"
1 3
{
3 4
languageName
4 @
}
@ A
{
A B
ArrowSeparator
B P
}
P Q
{
Q R"
replacementLanguage1
R f
}
f g
"
g h
.
h i
Fade
i m
(
m n
)
n o
)
o p
;
p q
else
‚‚ 
if
‚‚ 
(
‚‚  !
string
‚‚! '
.
‚‚' (
IsNullOrEmpty
‚‚( 5
(
‚‚5 6"
replacementLanguage1
‚‚6 J
)
‚‚J K
)
‚‚K L
stringBuilder
ƒƒ )
.
ƒƒ) *
Append
ƒƒ* 0
(
ƒƒ0 1
$"
ƒƒ1 3
{
ƒƒ3 4
languageName
ƒƒ4 @
}
ƒƒ@ A
{
ƒƒA B
ArrowSeparator
ƒƒB P
}
ƒƒP Q
{
ƒƒQ R"
replacementLanguage2
ƒƒR f
}
ƒƒf g
"
ƒƒg h
.
ƒƒh i
Strikethrough
ƒƒi v
(
ƒƒv w
)
ƒƒw x
)
ƒƒx y
;
ƒƒy z
else
„„ 
stringBuilder
…… )
.
……) *
Append
……* 0
(
……0 1
$"
……1 3
{
……3 4
languageName
……4 @
}
……@ A
{
……A B
ArrowSeparator
……B P
}
……P Q
{
……Q R"
replacementLanguage1
……R f
.
……f g
Bold
……g k
(
……k l
)
……l m
}
……m n
"
……n o
)
……o p
;
……p q
}
†† 
stringBuilder
‡‡ !
.
‡‡! "
Append
‡‡" (
(
‡‡( )
$str
‡‡) 0
)
‡‡0 1
;
‡‡1 2
}
ˆˆ 
}
‰‰ 
return
ŠŠ 
stringBuilder
ŠŠ  
.
ŠŠ  !
ToString
ŠŠ! )
(
ŠŠ) *
)
ŠŠ* +
.
ŠŠ+ ,
TrimEnd
ŠŠ, 3
(
ŠŠ3 4
$str
ŠŠ4 ;
)
ŠŠ; <
;
ŠŠ< =
}
‹‹ 	
private
 
IDictionary
 
<
 
string
 "
,
" #$
ContentLanguageSetting
$ :
>
: ;0
"GetContentLanguageSettingsFromJson
< ^
(
^ _
string
_ e
json
f j
)
j k
{
 	
return
 
string
 
.
 
IsNullOrEmpty
 '
(
' (
json
( ,
)
, -
?
. /
new
0 3

Dictionary
4 >
<
> ?
string
? E
,
E F$
ContentLanguageSetting
G ]
>
] ^
(
^ _
)
_ `
:
a b
json
c g
.
g h
ToObject
h p
<
p q
IDictionary
q |
<
| }
string} ƒ
,ƒ „&
ContentLanguageSetting… ›
>› œ
>œ 
( 
) Ÿ
;Ÿ  
}
 	
private
’’ 
IDictionary
’’ 
<
’’ 
string
’’ "
,
’’" #$
ContentLanguageSetting
’’$ :
>
’’: ;!
GetLanguageSettings
’’< O
(
’’O P
ContentReference
’’P `
contentLink
’’a l
)
’’l m
{
““ 	
var
”” 

dictionary
”” 
=
”” 
new
””  

Dictionary
””! +
<
””+ ,
string
””, 2
,
””2 3$
ContentLanguageSetting
””4 J
>
””J K
(
””K L
)
””L M
;
””M N
var
••  
languageBranchList
•• "
=
••# $'
_languageBranchRepository
••% >
.
••> ?
ListEnabled
••? J
(
••J K
)
••K L
;
••L M
var
–– 
source
–– 
=
–– -
_contentLanguageSettingsHandler
–– 8
.
––8 9
Get
––9 <
(
––< =
contentLink
––= H
)
––H I
.
––I J
ToList
––J P
(
––P Q
)
––Q R
;
––R S
if
—— 
(
—— 
source
—— 
.
—— 
Any
—— 
(
—— 
)
—— 
)
—— 
{
˜˜ 
foreach
™™ 
(
™™ 
var
™™ $
contentLanguageSetting
™™ 3
in
™™4 6
source
™™7 =
)
™™= >
{
šš 
foreach
›› 
(
›› 
var
››  
languageBranch
››! /
in
››0 2 
languageBranchList
››3 E
)
››E F
{
œœ 
if
 
(
 
string
 "
.
" #
Compare
# *
(
* +$
contentLanguageSetting
+ A
.
A B
LanguageBranch
B P
,
P Q
languageBranch
R `
.
` a

LanguageID
a k
,
k l
StringComparison
m }
.
} ~ 
OrdinalIgnoreCase~ 
) 
==‘ “
$num” •
)• –
{
 

dictionary
ŸŸ &
.
ŸŸ& '
Add
ŸŸ' *
(
ŸŸ* +
languageBranch
ŸŸ+ 9
.
ŸŸ9 :

LanguageID
ŸŸ: D
,
ŸŸD E$
contentLanguageSetting
ŸŸF \
)
ŸŸ\ ]
;
ŸŸ] ^
break
   !
;
  ! "
}
¡¡ 
}
¢¢ 
}
££ 
}
¤¤ 
return
¥¥ 

dictionary
¥¥ 
;
¥¥ 
}
¦¦ 	
}
¨¨ 
}©© Š
†C:\Projects\adnanzameer\AdvancedTaskManager\net6.0\src\AdvancedTaskManager\Infrastructure\Cms\ChangeApproval\LanguageSettingCommand.cs
	namespace 	
AdvancedTaskManager
 
. 
Infrastructure ,
., -
Cms- 0
.0 1
ChangeApproval1 ?
{ 
[ 
EPiServerDataStore 
( #
AutomaticallyRemapStore /
=0 1
true2 6
)6 7
]7 8
public 

class "
LanguageSettingCommand '
:( )
ApprovalCommandBase* =
{ 
} 
}		 €/
‚C:\Projects\adnanzameer\AdvancedTaskManager\net6.0\src\AdvancedTaskManager\Infrastructure\Cms\ChangeApproval\MovingChangeDetail.cs
	namespace		 	
AdvancedTaskManager		
 
.		 
Infrastructure		 ,
.		, -
Cms		- 0
.		0 1
ChangeApproval		1 ?
{

 
public 

	interface 
IMovingChangeDetail (
{ 
IEnumerable 
< !
IContentChangeDetails )
>) *"
GetMovingChangeDetails+ A
(A B
ChangeTaskViewModelB U
byCommandIdV a
)a b
;b c
} 
public 

class 
MovingChangeDetail #
:$ %
IMovingChangeDetail& 9
{ 
private 
readonly 
ILogger  
_logger! (
;( )
private 
readonly 
IContentLoader '
_contentLoader( 6
;6 7
public 
MovingChangeDetail !
(! "
IContentLoader" 0
contentLoader1 >
)> ?
{ 	
_contentLoader 
= 
contentLoader *
;* +
_logger 
= 

LogManager  
.  !
	GetLogger! *
(* +
typeof+ 1
(1 2
MovingChangeDetail2 D
)D E
)E F
;F G
} 	
public 
IEnumerable 
< !
IContentChangeDetails 0
>0 1"
GetMovingChangeDetails2 H
(H I
ChangeTaskViewModelI \
byCommandId] h
)h i
{   	
if"" 
("" 
byCommandId"" 
=="" 
null"" #
)""# $
return## 
null## 
;## 
var$$ $
contentChangeDetailsList$$ (
=$$) *
new$$+ .
List$$/ 3
<$$3 4!
IContentChangeDetails$$4 I
>$$I J
($$J K
)$$K L
;$$L M
try%% 
{&& 
var'' 
movingPayLoad1'' "
=''# $
JsonConvert''% 0
.''0 1
DeserializeObject''1 B
<''B C
MovingPayLoad''C P
>''P Q
(''Q R
byCommandId''R ]
.''] ^
CurrentSettingsJson''^ q
)''q r
;''r s
var(( 
movingPayLoad2(( "
=((# $
JsonConvert((% 0
.((0 1
DeserializeObject((1 B
<((B C
MovingPayLoad((C P
>((P Q
(((Q R
byCommandId((R ]
.((] ^
NewSettingsJson((^ m
)((m n
;((n o
var** 
content1** 
=**  
GetContentPathString** 3
(**3 4
movingPayLoad1**4 B
.**B C
Destination**C N
)**N O
;**O P
var++ 
content2++ 
=++  
GetContentPathString++ 3
(++3 4
movingPayLoad2++4 B
.++B C
Destination++C N
)++N O
;++O P$
contentChangeDetailsList,, (
.,,( )
Add,,) ,
(,,, -
new,,- 0 
ContentChangeDetails,,1 E
(,,E F
),,F G
{-- 
Name.. 
=.. 
$str.. !
,..! "
OldValue// 
=// 
content1// '
,//' (
NewValue00 
=00 
content200 '
}11 
)11 
;11 
}22 
catch33 
(33 
	Exception33 
ex33 
)33  
{44 
_logger55 
.55 
Error55 
(55 
ex55  
.55  !
Message55! (
,55( )
ex55* ,
)55, -
;55- .
}66 
return77 $
contentChangeDetailsList77 +
;77+ ,
}88 	
private:: 
string::  
GetContentPathString:: +
(::+ ,
ContentReference::, <
contentReference::= M
)::M N
{;; 	
var== 
content== 
=== 
_contentLoader== (
.==( )
Get==) ,
<==, -
IContent==- 5
>==5 6
(==6 7
contentReference==7 G
)==G H
;==H I
var@@ 
contentPath@@ 
=@@ 
GetContentPath@@ ,
(@@, -
content@@- 4
)@@4 5
;@@5 6
returnBB 
contentPathBB 
;BB 
}CC 	
privateEE 
stringEE 
GetContentPathEE %
(EE% &
IContentEE& .
contentEE/ 6
)EE6 7
{FF 	
varHH 
parentReferenceHH 
=HH  !
contentHH" )
.HH) *

ParentLinkHH* 4
;HH4 5
varJJ 
pathJJ 
=JJ 
contentJJ 
.JJ 
NameJJ #
;JJ# $
whileLL 
(LL 
parentReferenceLL "
.LL" #
IDLL# %
!=LL& (
ContentReferenceLL) 9
.LL9 :
RootPageLL: B
.LLB C
IDLLC E
)LLE F
{MM 
varNN 
parentContentNN !
=NN" #
_contentLoaderNN$ 2
.NN2 3
GetNN3 6
<NN6 7
IContentNN7 ?
>NN? @
(NN@ A
parentReferenceNNA P
)NNP Q
;NNQ R
pathPP 
=PP 
$"PP 
{PP 
parentContentPP '
.PP' (
NamePP( ,
}PP, -
$strPP- 0
{PP0 1
pathPP1 5
}PP5 6
"PP6 7
;PP7 8
parentReferenceSS 
=SS  !
parentContentSS" /
.SS/ 0

ParentLinkSS0 :
;SS: ;
}TT 
returnVV 
pathVV 
+VV 
$strVV 
;VV 
}WW 	
}ZZ 
}[[ ®
„C:\Projects\adnanzameer\AdvancedTaskManager\net6.0\src\AdvancedTaskManager\Infrastructure\Cms\ChangeApproval\MovingContentCommand.cs
	namespace

 	
AdvancedTaskManager


 
.

 
Infrastructure

 ,
.

, -
Cms

- 0
.

0 1
ChangeApproval

1 ?
{ 
[ 
EPiServerDataStore 
( #
AutomaticallyRemapStore /
=0 1
true2 6
)6 7
]7 8
public 

class  
MovingContentCommand %
:& '
ApprovalCommandBase( ;
{ 
private 
static 
readonly 
ILogger  '
Logger( .
=/ 0

LogManager1 ;
.; <
	GetLogger< E
(E F
typeofF L
(L M 
MovingContentCommandM a
)a b
)b c
;c d
private 
Injected 
< 
IContentLoader '
>' (
_contentLoader) 7
;7 8
public 
override 
bool 
IsValid $
($ %
)% &
{ 	
try 
{ 
return 
_contentLoader %
.% &
Service& -
.- .
Get. 1
<1 2
IContent2 :
>: ;
(; <
JsonConvert< G
.G H
DeserializeObjectH Y
<Y Z
MovingPayLoadZ g
>g h
(h i
NewSettingsJsoni x
)x y
.y z
Destination	z …
)
… †
!=
‡ ‰
null
Š 
;
 
} 
catch 
( 
	Exception 
ex 
)  
{ 
Logger 
. 
Error 
( 
ex 
.  
Message  '
)' (
;( )
return 
false 
; 
} 
} 	
} 
} ¬À
„C:\Projects\adnanzameer\AdvancedTaskManager\net6.0\src\AdvancedTaskManager\Infrastructure\Cms\ChangeApproval\SecurityChangeDetail.cs
	namespace 	
AdvancedTaskManager
 
. 
Infrastructure ,
., -
Cms- 0
.0 1
ChangeApproval1 ?
{ 
public 

	interface !
ISecurityChangeDetail *
{ 
IEnumerable 
< !
IContentChangeDetails )
>) *$
GetSecurityChangeDetails+ C
(C D
GuidD H
commandI P
)P Q
;Q R
} 
public 

class  
SecurityChangeDetail %
:& '!
ISecurityChangeDetail( =
{ 
private 
readonly #
IApprovalCommandService 0"
_generalCommandService1 G
;G H
private 
readonly 
ILogger  
_logger! (
;( )
private 
static 
readonly 
List  $
<$ %
AccessLevel% 0
>0 1
KnownAccessLevels2 C
=D E
newF I
(I J
)J K
{ 	
AccessLevel 
. 
Read 
, 
AccessLevel 
. 
Create 
, 
AccessLevel 
. 
Edit 
, 
AccessLevel 
. 
Delete 
, 
AccessLevel 
. 
Publish 
,  
AccessLevel 
. 

Administer "
}   	
;  	 

public""  
SecurityChangeDetail"" #
(""# $#
IApprovalCommandService""$ ;!
generalCommandService""< Q
)""Q R
{## 	"
_generalCommandService$$ "
=$$# $!
generalCommandService$$% :
;$$: ;
_logger%% 
=%% 

LogManager%%  
.%%  !
	GetLogger%%! *
(%%* +
typeof%%+ 1
(%%1 2 
SecurityChangeDetail%%2 F
)%%F G
)%%G H
;%%H I
}&& 	
public++ 
IEnumerable++ 
<++ !
IContentChangeDetails++ 0
>++0 1$
GetSecurityChangeDetails++2 J
(++J K
Guid++K O
command++P W
)++W X
{,, 	
var-- 
byCommandId-- 
=-- "
_generalCommandService-- 4
.--4 5
GetCommandById--5 C
(--C D
command--D K
)--K L
;--L M
var.. $
contentChangeDetailsList.. (
=..) *
new..+ .
List../ 3
<..3 4!
IContentChangeDetails..4 I
>..I J
(..J K
)..K L
;..L M
var// 
str1// 
=// 
$str// 
;// 
var00 
str200 
=00 
$str00 
;00 
if11 
(11 
byCommandId11 
==11 
null11 #
)11# $
return22 
null22 
;22 
var33 
accessControlList133 "
=33# $'
GetContentAccessControlList33% @
(33@ A
byCommandId33A L
.33L M
CurrentSettingsJson33M `
)33` a
;33a b
var44 
accessControlList244 "
=44# $'
GetContentAccessControlList44% @
(44@ A
byCommandId44A L
.44L M
NewSettingsJson44M \
)44\ ]
;44] ^
if55 
(55 
accessControlList155 "
==55# %
null55& *
||55+ -
accessControlList255. @
==55A C
null55D H
)55H I
return66 
null66 
;66 
if77 
(77 
accessControlList177 "
.77" #
IsInherited77# .
!=77/ 1
accessControlList2772 D
.77D E
IsInherited77E P
)77P Q
{88 
var99  
contentChangeDetails99 (
=99) *
(99+ ,!
IContentChangeDetails99, A
)99A B
new99B E 
ContentChangeDetails99F Z
(99Z [
)99[ \
;99\ ] 
contentChangeDetails:: $
.::$ %
Name::% )
=::* +
$str::, >
;::> ? 
contentChangeDetails;; $
.;;$ %
OldValue;;% -
=;;. /
accessControlList1;;0 B
.;;B C
IsInherited;;C N
?;;O P
str1;;Q U
:;;V W
str2;;X \
;;;\ ] 
contentChangeDetails<< $
.<<$ %
NewValue<<% -
=<<. /
accessControlList2<<0 B
.<<B C
IsInherited<<C N
?<<O P
str1<<Q U
:<<V W
str2<<X \
;<<\ ]$
contentChangeDetailsList== (
.==( )
Add==) ,
(==, - 
contentChangeDetails==- A
)==A B
;==B C
}>> 
if@@ 
(@@ 
byCommandId@@ 
is@@ "
SecuritySettingCommand@@ 5

secCommand@@6 @
&&@@A C
(@@D E

secCommand@@E O
.@@O P
SecuritySaveType@@P `
==@@a c
SecuritySaveType@@d t
.@@t u"
MergeChildPermissions	@@u Š
||
@@‹ 

secCommand
@@ ˜
.
@@˜ ™
SecuritySaveType
@@™ ©
==
@@ª ¬
SecuritySaveType
@@­ ½
.
@@½ ¾%
ReplaceChildPermissions
@@¾ Õ
)
@@Õ Ö
)
@@Ö ×
{AA 
varBB  
contentChangeDetailsBB (
=BB) *
(BB+ ,!
IContentChangeDetailsBB, A
)BBA B
newBBB E 
ContentChangeDetailsBBF Z
(BBZ [
)BB[ \
;BB\ ] 
contentChangeDetailsCC $
.CC$ %
NameCC% )
=CC* +
$strCC, F
;CCF G 
contentChangeDetailsDD $
.DD$ %
OldValueDD% -
=DD. /
stringDD0 6
.DD6 7
EmptyDD7 <
;DD< = 
contentChangeDetailsEE $
.EE$ %
NewValueEE% -
=EE. /
str1EE0 4
;EE4 5$
contentChangeDetailsListFF (
.FF( )
AddFF) ,
(FF, - 
contentChangeDetailsFF- A
)FFA B
;FFB C
}GG 
varHH !
contentChangeDetails1HH %
=HH& '
(HH( )!
IContentChangeDetailsHH) >
)HH> ?
newHH? B 
ContentChangeDetailsHHC W
(HHW X
)HHX Y
;HHY Z!
contentChangeDetails1II !
.II! "
NewValueII" *
=II+ ,
$strII- /
;II/ 0!
contentChangeDetails1JJ !
.JJ! "
OldValueJJ" *
=JJ+ ,
$strJJ- /
;JJ/ 0!
contentChangeDetails1LL !
.LL! "
NameLL" &
=LL' (
$strLL) >
;LL> ?
varMM 
source1MM 
=MM 
accessControlList1MM ,
.MM, -
EntriesMM- 4
.MM4 5
OrderByMM5 <
(MM< =
eMM= >
=>MM? A
eMMB C
.MMC D
NameMMD H
)MMH I
.MMI J
ToListMMJ P
(MMP Q
)MMQ R
;MMR S
varNN 
source2NN 
=NN 
accessControlList2NN ,
.NN, -
EntriesNN- 4
.NN4 5
OrderByNN5 <
(NN< =
eNN= >
=>NN? A
eNNB C
.NNC D
NameNND H
)NNH I
.NNI J
ToListNNJ P
(NNP Q
)NNQ R
;NNR S
foreachPP 
(PP 
varPP 
accessControlEntry1PP ,
inPP- /
source1PP0 7
)PP7 8
{QQ 
varRR $
currentAccessControlItemRR ,
=RR- .
accessControlEntry1RR/ B
;RRB C
varSS 
accessControlEntry2SS '
=SS( )
source2SS* 1
.SS1 2
FirstOrDefaultSS2 @
(SS@ A
eSSA B
=>SSC E
eSSF G
.SSG H
NameSSH L
.SSL M
EqualsSSM S
(SSS T$
currentAccessControlItemSST l
.SSl m
NameSSm q
,SSq r
StringComparison	SSs ƒ
.
SSƒ „
OrdinalIgnoreCase
SS„ •
)
SS• –
)
SS– —
??
SS˜ š
new
SS›  
AccessControlEntry
SSŸ ±
(
SS± ²&
currentAccessControlItem
SS² Ê
.
SSÊ Ë
Name
SSË Ï
,
SSÏ Ğ
AccessLevel
SSÑ Ü
.
SSÜ İ
	Undefined
SSİ æ
)
SSæ ç
;
SSç è!
contentChangeDetails1TT %
.TT% &
OldValueTT& .
=TT/ 0!
contentChangeDetails1TT1 F
.TTF G
OldValueTTG O
+TTP Q&
LocalizeCurrentAccessLevelTTR l
(TTl m

WebUtilityTTm w
.TTw x

HtmlEncode	TTx ‚
(
TT‚ ƒ&
currentAccessControlItem
TTƒ ›
.
TT› œ
Name
TTœ  
)
TT  ¡
,
TT¡ ¢&
currentAccessControlItem
TT£ »
.
TT» ¼
Access
TT¼ Â
,
TTÂ Ã!
accessControlEntry2
TTÄ ×
.
TT× Ø
Access
TTØ Ş
)
TTŞ ß
+
TTà á
$str
TTâ é
;
TTé ê
}UU 
foreachWW 
(WW 
varWW 
accessControlEntry1WW ,
inWW- /
source2WW0 7
)WW7 8
{XX 
varYY  
newAccessControlItemYY (
=YY) *
accessControlEntry1YY+ >
;YY> ?
varZZ 
accessControlEntry2ZZ '
=ZZ( )
source1ZZ* 1
.ZZ1 2
FirstOrDefaultZZ2 @
(ZZ@ A
eZZA B
=>ZZC E
eZZF G
.ZZG H
NameZZH L
.ZZL M
EqualsZZM S
(ZZS T 
newAccessControlItemZZT h
.ZZh i
NameZZi m
,ZZm n
StringComparisonZZo 
.	ZZ €
OrdinalIgnoreCase
ZZ€ ‘
)
ZZ‘ ’
)
ZZ’ “
??
ZZ” –
new
ZZ— š 
AccessControlEntry
ZZ› ­
(
ZZ­ ®"
newAccessControlItem
ZZ® Â
.
ZZÂ Ã
Name
ZZÃ Ç
,
ZZÇ È
AccessLevel
ZZÉ Ô
.
ZZÔ Õ
	Undefined
ZZÕ Ş
)
ZZŞ ß
;
ZZß à!
contentChangeDetails1[[ %
.[[% &
NewValue[[& .
=[[/ 0!
contentChangeDetails1[[1 F
.[[F G
NewValue[[G O
+[[P Q"
LocalizeNewAccessLevel[[R h
([[h i

WebUtility[[i s
.[[s t

HtmlEncode[[t ~
([[~ !
newAccessControlItem	[[ “
.
[[“ ”
Name
[[” ˜
)
[[˜ ™
,
[[™ š!
accessControlEntry2
[[› ®
.
[[® ¯
Access
[[¯ µ
,
[[µ ¶"
newAccessControlItem
[[· Ë
.
[[Ë Ì
Access
[[Ì Ò
)
[[Ò Ó
+
[[Ô Õ
$str
[[Ö İ
;
[[İ Ş
}\\ !
contentChangeDetails1]] !
.]]! "
OldValue]]" *
=]]+ ,!
contentChangeDetails1]]- B
.]]B C
OldValue]]C K
==]]L N
null]]O S
?]]T U
string]]V \
.]]\ ]
Empty]]] b
:]]c d!
contentChangeDetails1]]e z
.]]z {
OldValue	]]{ ƒ
.
]]ƒ „
ToString
]]„ Œ
(
]]Œ 
)
]] 
.
]] 
TrimEnd
]] –
(
]]– —
$str
]]— 
)
]] Ÿ
;
]]Ÿ  !
contentChangeDetails1^^ !
.^^! "
NewValue^^" *
=^^+ ,!
contentChangeDetails1^^- B
.^^B C
NewValue^^C K
==^^L N
null^^O S
?^^T U
string^^V \
.^^\ ]
Empty^^] b
:^^c d!
contentChangeDetails1^^e z
.^^z {
NewValue	^^{ ƒ
.
^^ƒ „
ToString
^^„ Œ
(
^^Œ 
)
^^ 
.
^^ 
TrimEnd
^^ –
(
^^– —
$str
^^— 
)
^^ Ÿ
;
^^Ÿ  $
contentChangeDetailsList__ $
.__$ %
Add__% (
(__( )!
contentChangeDetails1__) >
)__> ?
;__? @
return`` $
contentChangeDetailsList`` +
;``+ ,
}aa 	
privatecc 
stringcc &
LocalizeCurrentAccessLevelcc 1
(cc1 2
stringcc2 8
accessLevelNamecc9 H
,ccH I
AccessLevelccJ U
currentAccessLevelccV h
,cch i
AccessLevelccj u
newAccessLevel	ccv „
)
cc„ …
{dd 	
varee 
stree 
=ee 
$"ee 
{ee 
accessLevelNameee (
}ee( )
$stree) +
"ee+ ,
;ee, -
stringff 
textff 
;ff 
ifgg 
(gg 
currentAccessLevelgg "
==gg# %
AccessLevelgg& 1
.gg1 2
NoAccessgg2 :
||gg; =
currentAccessLevelgg> P
==ggQ S
AccessLevelggT _
.gg_ `
	Undefinedgg` i
)ggi j
{hh 
textii 
=ii %
GetAccessLevelDescriptionii 0
(ii0 1
currentAccessLevelii1 C
)iiC D
;iiD E
}jj 
elsekk 
{ll 
foreachmm 
(mm 
varmm 
knownAccessLevelmm -
inmm. 0
KnownAccessLevelsmm1 B
)mmB C
{nn 
ifoo 
(oo 
currentAccessLeveloo *
.oo* +
HasFlagoo+ 2
(oo2 3
knownAccessLeveloo3 C
)ooC D
)ooD E
strpp 
=pp 
strpp !
+pp" #%
GetAccessLevelDescriptionpp$ =
(pp= >
knownAccessLevelpp> N
)ppN O
+ppP Q
$strppR V
;ppV W
}qq 
textrr 
=rr 
strrr 
.rr 
TrimEndrr "
(rr" #
$strrr# '
)rr' (
;rr( )
}ss 
iftt 
(tt 
currentAccessLeveltt "
==tt# %
newAccessLeveltt& 4
)tt4 5
textuu 
=uu 
textuu 
.uu 
Fadeuu  
(uu  !
)uu! "
;uu" #
returnvv 
textvv 
;vv 
}ww 	
privateyy 
staticyy 
stringyy "
LocalizeNewAccessLevelyy 4
(yy4 5
stringyy5 ;
accessLevelNameyy< K
,yyK L
AccessLevelyyM X
currentAccessLevelyyY k
,yyk l
AccessLevelyym x
newAccessLevel	yyy ‡
)
yy‡ ˆ
{zz 	
var{{ 
str{{ 
={{ 
$"{{ 
{{{ 
accessLevelName{{ (
}{{( )
$str{{) +
"{{+ ,
;{{, -
string|| 
text1|| 
;|| 
if}} 
(}} 
(}} 
newAccessLevel}} 
==}}  "
AccessLevel}}# .
.}}. /
NoAccess}}/ 7
||}}8 :
newAccessLevel}}; I
==}}J L
AccessLevel}}M X
.}}X Y
	Undefined}}Y b
)}}b c
&&}}d f
newAccessLevel}}g u
==}}v x
currentAccessLevel	}}y ‹
)
}}‹ Œ
{~~ 
text1 
= %
GetAccessLevelDescription 1
(1 2
newAccessLevel2 @
)@ A
;A B
}
€€ 
else
 
{
‚‚ 
foreach
ƒƒ 
(
ƒƒ 
var
ƒƒ 
knownAccessLevel
ƒƒ -
in
ƒƒ. 0
KnownAccessLevels
ƒƒ1 B
)
ƒƒB C
{
„„ 
if
…… 
(
……  
currentAccessLevel
…… *
.
……* +
HasFlag
……+ 2
(
……2 3
knownAccessLevel
……3 C
)
……C D
||
……E G
newAccessLevel
……H V
.
……V W
HasFlag
……W ^
(
……^ _
knownAccessLevel
……_ o
)
……o p
)
……p q
{
†† 
var
‡‡ 
text2
‡‡ !
=
‡‡" #'
GetAccessLevelDescription
‡‡$ =
(
‡‡= >
knownAccessLevel
‡‡> N
)
‡‡N O
;
‡‡O P
if
ˆˆ 
(
ˆˆ  
currentAccessLevel
ˆˆ .
.
ˆˆ. /
HasFlag
ˆˆ/ 6
(
ˆˆ6 7
knownAccessLevel
ˆˆ7 G
)
ˆˆG H
&&
ˆˆI K
!
ˆˆL M
newAccessLevel
ˆˆM [
.
ˆˆ[ \
HasFlag
ˆˆ\ c
(
ˆˆc d
knownAccessLevel
ˆˆd t
)
ˆˆt u
)
ˆˆu v
{
‰‰ 
text2
ŠŠ !
=
ŠŠ" #
text2
ŠŠ$ )
.
ŠŠ) *
Strikethrough
ŠŠ* 7
(
ŠŠ7 8
)
ŠŠ8 9
;
ŠŠ9 :
}
‹‹ 
else
ŒŒ 
if
ŒŒ 
(
ŒŒ  !
!
ŒŒ! " 
currentAccessLevel
ŒŒ" 4
.
ŒŒ4 5
HasFlag
ŒŒ5 <
(
ŒŒ< =
knownAccessLevel
ŒŒ= M
)
ŒŒM N
&&
ŒŒO Q
newAccessLevel
ŒŒR `
.
ŒŒ` a
HasFlag
ŒŒa h
(
ŒŒh i
knownAccessLevel
ŒŒi y
)
ŒŒy z
)
ŒŒz {
{
 
text2
 !
=
" #
text2
$ )
.
) *
Bold
* .
(
. /
)
/ 0
;
0 1
}
 
str
‘‘ 
=
‘‘ 
str
‘‘ !
+
‘‘" #
text2
‘‘$ )
+
‘‘* +
$str
‘‘, 0
;
‘‘0 1
}
’’ 
}
““ 
text1
”” 
=
”” 
str
”” 
.
”” 
TrimEnd
”” #
(
””# $
$str
””$ (
)
””( )
;
””) *
}
•• 
if
–– 
(
––  
currentAccessLevel
–– "
==
––# %
newAccessLevel
––& 4
)
––4 5
text1
—— 
=
—— 
text1
—— 
.
—— 
Fade
—— "
(
——" #
)
——# $
;
——$ %
return
˜˜ 
text1
˜˜ 
;
˜˜ 
}
™™ 	
private
šš 

ContentACL
šš )
GetContentAccessControlList
šš 6
(
šš6 7
string
šš7 =
json
šš> B
)
ššB C
{
›› 	
if
œœ 
(
œœ 
string
œœ 
.
œœ 
IsNullOrEmpty
œœ $
(
œœ$ %
json
œœ% )
)
œœ) *
)
œœ* +
return
 
null
 
;
 
var
 
jObject
 
=
 
JsonConvert
 %
.
% &
DeserializeObject
& 7
<
7 8
JObject
8 ?
>
? @
(
@ A
json
A E
)
E F
;
F G
var
   
isInherited
   
=
   
jObject
   %
[
  % &
$str
  & 3
]
  3 4
?
  4 5
.
  5 6
ToString
  6 >
(
  > ?
)
  ? @
??
  A C
$str
  D F
;
  F G
return
¢¢ 
new
¢¢ 

ContentACL
¢¢ !
{
££ 
IsInherited
¤¤ 
=
¤¤ 
isInherited
¤¤ )
.
¤¤) *
Equals
¤¤* 0
(
¤¤0 1
bool
¤¤1 5
.
¤¤5 6

TrueString
¤¤6 @
,
¤¤@ A
StringComparison
¤¤B R
.
¤¤R S
OrdinalIgnoreCase
¤¤S d
)
¤¤d e
,
¤¤e f
Entries
¥¥ 
=
¥¥ /
!GetAccessControlListFromJsonArray
¥¥ ;
(
¥¥; <
jObject
¥¥< C
[
¥¥C D
$str
¥¥D M
]
¥¥M N
)
¥¥N O
}
¦¦ 
;
¦¦ 
}
§§ 	
private
¨¨ 
List
¨¨ 
<
¨¨  
AccessControlEntry
¨¨ '
>
¨¨' (/
!GetAccessControlListFromJsonArray
¨¨) J
(
¨¨J K
JToken
¨¨K Q
entriesArray
¨¨R ^
)
¨¨^ _
{
©© 	
var
ªª $
accessControlEntryList
ªª &
=
ªª' (
new
ªª) ,
List
ªª- 1
<
ªª1 2 
AccessControlEntry
ªª2 D
>
ªªD E
(
ªªE F
)
ªªF G
;
ªªG H
try
«« 
{
¬¬ 
if
­­ 
(
­­ 
entriesArray
­­  
!=
­­! #
null
­­$ (
)
­­( )
foreach
®® 
(
®® 
var
®®  
entries
®®! (
in
®®) +
entriesArray
®®, 8
)
®®8 9
{
¯¯ 
var
°° 
name
°°  
=
°°! "
entries
°°# *
[
°°* +
$str
°°+ 1
]
°°1 2
?
°°2 3
.
°°3 4
ToString
°°4 <
(
°°< =
)
°°= >
??
°°? A
$str
°°B D
;
°°D E
int
±± 
.
±± 
TryParse
±± $
(
±±$ %
entries
±±% ,
[
±±, -
$str
±±- 5
]
±±5 6
?
±±6 7
.
±±7 8
ToString
±±8 @
(
±±@ A
)
±±A B
,
±±B C
out
±±D G
var
±±H K
access
±±L R
)
±±R S
;
±±S T
int
²² 
.
²² 
TryParse
²² $
(
²²$ %
entries
²²% ,
[
²², -
$str
²²- 9
]
²²9 :
?
²²: ;
.
²²; <
ToString
²²< D
(
²²D E
)
²²E F
,
²²F G
out
²²H K
var
²²L O
entry
²²P U
)
²²U V
;
²²V W
var
´´  
accessControlEntry
´´ .
=
´´/ 0
new
µµ  
AccessControlEntry
µµ  2
(
µµ2 3
name
µµ3 7
,
µµ7 8
(
µµ9 :
AccessLevel
µµ: E
)
µµE F
access
µµF L
,
µµL M
(
µµN O 
SecurityEntityType
µµO a
)
µµa b
entry
µµb g
)
µµg h
;
µµh i$
accessControlEntryList
¶¶ .
.
¶¶. /
Add
¶¶/ 2
(
¶¶2 3 
accessControlEntry
¶¶3 E
)
¶¶E F
;
¶¶F G
}
·· 
}
¸¸ 
catch
¹¹ 
(
¹¹ 
	Exception
¹¹ 
ex
¹¹ 
)
¹¹  
{
ºº 
_logger
»» 
.
»» 
Error
»» 
(
»» 
ex
»»  
.
»»  !
Message
»»! (
,
»»( )
ex
»»* ,
)
»», -
;
»»- .
}
¼¼ 
return
½½ $
accessControlEntryList
½½ )
;
½½) *
}
¾¾ 	
static
ÀÀ 
string
ÀÀ '
GetAccessLevelDescription
ÀÀ /
(
ÀÀ/ 0
AccessLevel
ÀÀ0 ;
accessLevel
ÀÀ< G
)
ÀÀG H
{
ÁÁ 	
switch
ÂÂ 
(
ÂÂ 
accessLevel
ÂÂ 
)
ÂÂ  
{
ÃÃ 
case
ÄÄ 
AccessLevel
ÄÄ  
.
ÄÄ  !
NoAccess
ÄÄ! )
:
ÄÄ) *
return
ÅÅ 
$str
ÅÅ &
;
ÅÅ& '
case
ÆÆ 
AccessLevel
ÆÆ  
.
ÆÆ  !
Read
ÆÆ! %
:
ÆÆ% &
return
ÇÇ 
$str
ÇÇ !
;
ÇÇ! "
case
ÈÈ 
AccessLevel
ÈÈ  
.
ÈÈ  !
Create
ÈÈ! '
:
ÈÈ' (
return
ÉÉ 
$str
ÉÉ #
;
ÉÉ# $
case
ÊÊ 
AccessLevel
ÊÊ  
.
ÊÊ  !
Edit
ÊÊ! %
:
ÊÊ% &
return
ËË 
$str
ËË #
;
ËË# $
case
ÌÌ 
AccessLevel
ÌÌ  
.
ÌÌ  !
Delete
ÌÌ! '
:
ÌÌ' (
return
ÍÍ 
$str
ÍÍ #
;
ÍÍ# $
case
ÎÎ 
AccessLevel
ÎÎ  
.
ÎÎ  !
Publish
ÎÎ! (
:
ÎÎ( )
return
ÏÏ 
$str
ÏÏ $
;
ÏÏ$ %
case
ĞĞ 
AccessLevel
ĞĞ  
.
ĞĞ  !

Administer
ĞĞ! +
:
ĞĞ+ ,
return
ÑÑ 
$str
ÑÑ '
;
ÑÑ' (
case
ÒÒ 
AccessLevel
ÒÒ  
.
ÒÒ  !

FullAccess
ÒÒ! +
:
ÒÒ+ ,
return
ÓÓ 
$str
ÓÓ (
;
ÓÓ( )
case
ÔÔ 
AccessLevel
ÔÔ  
.
ÔÔ  !
	Undefined
ÔÔ! *
:
ÔÔ* +
return
ÕÕ 
$str
ÕÕ &
;
ÕÕ& '
default
ÖÖ 
:
ÖÖ 
return
×× 
$str
×× &
;
××& '
}
ØØ 
}
ÙÙ 	
}
ÜÜ 
}İİ Í
†C:\Projects\adnanzameer\AdvancedTaskManager\net6.0\src\AdvancedTaskManager\Infrastructure\Cms\ChangeApproval\SecuritySettingCommand.cs
	namespace 	
AdvancedTaskManager
 
. 
Infrastructure ,
., -
Cms- 0
.0 1
ChangeApproval1 ?
{ 
[ 
EPiServerDataStore 
( #
AutomaticallyRemapStore /
=0 1
true2 6
)6 7
]7 8
public 

class "
SecuritySettingCommand '
:( )
ApprovalCommandBase* =
{ 
public		 
virtual		 
SecuritySaveType		 '
SecuritySaveType		( 8
{		9 :
get		; >
;		> ?
set		@ C
;		C D
}		E F
}

 
} 
mC:\Projects\adnanzameer\AdvancedTaskManager\net6.0\src\AdvancedTaskManager\Infrastructure\Cms\MenuProvider.cs
	namespace 	
AdvancedTaskManager
 
. 
Infrastructure ,
., -
Cms- 0
{ 
[ 
MenuProvider 
] 
public 

class 
MenuProvider 
: 
IMenuProvider  -
{		 
public

 
IEnumerable

 
<

 
MenuItem

 #
>

# $
GetMenuItems

% 1
(

1 2
)

2 3
{ 	
var 
url 
= 
Paths 
. 

ToResource &
(& '
GetType' .
(. /
)/ 0
,0 1
$str2 =
)= >
;> ?
var 
link 
= 
new 
UrlMenuItem &
(& '
$str #
,# $
	MenuPaths 
. 
Global  
+! "
$str# 6
,6 7
url 
) 
{ 
	SortIndex 
= 
$num 
,  
AuthorizationPolicy #
=$ %
	Constants& /
./ 0

PolicyName0 :
} 
; 
return 
new 
List 
< 
MenuItem $
>$ %
{ 
link 
} 
; 
} 	
} 
} ä]
tC:\Projects\adnanzameer\AdvancedTaskManager\net6.0\src\AdvancedTaskManager\Infrastructure\Cms\NotificationHandler.cs
	namespace 	
AdvancedTaskManager
 
. 
Infrastructure ,
., -
Cms- 0
{ 
public 

	interface  
INotificationHandler )
{ 
Task 
< 
ContentTask 
> 
GetNotifications *
(* +
string+ 1
id2 4
,4 5
ContentTask6 A

customTaskB L
,L M
boolN R
isContentQueryS a
)a b
;b c
} 
public 

class 
NotificationHandler $
:% & 
INotificationHandler' ;
{ 
private 
readonly '
IUserNotificationRepository 4'
_userNotificationRepository5 P
;P Q
private 
readonly "
IAsyncDatabaseExecutor /
_databaseExecutor0 A
;A B
public 
NotificationHandler "
(" #'
IUserNotificationRepository# >&
userNotificationRepository? Y
,Y Z"
IAsyncDatabaseExecutor[ q
databaseExecutor	r ‚
)
‚ ƒ
{ 	'
_userNotificationRepository '
=( )&
userNotificationRepository* D
;D E
_databaseExecutor 
= 
databaseExecutor  0
;0 1
} 	
public 
async 
Task 
< 
ContentTask %
>% &
GetNotifications' 7
(7 8
string8 >
id? A
,A B
ContentTaskC N

customTaskO Y
,Y Z
bool[ _
isContentQuery` n
)n o
{ 	
if 
( 
PrincipalAccessor !
.! "
Current" )
.) *
Identity* 2
!=3 5
null6 :
&&; =
!> ?
string? E
.E F
IsNullOrEmptyF S
(S T
PrincipalAccessorT e
.e f
Currentf m
.m n
Identityn v
.v w
Namew {
){ |
)| }
{   
var!! 
notifications!! !
=!!" #
await!!$ )
GetNotifications!!* :
(!!: ;
PrincipalAccessor!!; L
.!!L M
Current!!M T
.!!T U
Identity!!U ]
.!!] ^
Name!!^ b
,!!b c
id!!d f
,!!f g
isContentQuery!!h v
)!!v w
;!!w x
if## 
(## 
notifications## !
?##! "
.##" #
PagedResult### .
!=##/ 1
null##2 6
&&##7 9
notifications##: G
.##G H
PagedResult##H S
.##S T
Any##T W
(##W X
)##X Y
)##Y Z
{$$ 
foreach&& 
(&& 
var&&  
notification&&! -
in&&. 0
notifications&&1 >
.&&> ?
PagedResult&&? J
)&&J K
{'' 
await(( '
_userNotificationRepository(( 9
.((9 :+
MarkUserNotificationAsReadAsync((: Y
(((Y Z
new((Z ]
NotificationUser((^ n
(((n o
PrincipalAccessor	((o €
.
((€ 
Current
(( ˆ
.
((ˆ ‰
Identity
((‰ ‘
.
((‘ ’
Name
((’ –
)
((– —
,
((— ˜
notification
((™ ¥
.
((¥ ¦
ID
((¦ ¨
)
((¨ ©
;
((© ª
})) 

customTask++ 
.++ 
NotificationUnread++ 1
=++2 3
true++4 8
;++8 9
},, 
else-- 
{.. 

customTask// 
.// 
NotificationUnread// 1
=//2 3
false//4 9
;//9 :
}00 
}11 
return33 

customTask33 
;33 
}44 	
private66 
async66 
Task66 
<66 2
&PagedInternalNotificationMessageResult66 A
>66A B
GetNotifications66C S
(66S T
string66T Z
user66[ _
,66_ `
string66a g
	contentId66h q
,66q r
bool66s w
isContentQuery	66x †
=
66‡ ˆ
true
66‰ 
)
66 
{77 	
return88 
new88 2
&PagedInternalNotificationMessageResult88 =
(88= >
await88> C
_databaseExecutor88D U
.88U V
ExecuteAsync88V b
(88b c
async88c h
(88i j
)88j k
=>88l n
{99 
var:: 
entries:: 
=:: 
new:: !
List::" &
<::& ''
InternalNotificationMessage::' B
>::B C
(::C D
)::D E
;::E F
var;; 
query;; 
=;; 
$str	;; ­
+
;;® ¯
$"<< 
$str<< 1
{<<1 2
user<<2 6
}<<6 7
$str<<7 8
"<<8 9
;<<9 :
if>> 
(>> 
isContentQuery>> "
)>>" #
{?? 
query@@ 
=@@ 
query@@ !
+@@" #
$"@@$ &
$str@@& K
{@@K L
	contentId@@L U
}@@U V
$str@@V Z
"@@Z [
+@@\ ]
$strAA >
+AA? @
$strBB ;
;BB; <
}CC 
elseDD 
{EE 
queryFF 
=FF 
queryFF !
+FF" #
$"FF$ &
$strFF& I
{FFI J
	contentIdFFJ S
}FFS T
$strFFT X
"FFX Y
+FFZ [
$strGG A
;GGA B
}HH 
queryJJ 
=JJ 
queryJJ 
+JJ 
$strJJ  5
+JJ6 7
$strKK -
;KK- .
varMM 
commandMM 
=MM 
_databaseExecutorMM /
.MM/ 0
CreateCommandMM0 =
(MM= >
)MM> ?
;MM? @
commandNN 
.NN 
CommandTextNN #
=NN$ %
queryNN& +
;NN+ ,
commandOO 
.OO 
CommandTypeOO #
=OO$ %
CommandTypeOO& 1
.OO1 2
TextOO2 6
;OO6 7
awaitQQ 
usingQQ 
(QQ 
varQQ  
readerQQ! '
=QQ( )
awaitQQ* /
commandQQ0 7
.QQ7 8
ExecuteReaderAsyncQQ8 J
(QQJ K
)QQK L
.QQL M
ConfigureAwaitQQM [
(QQ[ \
falseQQ\ a
)QQa b
)QQb c
{RR 
whileSS 
(SS 
awaitSS  
readerSS! '
.SS' (
	ReadAsyncSS( 1
(SS1 2
)SS2 3
)SS3 4
{TT 
entriesUU 
.UU  
AddUU  #
(UU# $
CreateUU$ *
(UU* +
readerUU+ 1
)UU1 2
)UU2 3
;UU3 4
}VV 
}WW 
returnXX 
(XX 
IListXX 
<XX '
InternalNotificationMessageXX 9
>XX9 :
)XX: ;
entriesXX; B
;XXB C
}YY 
)YY 
.YY 
ConfigureAwaitYY 
(YY 
falseYY #
)YY# $
,YY$ %
$numYY& (
)YY( )
;YY) *
}ZZ 	
private]] 
static]] '
InternalNotificationMessage]] 2
Create]]3 9
(]]9 :
DbDataReader]]: F
reader]]G M
)]]M N
{^^ 	
var__ 
notificationMessage__ #
=__$ %
new__& )'
InternalNotificationMessage__* E
(__E F
)__F G
{`` 
	Recipientaa 
=aa 
Convertaa #
.aa# $
ToStringaa$ ,
(aa, -
readeraa- 3
[aa3 4
$straa4 ?
]aa? @
)aa@ A
,aaA B
Senderbb 
=bb 
Convertbb  
.bb  !
ToStringbb! )
(bb) *
readerbb* 0
[bb0 1
$strbb1 9
]bb9 :
)bb: ;
,bb; <
ChannelNamecc 
=cc 
Convertcc %
.cc% &
ToStringcc& .
(cc. /
readercc/ 5
[cc5 6
$strcc6 ?
]cc? @
)cc@ A
,ccA B
TypeNamedd 
=dd 
Convertdd "
.dd" #
ToStringdd# +
(dd+ ,
readerdd, 2
[dd2 3
$strdd3 9
]dd9 :
)dd: ;
,dd; <
Subjectee 
=ee 
Convertee !
.ee! "
ToStringee" *
(ee* +
readeree+ 1
[ee1 2
$stree2 ;
]ee; <
)ee< =
,ee= >
Contentff 
=ff 
Convertff !
.ff! "
ToStringff" *
(ff* +
readerff+ 1
[ff1 2
$strff2 ;
]ff; <
)ff< =
,ff= >
IDgg 
=gg 
Convertgg 
.gg 
ToInt32gg $
(gg$ %
readergg% +
[gg+ ,
$strgg, 0
]gg0 1
)gg1 2
,gg2 3
Savedhh 
=hh 
Converthh 
.hh  

ToDateTimehh  *
(hh* +
readerhh+ 1
[hh1 2
$strhh2 9
]hh9 :
)hh: ;
.hh; <
ToLocalTimehh< G
(hhG H
)hhH I
}ii 
;ii 
varjj 
obj1jj 
=jj 
readerjj 
[jj 
$strjj $
]jj$ %
;jj% &
ifkk 
(kk 
obj1kk 
!=kk 
DBNullkk 
.kk 
Valuekk $
)kk$ %
notificationMessagell #
.ll# $
Sentll$ (
=ll) *
Convertll+ 2
.ll2 3

ToDateTimell3 =
(ll= >
obj1ll> B
)llB C
.llC D
ToLocalTimellD O
(llO P
)llP Q
;llQ R
varnn 
obj2nn 
=nn 
readernn 
[nn 
$strnn &
]nn& '
;nn' (
ifoo 
(oo 
obj2oo 
!=oo 
DBNulloo 
.oo 
Valueoo $
)oo$ %
notificationMessagepp #
.pp# $
SendAtpp$ *
=pp+ ,
Convertpp- 4
.pp4 5

ToDateTimepp5 ?
(pp? @
obj2pp@ D
)ppD E
.ppE F
ToLocalTimeppF Q
(ppQ R
)ppR S
;ppS T
varrr 
obj3rr 
=rr 
readerrr 
[rr 
$strrr $
]rr$ %
;rr% &
ifss 
(ss 
obj3ss 
!=ss 
DBNullss 
.ss 
Valuess $
)ss$ %
notificationMessagett #
.tt# $
Readtt$ (
=tt) *
Converttt+ 2
.tt2 3

ToDateTimett3 =
(tt= >
obj3tt> B
)ttB C
.ttC D
ToLocalTimettD O
(ttO P
)ttP Q
;ttQ R
varvv 
obj4vv 
=vv 
readervv 
[vv 
$strvv (
]vv( )
;vv) *
ifww 
(ww 
obj4ww 
!=ww 
DBNullww 
.ww 
Valueww $
)ww$ %
notificationMessagexx #
.xx# $
Categoryxx$ ,
=xx- .
newxx/ 2
Urixx3 6
(xx6 7
Convertxx7 >
.xx> ?
ToStringxx? G
(xxG H
obj4xxH L
)xxL M
??xxN P
stringxxQ W
.xxW X
EmptyxxX ]
)xx] ^
;xx^ _
returnzz 
notificationMessagezz &
;zz& '
}{{ 	
}|| 
}}} ‡
…C:\Projects\adnanzameer\AdvancedTaskManager\net6.0\src\AdvancedTaskManager\Infrastructure\Configuration\AdvancedTaskManagerOptions.cs
	namespace 	
AdvancedTaskManager
 
. 
Infrastructure ,
., -
Configuration- :
{ 
public 

class &
AdvancedTaskManagerOptions +
{ 
public 
int 
WarningDays 
{  
get! $
;$ %
set& )
;) *
}+ ,
=- .
$num/ 0
;0 1
public 
int 
PageSize 
{ 
get !
;! "
set# &
;& '
}( )
=* +
$num, .
;. /
public 
bool %
DeleteChangeApprovalTasks -
{. /
get0 3
;3 4
set5 8
;8 9
}: ;
=< =
true> B
;B C
public 
bool 1
%DeleteContentApprovalDeadlineProperty 9
{: ;
get< ?
;? @
setA D
;D E
}F G
=H I
falseJ O
;O P
public		 
bool		 .
"AddContentApprovalDeadlineProperty		 6
{		7 8
get		9 <
;		< =
set		> A
;		A B
}		C D
=		E F
false		G L
;		L M
public

 
string

 
DateTimeFormat

 $
{

% &
get

' *
;

* +
set

, /
;

/ 0
}

1 2
=

3 4
$str

5 G
;

G H
public 
string &
DateTimeFormatUserFriendly 0
{1 2
get3 6
;6 7
set8 ;
;; <
}= >
=? @
$strA [
;[ \
} 
} Ó6
†C:\Projects\adnanzameer\AdvancedTaskManager\net6.0\src\AdvancedTaskManager\Infrastructure\Configuration\ServiceCollectionExtensions.cs
	namespace 	
AdvancedTaskManager
 
. 
Infrastructure ,
., -
Configuration- :
{ 
public 

static 
class '
ServiceCollectionExtensions 3
{ 
private 
static 
readonly 
Action  &
<& '&
AuthorizationPolicyBuilder' A
>A B
DefaultPolicyC P
=Q R
pS T
=>U W
pX Y
.Y Z
RequireRoleZ e
(e f
Rolesf k
.k l
Administratorsl z
,z {
Roles	| 
.
 ‚
	WebAdmins
‚ ‹
,
‹ Œ
Roles
 ’
.
’ “
	CmsAdmins
“ œ
)
œ 
;
 
public 
static 
IServiceCollection (
AddAdvancedTask) 8
(8 9
this9 =
IServiceCollection> P
servicesQ Y
,Y Z
Action[ a
<a b&
AdvancedTaskManagerOptionsb |
>| }
setupAction	~ ‰
)
‰ Š
{ 	
return 
services 
. 
AddAdvancedTask +
(+ ,
setupAction, 7
,7 8
DefaultPolicy9 F
)F G
;G H
} 	
public 
static 
IServiceCollection (
AddAdvancedTask) 8
(8 9
this9 =
IServiceCollection> P
servicesQ Y
,Y Z
Action[ a
<a b&
AdvancedTaskManagerOptionsb |
>| }
setupAction	~ ‰
,
‰ Š
Action
‹ ‘
<
‘ ’(
AuthorizationPolicyBuilder
’ ¬
>
¬ ­
configurePolicy
® ½
)
½ ¾
{ 	
services 
. 
AddTransient !
<! "
	IUIHelper" +
,+ ,
UIHelper- 5
>5 6
(6 7
)7 8
;8 9
services 
. 
AddTransient !
<! "
IChangeTaskHelper" 3
,3 4
ChangeTaskHelper5 E
>E F
(F G
)G H
;H I
services 
. 
AddTransient !
<! "$
IExpirationChangeDetails" :
,: ;#
ExpirationChangeDetails< S
>S T
(T U
)U V
;V W
services 
. 
AddTransient !
<! "&
ICommandMetaDataRepository" <
,< =,
 DefaultCommandMetaDataRepository> ^
>^ _
(_ `
)` a
;a b
services 
. 
AddTransient !
<! ""
ILanguageChangeDetails" 8
,8 9!
LanguageChangeDetails: O
>O P
(P Q
)Q R
;R S
services 
. 
AddTransient !
<! ""
IApprovalCommandMapper" 8
,8 9!
ApprovalCommandMapper: O
>O P
(P Q
)Q R
;R S
services   
.   
AddTransient   !
<  ! "
IMovingChangeDetail  " 5
,  5 6
MovingChangeDetail  7 I
>  I J
(  J K
)  K L
;  L M
services!! 
.!! 
AddTransient!! !
<!!! "!
ISecurityChangeDetail!!" 7
,!!7 8 
SecurityChangeDetail!!9 M
>!!M N
(!!N O
)!!O P
;!!P Q
services"" 
."" 
AddTransient"" !
<""! "#
IApprovalCommandService""" 9
,""9 :"
ApprovalCommandService""; Q
>""Q R
(""R S
)""S T
;""T U
services## 
.## 
AddTransient## !
<##! "*
IApprovalCommandRepositoryBase##" @
,##@ A)
ApprovalCommandRepositoryBase##B _
>##_ `
(##` a
)##a b
;##b c
services$$ 
.$$ 
AddTransient$$ !
<$$! " 
INotificationHandler$$" 6
,$$6 7
NotificationHandler$$8 K
>$$K L
($$L M
)$$M N
;$$N O
services&& 
.&& 
	Configure&& 
<&& "
ProtectedModuleOptions&& 5
>&&5 6
(&&6 7
pm'' 
=>'' 
{(( 
if)) 
()) 
!)) 
pm)) 
.)) 
Items)) !
.))! "
Any))" %
())% &
i))& '
=>))( *
i))+ ,
.)), -
Name))- 1
.))1 2
Equals))2 8
())8 9
	Constants))9 B
.))B C

ModuleName))C M
,))M N
StringComparison))O _
.))_ `
OrdinalIgnoreCase))` q
)))q r
)))r s
)))s t
{** 
pm++ 
.++ 
Items++  
.++  !
Add++! $
(++$ %
new++% (
(++( )
)++) *
{+++ ,
Name++- 1
=++2 3
	Constants++4 =
.++= >

ModuleName++> H
}++I J
)++J K
;++K L
},, 
}-- 
)-- 
;-- 
var// 
providerOptions// 
=//  !
new//" %&
AdvancedTaskManagerOptions//& @
(//@ A
)//A B
;//B C
setupAction00 
(00 
providerOptions00 '
)00' (
;00( )
services22 
.22 

AddOptions22 
<22  &
AdvancedTaskManagerOptions22  :
>22: ;
(22; <
)22< =
.22= >
	Configure22> G
<22G H
IConfiguration22H V
>22V W
(22W X
(22X Y
options22Y `
,22` a
configuration22b o
)22o p
=>22q s
{33 
setupAction44 
(44 
options44 #
)44# $
;44$ %
configuration55 
.55 

GetSection55 (
(55( )
$str55) >
)55> ?
.55? @
Bind55@ D
(55D E
options55E L
)55L M
;55M N
}66 
)66 
;66 
services88 
.88 
AddAuthorization88 %
(88% &
options88& -
=>88. 0
{99 
options:: 
.:: 
	AddPolicy:: !
(::! "
	Constants::" +
.::+ ,

PolicyName::, 6
,::6 7
configurePolicy::8 G
)::G H
;::H I
};; 
);; 
;;; 
return== 
services== 
;== 
}>> 	
}?? 
}@@ Ù
fC:\Projects\adnanzameer\AdvancedTaskManager\net6.0\src\AdvancedTaskManager\Infrastructure\Constants.cs
	namespace 	
AdvancedTaskManager
 
. 
Infrastructure ,
{ 
public 

static 
class 
	Constants !
{ 
public 
const 
string 

ModuleName &
=' (
$str) >
;> ?
public 
const 
string 

PolicyName &
=' (
$str) 8
;8 9
} 
} ™/
{C:\Projects\adnanzameer\AdvancedTaskManager\net6.0\src\AdvancedTaskManager\Infrastructure\Helpers\ApprovalCommandService.cs
	namespace 	
AdvancedTaskManager
 
. 
Infrastructure ,
., -
Helpers- 4
{ 
public 

	interface #
IApprovalCommandService ,
{ 
ApprovalCommandBase 
GetCommandById *
(* +
Guid+ /
	commandId0 9
)9 :
;: ;
ApprovalCommandBase		 "
GetCommandByApprovalId		 2
(		2 3
int		3 6

approvalId		7 A
)		A B
;		B C
}

 
public 

class "
ApprovalCommandService '
:( )#
IApprovalCommandService* A
{ 
private 
readonly &
ICommandMetaDataRepository 3&
_commandMetaDataRepository4 N
;N O
private 
readonly *
IApprovalCommandRepositoryBase 7*
_approvalCommandRepositoryBase8 V
;V W
public "
ApprovalCommandService %
(% &&
ICommandMetaDataRepository& @
cmdRepositoryA N
,N O*
IApprovalCommandRepositoryBaseP n*
approvalCommandRepositoryBase	o Œ
)
Œ 
{ 	&
_commandMetaDataRepository &
=' (
cmdRepository) 6
;6 7*
_approvalCommandRepositoryBase *
=+ ,)
approvalCommandRepositoryBase- J
;J K
} 	
public 
ApprovalCommandBase "
GetCommandById# 1
(1 2
Guid2 6
	commandId7 @
)@ A
{ 	
var 
byCommandId 
= &
_commandMetaDataRepository 8
.8 9
GetByCommandId9 G
(G H
	commandIdH Q
)Q R
;R S
return 
byCommandId 
== !
null" &
?' (
null) -
:. /
GetApprovalCommand0 B
(B C
byCommandIdC N
.N O
TypeO S
,S T
byCommandIdU `
.` a
	CommandIda j
)j k
;k l
} 	
public 
ApprovalCommandBase ""
GetCommandByApprovalId# 9
(9 :
int: =

approvalId> H
)H I
{ 	
var   
byApprovalId   
=   &
_commandMetaDataRepository   9
.  9 :
GetByApprovalId  : I
(  I J

approvalId  J T
)  T U
;  U V
return!! 
byApprovalId!! 
==!!  "
null!!# '
?!!( )
null!!* .
:!!/ 0
GetApprovalCommand!!1 C
(!!C D
byApprovalId!!D P
.!!P Q
Type!!Q U
,!!U V
byApprovalId!!W c
.!!c d
	CommandId!!d m
)!!m n
;!!n o
}"" 	
public%% 
CommandMetaData%% *
GetCommandMetaDataByApprovalId%% =
(%%= >
int%%> A

approvalId%%B L
)%%L M
{&& 	
var'' 
byApprovalId'' 
='' &
_commandMetaDataRepository'' 9
.''9 :
GetByApprovalId'': I
(''I J

approvalId''J T
)''T U
;''U V
return(( 
byApprovalId(( 
;((  
})) 	
private++ 
ApprovalCommandBase++ #
GetApprovalCommand++$ 6
(++6 7
string++7 =
commandTypeName++> M
,++M N
Guid++O S
	commandId++T ]
)++] ^
{,, 	
ApprovalCommandBase-- 
byCommandId--  +
=--, -
null--. 2
;--2 3
if// 
(// 
commandTypeName// 
.//  
EndsWith//  (
(//( )
$str//) ?
)//? @
)//@ A
{00 
byCommandId11 
=11 *
_approvalCommandRepositoryBase11 <
.11< =
GetByCommandId11= K
<11K L 
MovingContentCommand11L `
>11` a
(11a b
	commandId11b k
,11k l
commandTypeName11m |
)11| }
;11} ~
}22 
else33 
if33 
(33 
commandTypeName33 $
.33$ %
EndsWith33% -
(33- .
$str33. L
)33L M
)33M N
{44 
byCommandId55 
=55 *
_approvalCommandRepositoryBase55 <
.55< =
GetByCommandId55= K
<55K L(
ExpirationDateSettingCommand55L h
>55h i
(55i j
	commandId55j s
,55s t
commandTypeName	55u „
)
55„ …
;
55… †
}66 
else77 
if77 
(77 
commandTypeName77 $
.77$ %
EndsWith77% -
(77- .
$str77. F
)77F G
)77G H
{88 
byCommandId99 
=99 *
_approvalCommandRepositoryBase99 <
.99< =
GetByCommandId99= K
<99K L"
LanguageSettingCommand99L b
>99b c
(99c d
	commandId99d m
,99m n
commandTypeName99o ~
)99~ 
;	99 €
}:: 
else;; 
if;; 
(;; 
commandTypeName;; $
.;;$ %
EndsWith;;% -
(;;- .
$str;;. F
);;F G
);;G H
{<< 
byCommandId== 
=== *
_approvalCommandRepositoryBase== <
.==< =
GetByCommandId=== K
<==K L"
SecuritySettingCommand==L b
>==b c
(==c d
	commandId==d m
,==m n
commandTypeName==o ~
)==~ 
;	== €
}>> 
return@@ 
byCommandId@@ 
;@@ 
}AA 	
}CC 
}DD Ê$
‚C:\Projects\adnanzameer\AdvancedTaskManager\net6.0\src\AdvancedTaskManager\Infrastructure\Helpers\ChangeApprovalReferenceHelper.cs
	namespace 	
AdvancedTaskManager
 
. 
Infrastructure ,
., -
Helpers- 4
{ 
public 

static 
class )
ChangeApprovalReferenceHelper 5
{		 
public

 
static

 
Uri

 
GetUri

  
(

  !
ContentReference

! 1
contentLink

2 =
,

= >
bool

? C
ignoreVersion

D Q
)

Q R
{ 	
if 
( 
ContentReference  
.  !
IsNullOrEmpty! .
(. /
contentLink/ :
): ;
); <
return 
null 
; 
var 
	uriString 
= 
$" 
{ %
ChangeApprovalTypeFactory ,
., -
ChangeApprovalType- ?
}? @
$str@ A
{A B
contentLinkB M
.M N
ProviderNameN Z
??[ ]
$str^ `
}` a
$stra b
{b c
contentLinkc n
.n o
IDo q
}q r
$strr s
"s t
;t u
if 
( 
! 
ignoreVersion 
&& !
contentLink" -
.- .
WorkID. 4
!=5 7
$num8 9
)9 :
	uriString 
= 
	uriString %
+& '
contentLink( 3
.3 4
WorkID4 :
+; <
$str= @
;@ A
return 
new 
Uri 
( 
	uriString $
)$ %
;% &
} 	
public 
static 
ContentReference &
GetContentReference' :
(: ;
Uri; >
key? B
)B C
{ 	
if 
( 
key 
== 
null 
|| 
!  
key  #
.# $
Scheme$ *
.* +
Equals+ 1
(1 2%
ChangeApprovalTypeFactory2 K
.K L
ChangeApprovalTypeL ^
)^ _
)_ `
return 
null 
; 
var 
list 
= 
key 
. 
Segments #
.# $
Select$ *
(* +
x+ ,
=>- /
x0 1
.1 2
Replace2 9
(9 :
$str: =
,= >
$str? A
)A B
)B C
.C D
ToListD J
(J K
)K L
;L M
if 
( 
list 
. 
Count 
< 
$num 
|| !
list" &
.& '
Count' ,
>- .
$num/ 0
)0 1
return 
null 
; 
var 
providerName 
= 
string %
.% &
IsNullOrEmpty& 3
(3 4
list4 8
[8 9
$num9 :
]: ;
); <
?= >
null? C
:D E
listF J
[J K
$numK L
]L M
;M N
if 
( 
! 
int 
. 
TryParse 
( 
list "
[" #
$num# $
]$ %
,% &
out' *
var+ .
result1/ 6
)6 7
)7 8
return 
null 
; 
var 
result2 
= 
$num 
; 
return   
list   
.   
Count   
>   
$num    !
&&  " $
list  % )
[  ) *
$num  * +
]  + ,
!=  - /
string  0 6
.  6 7
Empty  7 <
&&  = ?
!  @ A
int  A D
.  D E
TryParse  E M
(  M N
list  N R
[  R S
$num  S T
]  T U
,  U V
out  W Z
result2  [ b
)  b c
?  d e
null  f j
:  k l
new  m p
ContentReference	  q 
(
   ‚
result1
  ‚ ‰
,
  ‰ Š
result2
  ‹ ’
,
  ’ “
providerName
  ”  
)
    ¡
;
  ¡ ¢
}!! 	
}"" 
}## ›4
uC:\Projects\adnanzameer\AdvancedTaskManager\net6.0\src\AdvancedTaskManager\Infrastructure\Helpers\ChangeTaskHelper.cs
	namespace 	
AdvancedTaskManager
 
. 
Infrastructure ,
., -
Helpers- 4
{ 
public		 

	interface		 
IChangeTaskHelper		 &
{

 
ChangeTaskDetail 
GetData  
(  !
int! $
id% '
)' (
;( )
} 
public 

class 
ChangeTaskHelper !
:" #
IChangeTaskHelper$ 5
{ 
private 
readonly #
IApprovalCommandService 0"
_generalCommandService1 G
;G H
private 
readonly "
IApprovalCommandMapper /"
_approvalCommandMapper0 F
;F G
private 
readonly "
ILanguageChangeDetails /"
_languageChangeDetails0 F
;F G
private 
readonly 
IMovingChangeDetail ,
_movingChangeDetail- @
;@ A
private 
readonly !
ISecurityChangeDetail .!
_securityChangeDetail/ D
;D E
private 
readonly $
IExpirationChangeDetails 1$
_expirationChangeDetails2 J
;J K
public 
ChangeTaskHelper 
(  #
IApprovalCommandService  7!
generalCommandService8 M
,M N"
IApprovalCommandMapperO e!
approvalCommandMapperf {
,{ |#
ILanguageChangeDetails	} “#
languageChangeDetails
” ©
,
© ª!
IMovingChangeDetail
« ¾ 
movingChangeDetail
¿ Ñ
,
Ñ Ò#
ISecurityChangeDetail
Ó è"
securityChangeDetail
é ı
,
ı ş&
IExpirationChangeDetails
ÿ —%
expirationChangeDetails
˜ ¯
)
¯ °
{ 	"
_generalCommandService "
=# $!
generalCommandService% :
;: ;"
_approvalCommandMapper "
=# $!
approvalCommandMapper% :
;: ;"
_languageChangeDetails "
=# $!
languageChangeDetails% :
;: ;
_movingChangeDetail 
=  !
movingChangeDetail" 4
;4 5!
_securityChangeDetail !
=" # 
securityChangeDetail$ 8
;8 9$
_expirationChangeDetails $
=% &#
expirationChangeDetails' >
;> ?
} 	
public"" 
ChangeTaskDetail"" 
GetData""  '
(""' (
int""( +
id"", .
)"". /
{## 	
var$$ 
commandByApprovalId$$ #
=$$$ %"
_generalCommandService$$& <
.$$< ="
GetCommandByApprovalId$$= S
($$S T
id$$T V
)$$V W
;$$W X
var%% 
taskDetails%% 
=%% 
commandByApprovalId%% 1
!=%%2 4
null%%5 9
?%%: ;"
_approvalCommandMapper%%< R
.%%R S
Map%%S V
(%%V W
commandByApprovalId%%W j
,%%j k
PrincipalAccessor%%l }
.%%} ~
Current	%%~ …
)
%%… †
:
%%‡ ˆ
null
%%‰ 
;
%% 
if&& 
(&& 
taskDetails&& 
!=&& 
null&& #
)&&# $
{'' 
var(( 

customTask(( 
=((  
new((! $
ChangeTaskDetail((% 5
(((5 6
)((6 7
;((7 8
if)) 
()) 
taskDetails)) 
.))  
TypeIdentifier))  .
.)). /
ToLower))/ 6
())6 7
)))7 8
.))8 9
EndsWith))9 A
())A B
$str))B X
)))X Y
)))Y Z
{** 

customTask++ 
.++ 
Type++ #
=++$ %
$str++& 6
;++6 7

customTask,, 
.,, 
Details,, &
=,,' (
_movingChangeDetail,,) <
.,,< ="
GetMovingChangeDetails,,= S
(,,S T
taskDetails,,T _
),,_ `
;,,` a
}-- 
else.. 
if.. 
(.. 
taskDetails.. $
...$ %
TypeIdentifier..% 3
...3 4
ToLower..4 ;
(..; <
)..< =
...= >
EndsWith..> F
(..F G
$str..G e
)..e f
)..f g
{// 

customTask00 
.00 
Type00 #
=00$ %
$str00& ?
;00? @

customTask11 
.11 
Details11 &
=11' ($
_expirationChangeDetails11) A
.11A B-
!GetExpirationCommandChangeDetails11B c
(11c d
taskDetails11d o
)11o p
;11p q
}22 
else33 
if33 
(33 
taskDetails33 $
.33$ %
TypeIdentifier33% 3
.333 4
ToLower334 ;
(33; <
)33< =
.33= >
EndsWith33> F
(33F G
$str33G _
)33_ `
)33` a
{44 

customTask55 
.55 
Type55 #
=55$ %
$str55& 8
;558 9

customTask66 
.66 
Details66 &
=66' ("
_languageChangeDetails66) ?
.66? @$
GetLanguageChangeDetails66@ X
(66X Y
taskDetails66Y d
)66d e
;66e f
}77 
else88 
if88 
(88 
taskDetails88 $
.88$ %
TypeIdentifier88% 3
.883 4
ToLower884 ;
(88; <
)88< =
.88= >
EndsWith88> F
(88F G
$str88G _
)88_ `
)88` a
{99 

customTask:: 
.:: 
Type:: #
=::$ %
$str::& 8
;::8 9

customTask;; 
.;; 
Details;; &
=;;' (!
_securityChangeDetail;;) >
.;;> ?$
GetSecurityChangeDetails;;? W
(;;W X
new;;X [
Guid;;\ `
(;;` a
taskDetails;;a l
.;;l m
Id;;m o
);;o p
);;p q
;;;q r
}<< 

customTask>> 
.>> 
Name>> 
=>>  !
taskDetails>>" -
.>>- .
Name>>. 2
;>>2 3
return@@ 

customTask@@ !
;@@! "
}AA 
returnCC 
nullCC 
;CC 
}DD 	
}FF 
}GG Ÿ#
oC:\Projects\adnanzameer\AdvancedTaskManager\net6.0\src\AdvancedTaskManager\Infrastructure\Helpers\Extensions.cs
	namespace 	
AdvancedTaskManager
 
. 
Infrastructure ,
., -
Helpers- 4
{		 
public

 

static

 
class

 

Extensions

 "
{ 
public 
static 
IEnumerable !
<! "
DateTime" *
>* +
GetDaysInRange, :
(: ;
this; ?
DateTime@ H
	startDateI R
,R S
DateTimeT \
endDate] d
)d e
{ 	
if 
( 
endDate 
< 
	startDate #
)# $
return 

Enumerable !
.! "
Empty" '
<' (
DateTime( 0
>0 1
(1 2
)2 3
;3 4
return 

Enumerable 
. 
Range #
(# $
$num$ %
,% &
$num' (
+) *
endDate+ 2
.2 3
Subtract3 ;
(; <
	startDate< E
)E F
.F G
DaysG K
)K L
. 
Select 
( 
offset 
=> !
	startDate" +
.+ ,
AddDays, 3
(3 4
offset4 :
): ;
); <
. 
ToArray 
( 
) 
; 
} 	
public 
static 
int 
CountDaysInRange *
(* +
this+ /
DateTime0 8
	startDate9 B
,B C
DateTimeD L
endDateM T
)T U
{ 	
var 
dates 
= 
	startDate !
.! "
GetDaysInRange" 0
(0 1
endDate1 8
)8 9
;9 :
return 
dates 
. 
Count 
( 
)  
;  !
} 	
public 
static 
T 
ToObject  
<  !
T! "
>" #
(# $
this$ (
string) /
value0 5
)5 6
where7 <
T= >
:? @
classA F
{ 	
if   
(   
string   
.   
IsNullOrEmpty   $
(  $ %
value  % *
)  * +
)  + ,
return!! 
default!! 
;!! 
return"" 
JsonConvert"" 
."" 
DeserializeObject"" 0
<""0 1
T""1 2
>""2 3
(""3 4
value""4 9
,""9 :
new""; >"
JsonSerializerSettings""? U
(""U V
)""V W
{## 
TypeNameHandling$$  
=$$! "
TypeNameHandling$$# 3
.$$3 4
Objects$$4 ;
}%% 
)%% 
;%% 
}&& 	
public(( 
static(( 
string(( 

GetEditUrl(( '
(((' (
this((( ,
ContentReference((- =
contentLink((> I
)((I J
{)) 	
return** 
$"** 
{** "
ModuleResourceResolver** ,
.**, -
Instance**- 5
.**5 6
ResolvePath**6 A
(**A B
$str**B G
,**G H
null**I M
)**M N
}**N O
$str**O o
{**o p
contentLink**p {
}**{ |
"**| }
;**} ~
}++ 	
public-- 
static-- 
string-- 

GetEditUrl-- '
(--' (
this--( ,
ContentReference--- =
contentLink--> I
,--I J
string--K Q
language--R Z
)--Z [
{.. 	
return// 
$"// 
{// "
ModuleResourceResolver// ,
.//, -
Instance//- 5
.//5 6
ResolvePath//6 A
(//A B
$str//B G
,//G H
null//I M
)//M N
.//N O
TrimEnd//O V
(//V W
$char//W Z
)//Z [
}//[ \
$str//\ g
{//g h
language//h p
}//p q
$str	//q ‘
{
//‘ ’
contentLink
//’ 
}
// 
"
// Ÿ
;
//Ÿ  
}00 	
}11 
}22 ­
yC:\Projects\adnanzameer\AdvancedTaskManager\net6.0\src\AdvancedTaskManager\Infrastructure\Helpers\SettingCommandHelper.cs
	namespace 	
AdvancedTaskManager
 
. 
Infrastructure ,
., -
Helpers- 4
{ 
public 

static 
class  
SettingCommandHelper ,
{ 
public 
static 
string 
Fade !
(! "
this" &
string' -
text. 2
)2 3
{ 	
return 
! 
string 
. 
IsNullOrEmpty (
(( )
text) -
)- .
?/ 0
$"1 3
$str3 Z
{Z [
text[ _
}_ `
$str` g
"g h
:i j
$strk m
;m n
} 	
public

 
static

 
string

 
Bold

 !
(

! "
this

" &
string

' -
text

. 2
)

2 3
{ 	
return 
! 
string 
. 
IsNullOrEmpty (
(( )
text) -
)- .
?/ 0
$"1 3
$str3 ;
{; <
text< @
}@ A
$strA J
"J K
:L M
$strN P
;P Q
} 	
public 
static 
string 
Strikethrough *
(* +
this+ /
string0 6
text7 ;
); <
{ 	
return 
! 
string 
. 
IsNullOrEmpty (
(( )
text) -
)- .
?/ 0
$"1 3
$str3 8
{8 9
text9 =
}= >
$str> D
"D E
:F G
$strH J
;J K
} 	
} 
} £/
mC:\Projects\adnanzameer\AdvancedTaskManager\net6.0\src\AdvancedTaskManager\Infrastructure\Helpers\UIHelper.cs
	namespace		 	
AdvancedTaskManager		
 
.		 
Infrastructure		 ,
.		, -
Helpers		- 4
{

 
public 

	interface 
	IUIHelper 
{ 
string !
GetDisplayNameForUser $
($ %
string% +
senderUsername, :
): ;
;; <
bool 
CanUserPublish 
< 
T 
> 
( 
T  
content! (
)( )
where* /
T0 1
:2 3
IContent4 <
;< =
Task 
< 
List 
< 
string 
> 
> 
GetUserRoles '
(' (
)( )
;) *
} 
public 

class 
UIHelper 
: 
	IUIHelper %
{ 
private 
readonly ,
 QueryableNotificationUserService 9-
!_queryableNotificationUserService: [
;[ \
private 
readonly "
SecurityEntityProvider /#
_securityEntityProvider0 G
;G H
public 
UIHelper 
( ,
 QueryableNotificationUserService 8,
 queryableNotificationUserService9 Y
,Y Z"
SecurityEntityProvider[ q#
securityEntityProvider	r ˆ
)
ˆ ‰
{ 	-
!_queryableNotificationUserService -
=. /,
 queryableNotificationUserService0 P
;P Q#
_securityEntityProvider #
=$ %"
securityEntityProvider& <
;< =
} 	
public 
string !
GetDisplayNameForUser +
(+ ,
string, 2
senderUsername3 A
)A B
{ 	
if 
( 
string 
. 
IsNullOrEmpty $
($ %
senderUsername% 3
)3 4
)4 5
return 
null 
; 
var   
result   
=   -
!_queryableNotificationUserService   :
.  : ;
GetAsync  ; C
(  C D
senderUsername  D R
)  R S
.  S T
ConfigureAwait  T b
(  b c
false  c h
)  h i
.  i j

GetAwaiter  j t
(  t u
)  u v
.  v w
	GetResult	  w €
(
  € 
)
   ‚
;
  ‚ ƒ
if"" 
("" 
result"" 
=="" 
null"" 
)"" 
return## 
null## 
;## 
if%% 
(%% 
PrincipalAccessor%% !
.%%! "
Current%%" )
.%%) *
Identity%%* 2
!=%%3 5
null%%6 :
)%%: ;
{&& 
var'' 
name'' 
='' 
PrincipalAccessor'' ,
.'', -
Current''- 4
.''4 5
Identity''5 =
.''= >
Name''> B
;''B C
if(( 
((( 
result(( 
.(( 
UserName(( #
.((# $
Equals(($ *
(((* +
name((+ /
,((/ 0
StringComparison((1 A
.((A B
OrdinalIgnoreCase((B S
)((S T
)((T U
return)) 
$str))  
;))  !
}** 
return,, 
!,, 
string,, 
.,, 
IsNullOrEmpty,, (
(,,( )
result,,) /
.,,/ 0
DisplayName,,0 ;
),,; <
?,,= >
result,,? E
.,,E F
DisplayName,,F Q
:,,R S
result,,T Z
.,,Z [
UserName,,[ c
;,,c d
}-- 	
public// 
async// 
Task// 
<// 
List// 
<// 
string// %
>//% &
>//& '
GetUserRoles//( 4
(//4 5
)//5 6
{00 	
if11 
(11 
PrincipalAccessor11 !
.11! "
Current11" )
.11) *
Identity11* 2
!=113 5
null116 :
)11: ;
{22 
var33 
name33 
=33 
PrincipalAccessor33 ,
.33, -
Current33- 4
.334 5
Identity335 =
.33= >
Name33> B
;33B C
var44 
roles44 
=44 
await44 !#
_securityEntityProvider44" 9
.449 : 
GetRolesForUserAsync44: N
(44N O
name44O S
)44S T
;44T U
return55 
roles55 
.55 
ToList55 #
(55# $
)55$ %
;55% &
}66 
return88 
new88 
List88 
<88 
string88 "
>88" #
(88# $
)88$ %
;88% &
}99 	
public<< 
bool<< 
CanUserPublish<< "
<<<" #
T<<# $
><<$ %
(<<% &
T<<& '
content<<( /
)<</ 0
where<<1 6
T<<7 8
:<<9 :
IContent<<; C
{== 	
if>> 
(>> 
content>> 
is>> 

ISecurable>> %
securedContent>>& 4
)>>4 5
{?? 
var@@ 

descriptor@@ 
=@@  
securedContent@@! /
.@@/ 0!
GetSecurityDescriptor@@0 E
(@@E F
)@@F G
;@@G H
returnBB 

descriptorBB !
.BB! "
	HasAccessBB" +
(BB+ ,
PrincipalAccessorBB, =
.BB= >
CurrentBB> E
,BBE F
AccessLevelBBG R
.BBR S
PublishBBS Z
)BBZ [
;BB[ \
}CC 
returnDD 
falseDD 
;DD 
}EE 	
}FF 
}GG ºe
†C:\Projects\adnanzameer\AdvancedTaskManager\net6.0\src\AdvancedTaskManager\Infrastructure\Initialization\AdvancedTaskInitialization.cs
	namespace 	
AdvancedTaskManager
 
. 
Infrastructure ,
., -
Initialization- ;
{ 
[ 
InitializableModule 
] 
[ 
ModuleDependency 
( 
typeof 
( 
	EPiServer &
.& '
Web' *
.* + 
InitializationModule+ ?
)? @
)@ A
]A B
public 

class &
AdvancedTaskInitialization +
:, - 
IInitializableModule. B
{ 
private 
const 
string /
#ContentApprovalDeadlinePropertyName @
=A B
$strC `
;` a
private 
static 
readonly 
object  &
Lock' +
=, -
new. 1
(1 2
)2 3
;3 4
private "
IContentTypeRepository &"
_contentTypeRepository' =
;= >
private $
ITabDefinitionRepository ($
_tabDefinitionRepository) A
;A B
private )
IPropertyDefinitionRepository -)
_propertyDefinitionRepository. K
;K L
private -
!IPropertyDefinitionTypeRepository 1-
!_propertyDefinitionTypeRepository2 S
;S T
public 
void 

Initialize 
(  
InitializationEngine 3
context4 ;
); <
{ 	"
_contentTypeRepository "
=# $
context% ,
., -
Locate- 3
.3 4
Advanced4 <
.< =
GetInstance= H
<H I"
IContentTypeRepositoryI _
>_ `
(` a
)a b
;b c$
_tabDefinitionRepository $
=% &
context' .
.. /
Locate/ 5
.5 6
Advanced6 >
.> ?
GetInstance? J
<J K$
ITabDefinitionRepositoryK c
>c d
(d e
)e f
;f g)
_propertyDefinitionRepository )
=* +
context, 3
.3 4
Locate4 :
.: ;
Advanced; C
.C D
GetInstanceD O
<O P)
IPropertyDefinitionRepositoryP m
>m n
(n o
)o p
;p q-
!_propertyDefinitionTypeRepository -
=. /
context0 7
.7 8
Locate8 >
.> ?
Advanced? G
.G H
GetInstanceH S
<S T-
!IPropertyDefinitionTypeRepositoryT u
>u v
(v w
)w x
;x y
var 
configuration 
= 
context  '
.' (
Locate( .
.. /
Advanced/ 7
.7 8
GetInstance8 C
<C D
IOptionsD L
<L M&
AdvancedTaskManagerOptionsM g
>g h
>h i
(i j
)j k
;k l
var!! 1
%deleteContentApprovalDeadlineProperty!! 5
=!!6 7
configuration!!8 E
.!!E F
Value!!F K
.!!K L1
%DeleteContentApprovalDeadlineProperty!!L q
;!!q r
if"" 
("" 1
%deleteContentApprovalDeadlineProperty"" 5
)""5 6
{## #
DeleteMappingProperties$$ '
($$' (
)$$( )
;$$) *
}%% 
else&& 
{'' 
var(( .
"addContentApprovalDeadlineProperty(( 6
=((7 8
configuration((9 F
.((F G
Value((G L
.((L M.
"AddContentApprovalDeadlineProperty((M o
;((o p"
SetupMappingProperties** &
(**& '.
"addContentApprovalDeadlineProperty**' I
)**I J
;**J K
}++ 
},, 	
private.. 
void.. "
SetupMappingProperties.. +
(..+ ,
bool.., 0.
"addContentApprovalDeadlineProperty..1 S
)..S T
{// 	
foreach00 
(00 
var00 
contentType00 $
in00% '"
_contentTypeRepository00( >
.00> ?
List00? C
(00C D
)00D E
.00E F
Where00F K
(00K L
x00L M
=>00N P
x00Q R
.00R S
IsAvailable00S ^
)00^ _
)00_ `*
CreateUpdatePropertyDefinition11 .
(11. /
contentType22 
,22  /
#ContentApprovalDeadlinePropertyName33 7
,337 8
$str44 R
,44R S
$str55 /
,55/ 0
typeof66 
(66 
PropertyDate66 '
)66' (
,66( )
SystemTabNames77 "
.77" #
Settings77# +
,77+ ,
$num77- 0
,770 1.
"addContentApprovalDeadlineProperty88 6
)886 7
;887 8
}99 	
private;; 
void;; #
DeleteMappingProperties;; ,
(;;, -
);;- .
{<< 	
foreach== 
(== 
var== 
contentType== $
in==% '"
_contentTypeRepository==( >
.==> ?
List==? C
(==C D
)==D E
.==E F
Where==F K
(==K L
x==L M
=>==N P
x==Q R
.==R S
IsAvailable==S ^
)==^ _
)==_ `$
DeletePropertyDefinition>> (
(>>( )
contentType?? 
,??  /
#ContentApprovalDeadlinePropertyName@@ 7
)@@7 8
;@@8 9
}AA 	
privateBB 
voidBB *
CreateUpdatePropertyDefinitionBB 3
(BB3 4
ContentTypeBB4 ?
contentTypeBB@ K
,BBK L
stringBBM S"
propertyDefinitionNameBBT j
,BBj k
stringBBl r

helperTextBBs }
,BB} ~
string	BB …
editCaption
BB† ‘
,
BB‘ ’
Type
BB“ —$
propertyDefinitionType
BB˜ ®
,
BB® ¯
string
BB° ¶
tabName
BB· ¾
,
BB¾ ¿
int
BBÀ Ã
?
BBÃ Ä
propertyOrder
BBÅ Ò
,
BBÒ Ó
bool
BBÔ Ø0
"addContentApprovalDeadlineProperty
BBÙ û
)
BBû ü
{CC 	
varDD 
propertyDefinitionDD "
=DD# $!
GetPropertyDefinitionDD% :
(DD: ;
contentTypeDD; F
,DDF G"
propertyDefinitionNameDDH ^
)DD^ _
;DD_ `
ifFF 
(FF 
propertyDefinitionFF "
==FF# %
nullFF& *
)FF* +
{GG 
ifHH 
(HH "
propertyDefinitionTypeHH *
==HH+ -
nullHH. 2
)HH2 3
returnII 
;II 
ifKK 
(KK 
!KK .
"addContentApprovalDeadlinePropertyKK 7
)KK7 8
returnLL 
;LL 
propertyDefinitionNN "
=NN# $
newNN% (
PropertyDefinitionNN) ;
(NN; <
)NN< =
;NN= >
}OO 
elsePP 
{QQ 
propertyDefinitionRR "
=RR# $
propertyDefinitionRR% 7
.RR7 8
CreateWritableCloneRR8 K
(RRK L
)RRL M
;RRM N
}SS 
propertyDefinitionUU 
.UU 
ContentTypeIDUU ,
=UU- .
contentTypeUU/ :
.UU: ;
IDUU; =
;UU= >
propertyDefinitionVV 
.VV 
DisplayEditUIVV ,
=VV- .
trueVV/ 3
;VV3 4
propertyDefinitionWW 
.WW 
DefaultValueTypeWW /
=WW0 1
DefaultValueTypeWW2 B
.WWB C
NoneWWC G
;WWG H
propertyDefinitionYY 
.YY 
DisplayEditUIYY ,
=YY- ..
"addContentApprovalDeadlinePropertyYY/ Q
;YYQ R
if[[ 
([[ 
![[ 
string[[ 
.[[ 
IsNullOrEmpty[[ %
([[% &"
propertyDefinitionName[[& <
)[[< =
)[[= >
propertyDefinition\\ "
.\\" #
Name\\# '
=\\( )"
propertyDefinitionName\\* @
;\\@ A
if^^ 
(^^ 
!^^ 
string^^ 
.^^ 
IsNullOrEmpty^^ %
(^^% &
editCaption^^& 1
)^^1 2
)^^2 3
propertyDefinition__ "
.__" #
EditCaption__# .
=__/ 0
editCaption__1 <
;__< =
ifaa 
(aa 
!aa 
stringaa 
.aa 
IsNullOrEmptyaa %
(aa% &

helperTextaa& 0
)aa0 1
)aa1 2
propertyDefinitionbb "
.bb" #
HelpTextbb# +
=bb, -

helperTextbb. 8
;bb8 9
ifdd 
(dd "
propertyDefinitionTypedd &
!=dd' )
nulldd* .
)dd. /
propertyDefinitionee "
.ee" #
Typeee# '
=ee( )-
!_propertyDefinitionTypeRepositoryee* K
.eeK L
LoadeeL P
(eeP Q"
propertyDefinitionTypeeeQ g
)eeg h
;eeh i
ifgg 
(gg 
!gg 
stringgg 
.gg 
IsNullOrEmptygg %
(gg% &
tabNamegg& -
)gg- .
)gg. /
{hh 
varii 
obj2ii 
=ii 
Lockii 
;ii  
lockjj 
(jj 
obj2jj 
)jj 
{kk 
propertyDefinitionll &
.ll& '
Tabll' *
=ll+ ,$
_tabDefinitionRepositoryll- E
.llE F
LoadllF J
(llJ K
tabNamellK R
)llR S
;llS T
}mm 
}nn 
ifpp 
(pp 
propertyOrderpp 
.pp 
HasValuepp &
)pp& '
propertyDefinitionqq "
.qq" #

FieldOrderqq# -
=qq. /
propertyOrderqq0 =
.qq= >
Valueqq> C
;qqC D)
_propertyDefinitionRepositoryss )
.ss) *
Savess* .
(ss. /
propertyDefinitionss/ A
)ssA B
;ssB C
}tt 	
privatevv 
voidvv $
DeletePropertyDefinitionvv -
(vv- .
ContentTypevv. 9
contentTypevv: E
,vvE F
stringvvG M"
propertyDefinitionNamevvN d
)vvd e
{ww 	
varxx 
propertyDefinitionxx "
=xx# $!
GetPropertyDefinitionxx% :
(xx: ;
contentTypexx; F
,xxF G"
propertyDefinitionNamexxH ^
)xx^ _
;xx_ `
ifzz 
(zz 
propertyDefinitionzz "
!=zz# %
nullzz& *
)zz* +)
_propertyDefinitionRepositoryzz, I
.zzI J
DeletezzJ P
(zzP Q
propertyDefinitionzzQ c
)zzc d
;zzd e
}{{ 	
private}} 
static}} 
PropertyDefinition}} )!
GetPropertyDefinition}}* ?
(}}? @
ContentType}}@ K
contentType}}L W
,}}W X
string}}Y _
propertyName}}` l
,}}l m
Type}}n r#
propertyDefinitionType	}}s ‰
=
}}Š ‹
null
}}Œ 
)
}} ‘
{~~ 	
var 
source 
= 
from 
pd  
in! #
contentType$ /
./ 0
PropertyDefinitions0 C
where
€€ 
pd
€€ !
.
€€! "
Name
€€" &
.
€€& '
Equals
€€' -
(
€€- .
propertyName
€€. :
,
€€: ;
StringComparison
€€< L
.
€€L M
OrdinalIgnoreCase
€€M ^
)
€€^ _
select
 
pd
  "
;
" #
if
‚‚ 
(
‚‚ $
propertyDefinitionType
‚‚ &
!=
‚‚' )
null
‚‚* .
)
‚‚. /
source
ƒƒ 
=
ƒƒ 
from
ƒƒ 
pd
ƒƒ  
in
ƒƒ! #
source
ƒƒ$ *
where
„„ 
pd
„„ !
.
„„! "
Type
„„" &
.
„„& '
DefinitionType
„„' 5
==
„„6 8$
propertyDefinitionType
„„9 O
select
…… 
pd
……  "
;
……" #
return
†† 
source
†† 
.
†† 
FirstOrDefault
†† (
(
††( )
)
††) *
;
††* +
}
‡‡ 	
public
ŠŠ 
void
ŠŠ 
Uninitialize
ŠŠ  
(
ŠŠ  !"
InitializationEngine
ŠŠ! 5
context
ŠŠ6 =
)
ŠŠ= >
{
‹‹ 	
}
 	
}
 
} ¢=
yC:\Projects\adnanzameer\AdvancedTaskManager\net6.0\src\AdvancedTaskManager\Infrastructure\Mapper\ApprovalCommandMapper.cs
	namespace

 	
AdvancedTaskManager


 
.

 
Infrastructure

 ,
.

, -
Mapper

- 3
{ 
public 

	interface "
IApprovalCommandMapper +
{ 
ChangeTaskViewModel 
Map 
(  
ApprovalCommandBase  3
approvalCommand4 C
,C D

IPrincipalE O
	principalP Y
)Y Z
;Z [
} 
public 

class !
ApprovalCommandMapper &
:' ("
IApprovalCommandMapper) ?
{ 
private 
readonly 
ViewModelMapper (
_mapper) 0
=1 2
new3 6
(6 7
)7 8
;8 9
private 
readonly 
IContentRepository +
_contentRepository, >
;> ?
private 
readonly 
	IUIHelper "
	_uiHelper# ,
;, -
public !
ApprovalCommandMapper $
($ %
IContentRepository% 7
contentRepository8 I
,I J
	IUIHelperK T
uiHelperU ]
)] ^
{ 	
_contentRepository 
=  
contentRepository! 2
;2 3
	_uiHelper 
= 
uiHelper  
;  !
_mapper 
. 
Add 
< "
SecuritySettingCommand .
,. /
ChangeTaskViewModel0 C
>C D
(D E
)E F
;F G
_mapper 
. 
Add 
< "
LanguageSettingCommand .
,. /
ChangeTaskViewModel0 C
>C D
(D E
)E F
;F G
_mapper 
. 
Add 
< (
ExpirationDateSettingCommand 4
,4 5
ChangeTaskViewModel6 I
>I J
(J K
)K L
;L M
_mapper 
. 
Add 
<  
MovingContentCommand ,
,, -
ChangeTaskViewModel. A
>A B
(B C
)C D
;D E
} 	
public!! 
ChangeTaskViewModel!! "
Map!!# &
(!!& '
ApprovalCommandBase!!' :
approvalCommand!!; J
,!!J K

IPrincipal!!L V
	principal!!W `
)!!` a
{"" 	
var## 
commandViewModel1## !
=##" #
_mapper##$ +
.##+ ,
Map##, /
(##/ 0
approvalCommand##0 ?
)##? @
as##A C
ChangeTaskViewModel##D W
;##W X
var$$ 
name1$$ 
=$$ 
approvalCommand$$ '
is$$( *+
ICultureSpecificApprovalCommand$$+ J#
specificApprovalCommand$$K b
?$$c d#
specificApprovalCommand$$e |
.$$| }$
AppliedOnLanguageBranch	$$} ”
:
$$• –
null
$$— ›
;
$$› œ
var%% 
cultureInfo%% 
=%% 
string%% $
.%%$ %
IsNullOrEmpty%%% 2
(%%2 3
name1%%3 8
)%%8 9
?%%: ;
null%%< @
:%%A B
new%%C F
CultureInfo%%G R
(%%R S
name1%%S X
)%%X Y
;%%Y Z
var&& 
commandViewModel2&& !
=&&" #
commandViewModel1&&$ 5
;&&5 6
var'' 
contentRepository'' !
=''" #
_contentRepository''$ 6
;''6 7
var((  
appliedOnContentLink(( $
=((% &
approvalCommand((' 6
.((6 7 
AppliedOnContentLink((7 K
;((K L
var)) 
settings)) 
=)) 
new)) 
LoaderOptions)) ,
{** 
new++  
LanguageLoaderOption++ (
{,, 
Language-- 
=-- 
cultureInfo-- *
,--* +
FallbackBehaviour--, =
=--> ?
LanguageBehaviour--@ Q
.--Q R
FallbackWithMaster--R d
}.. 
}// 
;// 
var11 
name211 
=11 
contentRepository11 )
.11) *
Get11* -
<11- .
IContent11. 6
>116 7
(117 8 
appliedOnContentLink118 L
,11L M
settings11N V
)11V W
?11W X
.11X Y
Name11Y ]
;11] ^
if33 
(33 
commandViewModel233 !
!=33" $
null33% )
)33) *
commandViewModel244 !
.44! "
Name44" &
=44' (
name244) .
;44. /
if66 
(66 
commandViewModel166 !
!=66" $
null66% )
)66) *
{77 
commandViewModel188 !
.88! "
Status88" (
=88) *
(88+ ,
int88, /
)88/ 0
approvalCommand880 ?
.88? @
CommandStatus88@ M
;88M N
commandViewModel199 !
.99! "

CanExecute99" ,
=99- .
approvalCommand99/ >
.99> ?
CommandStatus99? L
==99M O
CommandMetaData99P _
.99_ `$
ChangeTaskApprovalStatus99` x
.99x y
InReview	99y 
;
99 ‚
var:: 
fullName:: 
=:: 
approvalCommand:: .
.::. /
GetType::/ 6
(::6 7
)::7 8
.::8 9
FullName::9 A
;::A B
if;; 
(;; 
fullName;; 
!=;; 
null;;  $
);;$ %
commandViewModel1<< %
.<<% &
TypeIdentifier<<& 4
=<<5 6
fullName<<7 ?
.<<? @
ToLower<<@ G
(<<G H
)<<H I
;<<I J
commandViewModel1>> !
.>>! "
Id>>" $
=>>% &
approvalCommand>>' 6
.>>6 7
Id>>7 9
.>>9 :

ExternalId>>: D
.>>D E
ToString>>E M
(>>M N
)>>N O
;>>O P
commandViewModel1?? !
.??! "
IsCommandDataValid??" 4
=??5 6
approvalCommand??7 F
.??F G
IsValid??G N
(??N O
)??O P
;??P Q
commandViewModel1@@ !
.@@! "
	CreatedBy@@" +
=@@, -
	_uiHelper@@. 7
.@@7 8!
GetDisplayNameForUser@@8 M
(@@M N
commandViewModel1@@N _
.@@_ `
	CreatedBy@@` i
)@@i j
;@@j k
commandViewModel1AA !
.AA! "
	ChangedByAA" +
=AA, -
	_uiHelperAA. 7
.AA7 8!
GetDisplayNameForUserAA8 M
(AAM N
commandViewModel1AAN _
.AA_ `
	ChangedByAA` i
)AAi j
;AAj k
ifBB 
(BB 
	principalBB 
.BB 
IdentityBB &
!=BB' )
nullBB* .
)BB. /
commandViewModel1CC %
.CC% &%
CanUserActOnHisOwnChangesCC& ?
=CC@ A
!CCB C
stringCCC I
.CCI J
EqualsCCJ P
(CCP Q
approvalCommandCCQ `
.CC` a
	CreatedByCCa j
,CCj k
	principalCCl u
.CCu v
IdentityCCv ~
.CC~ 
Name	CC ƒ
,
CCƒ „
StringComparison
CC… •
.
CC• –
OrdinalIgnoreCase
CC– §
)
CC§ ¨
;
CC¨ ©
returnDD 
commandViewModel1DD (
;DD( )
}EE 
returnGG 
nullGG 
;GG 
}HH 	
}II 
}JJ Ê9
sC:\Projects\adnanzameer\AdvancedTaskManager\net6.0\src\AdvancedTaskManager\Infrastructure\Mapper\ViewModelMapper.cs
	namespace 	
AdvancedTaskManager
 
. 
Infrastructure ,
., -
Mapper- 3
{ 
public 

class 
ViewModelMapper  
{ 
private		 
readonly		 
IDictionary		 $
<		$ %
Type		% )
,		) *
Mapping		+ 2
>		2 3
_typeMappings		4 A
=		B C
new		D G

Dictionary		H R
<		R S
Type		S W
,		W X
Mapping		Y `
>		` a
(		a b
)		b c
;		c d
public 
ViewModelMapper 
Add "
<" #
TSource# *
,* +
TModel, 2
>2 3
(3 4
)4 5
where
 
TSource 
: 
class 
where
 
TModel 
: 
class 
, 
new  #
(# $
)$ %
{ 	
return 
Add 
( 
( 
Action 
< 
TSource &
,& '
TModel( .
>. /
)/ 0
null0 4
)4 5
;5 6
} 	
private 
ViewModelMapper 
Add  #
<# $
TSource$ +
,+ ,
TModel- 3
>3 4
(4 5
Action5 ;
<; <
TSource< C
,C D
TModelE K
>K L
afterMapActionM [
)[ \
where] b
TSourcec j
:k l
classm r
wheres x
TModely 
:
€ 
class
‚ ‡
,
‡ ˆ
new
‰ Œ
(
Œ 
)
 
{ 	
_typeMappings 
. 
Add 
( 
typeof $
($ %
TSource% ,
), -
,- .
new/ 2
Mapping3 :
<: ;
TSource; B
,B C
TModelD J
>J K
(K L
)L M
{ 
AfterMapAction 
=  
afterMapAction! /
} 
) 
; 
return 
this 
; 
} 	
public 
object 
Map 
< 
TSource !
>! "
(" #
TSource# *
source+ 1
)1 2
{ 	
var 
type 
= 
source 
. 
GetType %
(% &
)& '
;' (
var 
mapping 
= 

GetMapping $
($ %
type% )
)) *
;* +
if 
( 
mapping 
== 
null 
)  
return   
null   
;   
var"" 
instance"" 
="" 
mapping"" "
.""" #
CreateInstance""# 1
(""1 2
)""2 3
;""3 4
var## 

dictionary## 
=## 
instance## %
.##% &
GetType##& -
(##- .
)##. /
.##/ 0
GetProperties##0 =
(##= >
)##> ?
.##? @
ToDictionary##@ L
(##L M
p##M N
=>##O Q
p##R S
.##S T
Name##T X
,##X Y
StringComparer##Z h
.##h i
OrdinalIgnoreCase##i z
)##z {
;##{ |
foreach$$ 
($$ 
var$$ 
property$$ !
in$$" $
type$$% )
.$$) *
GetProperties$$* 7
($$7 8
)$$8 9
)$$9 :
if%% 
(%% 

dictionary%% 
.%% 
TryGetValue%% *
(%%* +
property%%+ 3
.%%3 4
Name%%4 8
,%%8 9
out%%: =
var%%> A
propertyInfo%%B N
)%%N O
&&%%P R
propertyInfo%%S _
.%%_ `
CanWrite%%` h
&&%%i k
property%%l t
.%%t u
PropertyType	%%u 
==
%%‚ „
propertyInfo
%%… ‘
.
%%‘ ’
PropertyType
%%’ 
)
%% Ÿ
propertyInfo&&  
.&&  !
SetValue&&! )
(&&) *
instance&&* 2
,&&2 3
property&&4 <
.&&< =
GetValue&&= E
(&&E F
source&&F L
)&&L M
)&&M N
;&&N O
mapping'' 
.'' %
ExecuteAfterMappingAction'' -
(''- .
source''. 4
,''4 5
instance''6 >
)''> ?
;''? @
return(( 
instance(( 
;(( 
})) 	
private++ 
Mapping++ 

GetMapping++ "
(++" #
Type++# '

sourceType++( 2
)++2 3
{,, 	
return-- 
!-- 
_typeMappings-- !
.--! "
TryGetValue--" -
(--- .

sourceType--. 8
,--8 9
out--: =
var--> A
mapping--B I
)--I J
?--K L
null--M Q
:--R S
mapping--T [
;--[ \
}.. 	
private00 
abstract00 
class00 
Mapping00 &
{11 	
public22 
abstract22 
object22 "
CreateInstance22# 1
(221 2
)222 3
;223 4
public44 
abstract44 
void44  %
ExecuteAfterMappingAction44! :
(44: ;
object44; A
source44B H
,44H I
object44J P
model44Q V
)44V W
;44W X
}55 	
private77 
class77 
Mapping77 
<77 
TSource77 %
,77% &
TModel77' -
>77- .
:77/ 0
Mapping771 8
where88
 
TSource88 
:88 
class88 
where99
 
TModel99 
:99 
class99 
,99 
new99  #
(99# $
)99$ %
{:: 	
public;; 
Action;; 
<;; 
TSource;; !
,;;! "
TModel;;# )
>;;) *
AfterMapAction;;+ 9
{;;: ;
get;;< ?
;;;? @
set;;A D
;;;D E
};;F G
public== 
override== 
object== "
CreateInstance==# 1
(==1 2
)==2 3
{>> 
return?? 
new?? 
TModel?? !
(??! "
)??" #
;??# $
}@@ 
publicBB 
overrideBB 
voidBB  %
ExecuteAfterMappingActionBB! :
(BB: ;
objectBB; A
sourceBBB H
,BBH I
objectBBJ P
modelBBQ V
)BBV W
{CC 
AfterMapActionDD 
?DD 
.DD  
InvokeDD  &
(DD& '
(DD' (
TSourceDD( /
)DD/ 0
sourceDD0 6
,DD6 7
(DD8 9
TModelDD9 ?
)DD? @
modelDD@ E
)DDE F
;DDF G
}EE 
}FF 	
}GG 
}HH 